{"config": {"lang": ["en"], "separator": "[\\s\\-]+", "pipeline": ["stopWordFilter"]}, "docs": [{"location": "", "title": "Welcome to MkDocs", "text": "<p>For full documentation visit mkdocs.org.</p>"}, {"location": "#commands", "title": "Commands", "text": "<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"}, {"location": "#project-layout", "title": "Project layout", "text": "<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"}, {"location": "about/", "title": "About this documentation", "text": "<ul> <li>This is the Mercury Documentation covering technical and functional aspects</li> </ul>"}, {"location": "ApplicationGuide/TechnicalGuide/Doc_MercuryProcesses/", "title": "Mercury Processes", "text": ""}, {"location": "ApplicationGuide/TechnicalGuide/Doc_MercuryProcesses/#calc-fields-compute-fields", "title": "Calc fields / Compute fields", "text": ""}, {"location": "ApplicationGuide/TechnicalGuide/Doc_MercuryProcesses/#endpoint", "title": "Endpoint", "text": "<p>/Engine/CalcFields/{lcId} Run the calculated field calculation.</p>"}, {"location": "ApplicationGuide/TechnicalGuide/Doc_MercuryProcesses/#main-reference", "title": "Main reference", "text": "<p>EngineRepositoryAsync. Repository containing calculations tasks (like Calc Fields, Liq, etc.) and implementing the ComputeFields() method (Asynchronous Task).</p>"}, {"location": "ApplicationGuide/TechnicalGuide/Doc_MercuryProcesses/#steps-of-calculated-fields", "title": "Steps of calculated fields", "text": "<ul> <li>POS_GEN - generate positions before calculating other fields</li> <li>CALC_FIELDS - calculate all fields in Core Entity Object Type Tables (EntityObjectType = \"Core\")</li> <li>BEFORE_RULES - calculate fields defined in param_calc_fields / param_copy_views tables and treated BEFORE applying any Rule (INSERT SELECT generated statements)</li> <li>RULE ENGINE CALC FIELDS - calculate all fields defined in param_rule_mapping table, excluding CRM rules or staging if not needed (UPDATE case when generated statements)</li> <li>AFTER_RULES - calculate fields defined in param_calc_fields / param_copy_views tables and treated AFTER applying any Rule (INSERT SELECT generated statements)</li> <li>ADAPTATION POST CALC FIELDS - apply any adaptation whith the 'PreImport' Type value.</li> </ul>"}, {"location": "ApplicationGuide/TechnicalGuide/Doc_TechnicalRequirements/", "title": "Technical requirements", "text": ""}, {"location": "ApplicationGuide/UserGuide/Doc_Scenarios/", "title": "Scenarios", "text": ""}, {"location": "ApplicationGuide/UserGuide/Doc_Scenarios/#1-settings", "title": "1. Settings", "text": ""}, {"location": "ApplicationGuide/UserGuide/Doc_Scenarios/#11-scenariogroupscsv", "title": "1.1. ScenarioGroups.csv", "text": "<p>It contains all the scenarios defined by Quadrum and/or the bank. For each line, a set or rules (see 1.2. ScenarioRules.csv) is link to a type of scenario (see 1.3. ScenarioTypes.csv).</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_Scenarios/#12-scenariorulescsv", "title": "1.2. ScenarioRules.csv", "text": "<p>It contains all the rules of the different scenarios. The syntax is the same than for adaptations.</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_Scenarios/#13-scenariotypescsv", "title": "1.3. ScenarioTypes.csv", "text": "<p>It contains de different types of scenarios. For each type, a list of instructions with the order is defined.</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_Scenarios/#2-features", "title": "2. Features", "text": ""}, {"location": "ApplicationGuide/UserGuide/Doc_Scenarios/#21-scenarios", "title": "2.1. Scenarios", "text": "<p>Allows to apply the scenarios defined in the 1. Settings on a load collection.</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_Scenarios/#22-excel-file-alone", "title": "2.2. Excel file alone", "text": "<p>Allows to import and calculate the content of an Excel file on it own (it's only the content of the file which will be used for the calculation). It can be used to simulate a new portfolio.</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_Scenarios/#23-excel-file-with-load-collection", "title": "2.3. Excel file with load collection", "text": "<p>Allows to add data from an Excel file to an existing load collection. I can be used to simulate a new position in an existing portfolio.</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/", "title": "User Guide - Step by step", "text": ""}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#11-general-settings", "title": "1.1. General settings", "text": "<p>As a first step the user must complete some business configuration files. All these files are normally stored in the configuration folder of Mercury and available in the application under a specific menu.</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#111-adaptationscsv", "title": "1.1.1. Adaptations.csv", "text": "<p>It contains all the rules needed to correct the input data.  In application the menu Reporting setup / Configuration gives acces to the related table.</p> <p></p> <p>In the \"Actions\" part of the menu you can Edit, Apply, Test and Delete each rule</p> <p> </p> <p>The adaptation rule can be enabled or disabled directly in the related column in the table.</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#112-bookingcenterscsv", "title": "1.1.2. BookingCenters.csv", "text": "<p>Definition: Entity owning the reported data The reporting perimeter is defined in this file. In the application under the menu Reporting setup / Reporting Management the information are visibile and editable.</p> <p></p> <p>Definitions: - Id = Unique booking center identifier. - CreationDate = Date at which the record was created or modified. - Name = Name of the booking center. - OfficeType = Delivers the office type from the perspective of the entity higher in the structure of the bank. For instance, if an entity is a subsidiary of its mother entity and the head office on another one, deliver Subsidiary. Information used for consolidation. - OfficeCountry = ISO 3166 2-letters country code of the location of the reporting entity. - OfficeCanton  = For Swiss reporting entities, 2-letter code of the canton of location. - OwnerI = Largest owner. Used for consolidation level.</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#113-reportingsetscsv", "title": "1.1.3. ReportingSets.csv", "text": "<p>Definition: Sets of data for the Reporting Entity and the linked Booking Centers</p> <p>This is used to link all BookingCenters together for a Reporting Entity and the Office Type in the consolidation Perimeter. In the menu Reporting Setup / Reporting Management the information are visibile and editable.</p> <p></p> <p>Definitions:</p> <ul> <li> <p>Id = Unique Reporting Set identifier</p> </li> <li> <p>CreationDate = Date at which the record was created or modified</p> </li> <li> <p>ReportingEntity = Existing Reporting Entity Identifier.</p> </li> <li> <p>BookingCenter = Existing Booking Center Identifier</p> </li> <li> <p>OfficeCountry = Country to consider in the BookingCenter-ReportingEntity link</p> </li> <li> <p>OfficeType = Office Type to consider in the BookingCenter-ReportingEntity link</p> </li> </ul> <p>All these files are read by the application during the import of the data.</p> <p>Attention: when an update is made in the .csv files we need to reload them using the menu \"LoadAll\" (located in the \"AccesKitchen\" part (see point 1.2.4.). </p> <p>In general, the following behaviors are applied during the Load All process:</p> <ul> <li> <p>BookingCenter, ReportingEntity et ReportingSet: we keep without updating existing entries and add the new ones coming from the input file.</p> </li> <li> <p>Adaptation, InterestRateCurve, MsaQuery, Netting : we  replace the entries with the same ID and add new ones.</p> </li> <li> <p>Parameter =&gt; We replace existing entries, but keep the already set parameter Value</p> </li> </ul> <p>On the other hand, if an update made in the application need to be reported in the .csv file the \"SaveAll\" option should be run.</p> <p> </p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#114-reportingentitiescsv", "title": "1.1.4. ReportingEntities.csv", "text": "<p>Definition: Entities of the bank which need to produce reports.</p> <p>All the reporting entities used in the legal reporting's perimeter are reported here with all the needed information (SNB code, FINMA's category, master data, etc). In the menu Reporting Setup / Reporting Management the information are visibile and editable.</p> <p></p> <p>Definitions:</p> <ul> <li> <p>FinmaCategory = FINMA category</p> </li> <li> <p>ConsoLevelGroup (TRUE/FALSE) = Is the entity doing a reporting at the consolidation level group? </p> </li> <li> <p>ConsoLevelParentCompany (TRUE/FALSE) = Is the entity doing a reporting at the consolidation level parent company? </p> </li> <li> <p>ConsoLevelBankOffice (TRUE/FALSE) = Is the entity doing a reporting at the consolidation level bank office?</p> </li> <li> <p>StreetName = Street name of reporting entity's adress.</p> </li> <li> <p>StreetNumber  = Street number of reporting entity's adress.</p> </li> <li> <p>PostBox = Post box of the reporting entity's adress.</p> </li> <li> <p>ZipCode  = Zip code of the reporting entity's adress.</p> </li> <li> <p>City = City of the reporting entity's adress.</p> </li> <li> <p>ContactName = Person of contact.</p> </li> </ul>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#12-navigation-through-the-application", "title": "1.2. Navigation through the application", "text": ""}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#121-statistics", "title": "1.2.1. Statistics", "text": "<p>All the legal reports and the related workingpapers are accessible on this menu grouped by topics.</p> <ul> <li> <p>Accounting (MONA, MIRE, WB, AU, G101, B001, KRED, KWERA)</p> </li> <li> <p>BIS (EURO2, ASTA2)</p> </li> <li> <p>Capital adequacy (Credit Risk, Market Risk)</p> </li> <li> <p>Large Exposure (LER, LER20, ARIS)</p> </li> <li> <p>Liquidity (LCR, NSFR, LMT)</p> </li> <li> <p>IRRBB (ZIR)</p> </li> </ul>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#122-tools", "title": "1.2.2. Tools", "text": "<p>Contains the following sub-menus:</p> <p></p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#loads-management", "title": "Loads management", "text": "<p>Data Loads Import of the data, checks and the changse of the input data (core_positions table) are available under this menu. </p> <p></p> <p>The import part allow the user to import a new data loads (Import button) or overwrite an existing Data Load or add (merge) new data to an existing Data Load by using the up arrow icon on the Actions options part.</p> <p>Moreover the user can choose to upload multiple files (the files must be stored in the same folder).</p> <p></p> <p>Loads Collections</p> <p></p> <p>Under this menu, in the Actions part,  you can:</p> <p> Add the relevant Reporting Entity</p> <p></p> <p> Link different data loads</p> <p> </p> <p> Perform all the calculations.</p> <p></p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#reporting-setup", "title": "Reporting setup", "text": "<p>This menu is splitted in two parts: Configuration and Reporting Management.</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#configuration", "title": "Configuration", "text": "<p>This menu contains a series of sub-menus with a range of useful features to make life easier for users.</p> <p></p> <p>Data Adaptations</p> <p>As described an point  1.1.1 this menu can be filled via the .csv file in the config folder or using the table in the interface. (see point 1.1.1 for more details)</p> <p>Interest Rate Curves Here the interest rate curves  used to compute the IRRBB calculations are available and can be uploaded via a .csv file. (Mercury's table: ts_interest_rate_curve)</p> <p></p> <p></p> <p>SNB  Basket</p> <p>The official list (https://www.snb.ch/en/the-snb/mandates-goals/monetary-policy/implementation/repo-payments-transactions) of the collaterals eligibile fro SNB repos should be uploaded here for each data load.</p> <p></p> <p>LEX &amp; ARIS Counterparties</p> <p>The list of couterparties for Large Exposure (LEX) or Aris scope can be uploaded here.</p> <p></p> <p>Format of the document is .csv. </p> <p>Important Note: the PointInTime column (second value) must be updated at the time of loading to correspond to the LoadId in which the data is located (this information can be found in the \"Data loads\" menu).</p> <p></p> <p>IRRBB Replication Key Replication keys are used to model positions without maturity in the context of interest rate risk and are constructed using two dimensions:  the positions to which the rules are applied (Rules) and the time buckets (Splits) into which the amounts are to be allocated.</p> <p></p> <p></p> <p>A set of standard replication keys are provided in Mercury but users can create and apply new ones according to their internal policies directly in this menu.</p> <p></p> <p>Note: The time buckets (1-19) are pre-established according to regulation (FINMA Circ. 2019/2 Annexe 2)</p> <p>IRRBB Replication Scenario The six standard scenarios (per currency) described in the FINMA Circulare (2019/2 Annexe 2) are contained in Mercury and visible in this menu. The user can create or import other scenarios using the dedicated menu in the interface.</p> <p></p> <p>Rules navigator</p> <p>All the table containing the rules and parameters determining the calc_fields in the related tables are stored under this menu grouped by topic.</p> <p></p> <p>The select menu on the top right part of the screen helps the user by facilitating the search for available rules by entering key words.</p> <p>Data Reconciliation</p> <p>This menu allow the user to check data from a series of given table of our datamodel. Additional parameters to filter the results have to be entered in the where part of the menu. </p> <p>(ex. the LoadId of the group of data we want to investigate)</p> <p></p> <p>SQL Tool</p> <p>Quick and direct data searches can be made from this menu using a SQL language.</p> <p></p> <p>Parameters</p> <p>List of the customizable parameters available in the application and characteristics are stored here. </p> <p>(Mercury's table: param_parameters)</p> <p></p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#reporting-management", "title": "Reporting Management", "text": "<p>The general settings described at point 1.1 are available and editable in the application here.</p> <p></p> <p>Booking Centers</p> <p></p> <p>Reporting Sets</p> <p></p> <p>Reporting Entities</p> <p></p> <p>Consolidation</p> <p>A summary diagram of how the consolidated data (group and reporting entities structure) are treated is available here.</p> <p>Pledges</p> <p></p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#13-from-data-loading-to-report-producing", "title": "1.3. From data loading to report producing", "text": ""}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#131-data-loading", "title": "1.3.1. Data loading", "text": "<p>The importing of the data is performed from the menu Tools / Loads Management / Data Loads using the icon IMPORT.</p> <p></p> <ul> <li> <p>Enter the reporting data</p> </li> <li> <p>Enter a name for the Data Load    (Note: the reporting data will be displayed as the begin of your Data Load name)</p> </li> <li> <p>Choose among the following options how the data group you are importing will be treated </p> </li> <li> <p>Select the file you want to import</p> </li> <li> <p>Click the Submit button</p> </li> </ul> <p>It is possible to view and verify ongoing processes by navigating to the Notifications menu </p> <p>or by selecting the \"See current logs\" option under the suitcase icon  </p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#132-fields-calculations", "title": "1.3.2. Fields calculations", "text": "<p>Once the data have been imported, the calculations of the fields must be triggered via the menu Loads Management / Load Collections, by clicking the Calculate fields icon in the Actions for the choosen Data Load.</p> <p></p> <p>As per the previous menu you can see the processus and the technical results in the Logging actions area or in the Notifications menu .</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#133-reports-calculation", "title": "1.3.3. Reports calculation", "text": "<p>After selecting a report and choosing a data set, the calculation must be launched with the Calculate icon. </p> <p>Note: The icon is orange and there are no reports available before starting the calculation.</p> <p>Once the calculations have been completed (you can check the technical results in the Notifications menu), the reports are visible.</p> <p>Variation Reporting  This menu allows to compare figures and their variations between two periods. Simply by enabling the option, choosing the Load to compare with, adjusting the Absolute and Relative thresold range.  Once the option is enabled, the calucation must be launched and the results will be visible on each report of the survey.</p> <p></p> <p></p> <p>Toggle absolute variance: by activating this option, the delta between the amounts of the two selected periods is shown in absolute value.</p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#134-reports-validation", "title": "1.3.4. Reports validation", "text": "<p>Validation can be run, once the reports have been calculated, via the dedicated menu.</p> <p></p> <p>The validation rules are those provided by BNS for the specific report.</p> <p>In the case of warning or error messages, the affected report(s) and cell(s) can be highlighted by clicking on the highlighter symbol at the side of the descriptive message of the warning/error.</p> <p></p> <p></p>"}, {"location": "ApplicationGuide/UserGuide/Doc_UserGuide/#135-reports-export", "title": "1.3.5. Reports export", "text": "<p>The reports can be exported in XML format using the icon Export XML in the home page of each survey. </p> <p></p> <p>The XML-generated file can then be transmitted to the relevant supervisory authorities (SNB or FINMA) through the agreed channels.</p>"}, {"location": "FunctionalDoc/Doc_AccruedInterest/", "title": "Management of Accrued Interest", "text": ""}, {"location": "FunctionalDoc/Doc_B4Input/", "title": "Basel 4 new inputs", "text": ""}, {"location": "FunctionalDoc/Doc_B4Input/#fields", "title": "Fields", "text": "<ul> <li><code>core_positions</code><ul> <li><code>GoodsXBorderFlag</code></li> </ul> </li> <li><code>core_module_specifics</code><ul> <li><code>CAForceRiskWeightB4</code></li> <li><code>ForceCAPositionClassB4</code></li> <li><code>CEMReducedPFEFactorFlag</code></li> <li><code>CALTVDefinedRWFlag</code></li> </ul> </li> <li><code>list_counterparties</code><ul> <li><code>Turnover</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_B4Input/#values", "title": "Values", "text": "<ul> <li>Types of counterparty:<ul> <li><code>SFn</code></li> </ul> </li> <li>Types of position:<ul> <li><code>SLPNOP</code></li> <li><code>SLPOP</code></li> <li><code>SLPOPH</code></li> <li><code>SLCo</code></li> <li><code>SLObj</code></li> </ul> </li> <li>Types of security:<ul> <li><code>CovBond</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_B4Output/", "title": "Basel 4 new outputs", "text": ""}, {"location": "FunctionalDoc/Doc_B4Output/#tables", "title": "Tables", "text": "<ul> <li><code>core_positions_crm_ca_b4</code></li> <li><code>core_positions_crm_ltv</code></li> <li><code>core_positions_crm_ltv</code></li> <li><code>calc_cre_cem_netting_set_level_B4</code></li> </ul>"}, {"location": "FunctionalDoc/Doc_B4Output/#fields", "title": "Fields", "text": "<ul> <li><code>core_derivatives_calc</code><ul> <li><code>PFEFactorB4</code></li> </ul> </li> <li><code>core_positions_calc</code><ul> <li><code>RegulatoryHaircutB4</code></li> <li><code>CAExposureFlagB4</code></li> <li><code>CCFB4</code></li> <li><code>CARiskWeightB4</code></li> <li><code>CAExposureB4</code></li> <li><code>CAIssuerExposureB4</code></li> <li><code>CAIssuerRiskWeightB4</code></li> <li><code>CVAWeightB4</code></li> <li><code>CAPositionClassB4</code></li> <li><code>CAIssuerPositionClassB4</code></li> <li><code>PositionDefaultFlag</code></li> <li><code>CounterpartyDefaultFlag</code></li> </ul> </li> <li><code>core_positions_calc_lc</code><ul> <li><code>ReportingCategoryB4</code></li> <li><code>IssuerReportingCategoryB4</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_B4Output/#values", "title": "Values", "text": "<ul> <li>Position classes:<ul> <li><code>CBankGovSO</code></li> <li><code>PSE</code></li> <li><code>MDB</code></li> <li><code>Bank</code></li> <li><code>JI</code></li> <li><code>Corp</code></li> <li><code>SL</code></li> <li><code>FCovBond</code></li> <li><code>Retail</code></li> <li><code>SCMBI</code></li> <li><code>SP</code></li> <li><code>DP</code></li> <li><code>EquityLike</code></li> <li><code>Other</code></li> </ul> </li> <li>Reporting categories:<ul> <li><code>CBankGovSO</code> </li> <li><code>OtherAssets</code> </li> <li><code>PSE</code> </li> <li><code>MDB</code> </li> <li><code>Bank</code></li> <li><code>SCMBIFCovBond</code></li> <li><code>Corp</code></li> <li><code>SpecLending</code></li> <li><code>EqSubDebt</code></li> <li><code>Retail</code></li> <li><code>REstateSelfResi</code></li> <li><code>REstateOthResi</code></li> <li><code>REstateSelfCom</code></li> <li><code>REstateOthCom</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_BISUltimateCountryRiskCalc/", "title": "BIS - Ultimate risk calculation", "text": ""}, {"location": "FunctionalDoc/Doc_BISUltimateCountryRiskCalc/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>BIS</li> </ul>"}, {"location": "FunctionalDoc/Doc_BISUltimateCountryRiskCalc/#legal-references", "title": "Legal references", "text": "<p>*</p>"}, {"location": "FunctionalDoc/Doc_BISUltimateCountryRiskCalc/#mercury-input", "title": "Mercury input:", "text": ""}, {"location": "FunctionalDoc/Doc_BISUltimateCountryRiskCalc/#input-fields", "title": "Input Fields:", "text": "<p>Depending on the value of the parameter ASTA2CRMTYPE:    CRE MONA</p> <p>The parameter defines ONLY the criteria of \"eligibility\" of the collaterals:    - CRE = eligibility according to CAO   - MONA = eligible if it's pledged  Additional details in the respective documentation   - list_countries.Rating is used to treat the collaterals, the source used for this classification comes from: https://www.serv-ch.com/en/ &gt; Cover Practice, what we use as \"rating\" is the country risk category   - If a bank can provide external ratings she needs to update this list_countries table</p>"}, {"location": "FunctionalDoc/Doc_BISUltimateCountryRiskCalc/#calculation", "title": "Calculation:", "text": "<ul> <li>The process is a simplified CRM:</li> <li>According to the eligibility criteria we cover the exposures with collateral to define the \"ultimate\" risk country</li> <li>What changes in term of CRM is the order in which we consider the collaterals, we use the rating of the country stored in list_countries.Rating with a link on core_positions_calc.RiskCountry = list_countries.Code</li> <li> <p>Current fallback solution: When two countries have the same rating we order the countries alphanumerically</p> </li> </ul>"}, {"location": "FunctionalDoc/Doc_BISUltimateCountryRiskCalc/#output-field", "title": "Output Field:", "text": "<p>QUIRE-783</p> <ul> <li>During BIS CRM process the core_positions_calc.RiskCountry from the collateral is copied into core_positions_crm_bis.AstaUltimateRiskCountry.</li> <li>To be confirmed by CTO: There might be a new table core_positions_crm_BIS</li> </ul>"}, {"location": "FunctionalDoc/Doc_BISUltimateCountryRiskCalc/#parameter", "title": "Parameter:", "text": "<ul> <li>name: ASTA2CRMTYPE</li> <li>cat: ?</li> <li>value: CRE (default, also possible MONA) </li> <li>description: Ultimate risk country source for ASTA2: either CRE CRM or MONA CRM</li> </ul>"}, {"location": "FunctionalDoc/Doc_CCF/", "title": "Credit conversion factor", "text": ""}, {"location": "FunctionalDoc/Doc_CCF/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_CCF/#legal-references", "title": "Legal references", "text": "<ul> <li>OFR/OFRnew 2022 Appendix 1</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/", "title": "Current exposure method", "text": ""}, {"location": "FunctionalDoc/Doc_CEM/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#legal-references", "title": "Legal references", "text": "<ul> <li>Version 2016:<ul> <li>Finma circ. 2017/07 Appendix 4</li> <li>OFR Art. 57</li> <li>bcbs128 (Basel II Framework) Art. 186, Appendix 4 section VII</li> </ul> </li> <li>Version 2025:</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#description", "title": "Description", "text": "<ul> <li>Version 2016:<ul> <li>Goal: computation of credit-equivalent of derivatives with the current exposure method (m\u00e9thode de la valeur march\u00e9).</li> <li>Suggestion: build a flattened base view containing all the relevant derivative data for this topic. All the calculation, including the computation of fields based on decision tables would use this view as an input (assumption for this doc).<ul> <li>The high level filter to isolate derivatives in this view would be the following: <code>core_positions.TypeOf = 'Contract</code> and <code>core_positions.SubType in ('DerOTC','DerExc')</code>.</li> <li>This view would be the result from a join on the tables below.<ul> <li><code>core_positions</code> and <code>core_derivatives</code> on <code>core_positions.DerivativeId</code></li> <li><code>core_positions</code> and <code>core_derivatives_swaps</code> on <code>core_positions.DerivativeSwapId</code></li> <li><code>core_positions</code> and <code>core_positions_calc</code> on <code>core_positions.Id</code></li> <li><code>core_positions</code> and <code>core_derivatives_calc</code> on <code>core_positions.Id</code> with;</li> </ul> </li> <li>Not all the fields of every tables are necessary. Those that are mandatory are listed under Input. To limit the size of the view, we could only select this fields.</li> <li>To avoid confusion in case of homonym fields, I suggest using alias. I have added them in brackets under Input when necessary.</li> </ul> </li> <li>Steps:<ol> <li>Compute core_derivatives_calc.ReplacementValue (see condition below)</li> <li>Compute the field core_derivatives_calc.AssetClass \u2192 see decision table</li> <li>Compute the field core_derivatives_calc.PFEFactor \u2192 see decision table</li> <li>Compute the core_positions_calc.EAD \u2192 see two section below</li> </ol> </li> </ul> </li> <li>Version 2025:</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#case-where-there-is-not-a-recognized-netting-agreement-in-place", "title": "Case where there is not a recognized netting agreement in place:", "text": "<ul> <li>Condition:<ul> <li><code>core_positions.NettingAgreementType not in ('CN','NbN')</code></li> </ul> </li> <li>Calculation of the exposure at default (EAD) per derivative<ul> <li> , where: <ul> <li> <ul> <li>PFE = potential future exposure</li> </ul> </li> </ul> </li> <li><code>core_positions_calc.EAD = min(core_derivatives_calc.ReplacementValue,0) * core_derivatives_calc.PFEFactor * core_positions.Notional</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#case-where-there-is-a-recognized-netting-agreement-in-place", "title": "Case where there is a recognized netting agreement in place:", "text": "<ul> <li>Condition:<ul> <li><code>core_positions.NettingAgreementType in ('CN','NbN')</code></li> </ul> </li> <li>Calculation of the exposure at default (EAD) per netting set<ul> <li>In this case, a form of netting is possible at the level of the counterparty for all the derivatives in the netting agreement. Therefore, the EAD should first be computed at the level of the counterparty/NettingSetId (<code>group by core_positions.NettingSetId where core_positions.NettingAgreementType in ('CN','NbN')</code>). Technically, I suggest then to distributed the EAD of the netting set to the individual positions proportionally to the Notional. </li> <li> , where:<ul> <li> , where:<ul> <li> </li> </ul> </li> </ul> </li> <li><code>core_positions_calc.EAD = 0.40 * sum(core_derivatives_calc.PFEFactor * core_positions.Notional) + 0.60 * sum(core_derivatives_calc.PFEFactor * core_positions.Notional) * sum(core_derivatives_calc.ReplacementValue)/sum(core_derivatives_calc.ReplacementValue&gt;0)</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_CEM/#core_positions", "title": "core_positions", "text": "<ul> <li>Type</li> <li>SubType</li> <li>DerivativeId</li> <li>DerivativeSwapId </li> <li>LongContractFlag</li> <li>Notional</li> <li>BookAmount</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#core_positions_calc", "title": "core_positions_calc", "text": "<ul> <li>ResidualDurationDays</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#core_derivatives-cd", "title": "core_derivatives (cd)", "text": "<ul> <li>Type (Der_)</li> <li>UnderlyingSecurityId</li> <li>UnderlyingInterestRateId</li> <li>UnderlyingCommodityId</li> <li>UnderlyingReferenceEntityId</li> <li>QuoteCurrency</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#core_derivatives_swaps-cds", "title": "core_derivatives_swaps (cds)", "text": "<ul> <li>Type (DerS_)</li> <li>RCurrency</li> <li>PCurrency</li> <li>RUnderlyingSecurityId</li> <li>RUnderlyingInterestRateId</li> <li>RUnderlyingCommodityId</li> <li>RUnderlyingReferenceEntityId</li> <li>PUnderlyingSecurityId</li> <li>PUnderlyingInterestRateId</li> <li>PUnderlyingCommodityId</li> <li>PUnderlyingReferenceEntityId</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#list_counterparties-lc", "title": "list_counterparties (lc)", "text": "<ul> <li>Type (RefEnt_)</li> <li>RatingClass (RefEnt_)</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#list_securities-lsr-or-lsp", "title": "list_securities (lsr or lsp)", "text": "<ul> <li>Type (for the join with core_derivatives: Sec_, for the join with core_derivatives_swaps: RSec and PSec_)</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#core_interest_rates-cirr-or-cirp", "title": "core_interest_rates (cirr or cirp)", "text": "<ul> <li>Type (for the join with core_derivatives: IR_, for the join with core_derivatives_swaps: RIR_ and PIR_)</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#list_commodities-lc", "title": "list_commodities (lc)", "text": "<ul> <li>Type (for the join with core_derivatives: Co_, for the join with core_derivatives_swaps: RCo_ and PCo_)</li> </ul>"}, {"location": "FunctionalDoc/Doc_CEM/#output-fields", "title": "Output fields", "text": ""}, {"location": "FunctionalDoc/Doc_CEM/#core_derivatives_calc", "title": "core_derivatives_calc", "text": "<ul> <li>AssetClass</li> <li>ReplacementValue</li> <li>PFEFactor (facteur de majoration) - Finma circ. Apendix 4  cm 2 / bcbs128 Art. 92(i). See decision table in excel file PFEFactor.</li> <li>EAD<ul> <li>See calculation under Case where the is a recognized netting agreement in place and Case where the is not a recognized netting agreement in place</li> <li>The name of this field does not have to be EAD. The EAD calculated can be delivered in a generic Exposure field.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CMA/", "title": "Collectively managed assets", "text": ""}, {"location": "FunctionalDoc/Doc_CMA/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_CMA/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2017/07 cm 338 - 344</li> <li>bcbs266 80(ii) - 80(v)</li> <li>OCre-Finma Art. 118 and 121</li> <li>OFR<ul> <li>Art.66 al.3 let.f bis</li> <li>Appendix 4</li> </ul> </li> <li>CISA (Collective investment scheme act) = LPCC (Loi sur les placements collectifs de capitaux)</li> </ul>"}, {"location": "FunctionalDoc/Doc_CMA/#description", "title": "Description", "text": "<ul> <li>Collectively managed assets (CMA) = Fortunes collectives g\u00e9r\u00e9es (FCG - see OCre-FINMA Art.117)<ol> <li>Collective investment scheme (CIS) - Placements collectifs de capitaux</li> <li>Soci\u00e9t\u00e9 d'investissement sans la restriction ...</li> <li>Portefeuilles collectifs internes ...</li> <li>Fondations constitu\u00e9es selon ...</li> <li>Clubs d'investissement selon ...</li> </ol> </li> <li>So far, only collective investment schemes (CIS, i.e. funds) can be treated with one of the dedicated method for exposure calculation (SA, MBA, FBA, LTA).</li> <li>CMA are expected to be delivered in in <code>core_positions</code> with a corresponding record in <code>list_securities</code>.<ul> <li><code>core_positions.TypeOf = 'Security'</code> </li> <li><code>list_securites.TypeOf in ('CIS','CISOECISA','CISCECISA','CISOENCISA','CISCENCISA')</code></li> <li><code>list_securities.CMAApproachType in ('SA', 'MBA', 'FBA', 'LTA')</code></li> </ul> </li> <li>The selection of an approach for the treatment of CIS is driven by the the field <code>list_securities.CMAApproachType</code> which can take one of the following values:<ul> <li>LTA: Look-through approach</li> <li>MBA: Mandate-based approach</li> <li>FBA: Fall-back approach</li> <li>SA: Simplified approach</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CMA/#look-through-approach-lta", "title": "Look-through approach (LTA)", "text": "<ul> <li>TBD</li> <li>Under this approach, the holdings of the CMA are risk weighted as if they were directly owned by the bank.</li> <li>For each holding of the CMA, one record should be delivered in the table <code>list_underlyings</code> containing<ul> <li>The Id of the CMA (<code>CMAId</code>)</li> <li>The Id of the corresponding holding in the CIS (security, real estate or commodity)</li> <li>The weight or quantity invested this holding<ul> <li>If the weight is delivered, the size of the holding will be computed as the <code>core_positions.BookAmount * core_underlyings.Weight</code><ul> <li>Normalize to make sure the weights add up to 100%</li> </ul> </li> <li>The quantity of underlyings can also be delivered, but it implies that the price of the underlyings is delivered too<ul> <li>Not supported at the moment</li> </ul> </li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CMA/#mandate-based-approach-mba", "title": "Mandate-based approach (MBA)", "text": "<ul> <li>This approach can be used if the LTA cannot be applied.</li> <li>Under this approach, the risk weight applied correspond to the one that would be applied to the asset in the CMA with the highest risk weight.</li> <li>Two options exist to compute the risk weight:<ul> <li>Options 1:         - Deliver in <code>list_securities.SubType</code> either <code>CISEq</code> or <code>CISFI</code> if the asset with the highest risk weight in the fund is an equity or a fixed income instrument. This method is used by default if the data model is fed from a flat file.<ul> <li>If <code>list_securities.SubType = 'CISFI'</code>, the CMA will be risk weighted as if it was a bond, i.e. using the information about the economic sector of the issuer and its rating. Therefore the information about the issuer of the highest risk weighted underlying bond shall be delivered in <code>list_counterparties</code> and in <code>list_securities.IssuerId</code> as well as the rating.</li> <li><code>list_securities.SubType = 'CISEq'</code>, the CMA will be risk weighted as if it was an equity, i.e. 100% or 150% using the information provided in <code>list_securities.ListedFlag</code>.</li> </ul> </li> <li>Option 2 (TBD): <ul> <li>The CMA is proxied by the rikiest asset using the table <code>list_proxy_securities</code>. The  proxy should also exist in the corresponding table (<code>list_securities</code>,<code>list_commodities</code> or <code>core_properties</code>).</li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CMA/#fall-back-approach-fba", "title": "Fall-back approach (FBA)", "text": "<ul> <li>TBD</li> <li>This approach can be used if the LTA and MBA cannot be applied.</li> <li>Fixed risk weight of 1250%.</li> </ul>"}, {"location": "FunctionalDoc/Doc_CMA/#simplified-approach-sa", "title": "Simplified approach (SA)", "text": "<ul> <li>The fields following fields must be delivered in <code>list_securities</code><ul> <li><code>CMARiskIndicator</code></li> <li><code>CMASARwFlag</code> \u2192 deliver 1 for CIS with risk indicators between 5 and 7, eligible for a 250% risk weight as described under cm 352.1.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CMA/#parameters", "title": "Parameters", "text": "<ul> <li><code>FUNDS_APPROACH</code>: Only relevant if using the flat file interface, set to 1 if the simplified approach is used instead of the fall-back approach.</li> </ul>"}, {"location": "FunctionalDoc/Doc_CMA/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_CMA/#list_securities", "title": "list_securities", "text": "<ul> <li>CMAApproachType</li> <li>CMARiskIndicator</li> <li>CMASARwFlag</li> </ul>"}, {"location": "FunctionalDoc/Doc_CMA/#core_underlyings", "title": "core_underlyings", "text": ""}, {"location": "FunctionalDoc/Doc_CMA/#list_proxy_securities", "title": "list_proxy_securities", "text": ""}, {"location": "FunctionalDoc/Doc_CRENettingByIssuer/", "title": "Netting by issuer", "text": ""}, {"location": "FunctionalDoc/Doc_CRENettingByIssuer/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRENettingByIssuer/#legal-references", "title": "Legal references", "text": "<ul> <li>OFR Art. 51 - 52 - 60 - 73</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRENettingByIssuer/#description", "title": "Description", "text": "<ul> <li>If the standard approach for market risk is used (<code>MAR_APPROACH = 'Standard'</code>), positions in the trading book (<code>core_positions.TradingBookFlag = 1</code>) are excluded as they are already accounted for in the market risk.<ul> <li>If the de minimis approach is used for market risk (<code>MAR_APPROACH = 'Minimis'</code>), which relieve the bank from computing the equity and interest rate risk within the market risk framework, positions of the trading book are included in the calculation, but not \"mixed\" with the banking book position during the netting.</li> </ul> </li> <li>On-BS positions on the asset and liability side are included in the calculation as well as derivatives.</li> <li>Process step-by-step:<ol> <li>Compute exposure per issuer and risk weight in <code>v_cre_issuer_exposure</code>.</li> <li>Distribute the exposure in the field <code>core_positions_calc.CAIssuerExposure</code> proportionally to the <code>BookAmount</code> for on-BS positions, and <code>Notional</code> for derivatives.</li> <li><code>CAIssuerExposure</code> is copied into the field <code>CAExposure</code> for securities (not derivatives). This way, the exposure of these positions can be covered during the CRM if the field <code>core_positions.PledgedFlag</code> is equal to 1.</li> <li>To Account for issuer exposure of derivatives, we use the two following fields, which are used for derivatives only:<ul> <li>Field <code>core_positions_calc.CAIssuerRiskWeight</code> \u2192 computed with a Rule based on information of the Issuer of the underlying security</li> <li>Field <code>core_positions_calc.CAIssuerRWA</code> \u2192 computed with view, by multiplying <code>CAIssuerExposure * CAIssuerRiskWeight</code></li> </ul> </li> </ol> </li> <li>What is included in the calculation<ul> <li>OFR Art.51</li> <li>OFR ARt.60 al.2 \u2192 group by issuer and risk weight</li> </ul> </li> <li>What is not included yet in the calculation (done on request of when time allows):<ul> <li>OFR Art.52 / Art.60 al.1 \u2192 specific treatment for investment in financial sector</li> <li>OFR ARt. 73</li> <li>Take into account de-minimis test</li> <li>Nice to have: use RAmount/PAmount for derivatives instead of Notional when available</li> <li>For derivatives, swaps are not taken into account yet. It will have an impact for equity swaps, total return swaps, or any other kind of swaps involving bond or equity.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CREParams/", "title": "CRE parameters", "text": "<ul> <li>CRSABIS_CCF_0: Boolean: Set to 1 to include off-bs positions with CCF of 0 in the reports CRSABIS 1 to 7 and its WP. Deafult value 1.<ul> <li>If set to 0 off-balance sheet positions with a credit conversion factor of 0 will be excluded from the CRSABIS reports. Otherwise, they will be included and displayed in the CCF = 0% column.</li> </ul> </li> <li>RETAIL_TEST_REL_THRESHOLD: Boolean: Set to 1 to consider only retail positions &lt; CHF 1.5mio in the denominator for the 1% threshold. Deafult value 0.<ul> <li>The wording in the OFR Appendix 3 chi.1.2 can be interpretated in two ways: either the 1% threshold applies to all positions against retail counterparties (param value = 0), or the 1% threshold applies to all positions against retail counterparties with an exposure lower than CHF 1.5mio (param value = 1).</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRERiskWeights/", "title": "Risk Weight for credit risk", "text": ""}, {"location": "FunctionalDoc/Doc_CRERiskWeights/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRERiskWeights/#legal-references", "title": "Legal references", "text": "<ul> <li>OFR art.49 al.1 (retail test)</li> <li>OFR art. 31-40</li> <li>OFR appendix 2 &amp; 3</li> <li>OFR new appendix 2 &amp; 3</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRERiskWeights/#description", "title": "Description", "text": "<ul> <li>Risk weights are calculated in the fields <code>core_positions_calc.CARiskWeight</code> and <code>core_positions_calc.CAIssuerRiskWeight</code> (see Netting by issuer for more info on the later).</li> <li>The risk weight can be forced using the field <code>core_module_specifics.CAForceRiskWeight</code></li> </ul>"}, {"location": "FunctionalDoc/Doc_CRERiskWeights/#retail-test", "title": "Retail test", "text": "<ul> <li>The retail test determine if a position against a retail counterparty should be risk weighted at 75% (OFR app.3 chi.1.1) instead of 100% (OFR app.3 1.2). The retail test is passed if the total value of all position against a counterparty, as defined under art.49 al.1, and excluding those covered by a mortgage certificate or mortgage contract, do not exceed:</li> <li>CHF 1.5 mio;</li> <li>1% of all positions on retail positions</li> <li>Remarks:<ul> <li>There are two ways of understanding what should be the denominator in the percentage calculation (see appendix 3 chi.1.1): either all retail positions (default treatment), or the retail positions which do not exceed CHF 1.5mio per counterparty. The second interpretation can be applied by setting the parameter <code>RETAIL_TEST_REL_THRESHOLD</code> to 1 (REL stands for relative).</li> <li>Simplifications:<ul> <li>So far derivatives are not included in the retail test.</li> <li>All mortgages are excluded, and not positions covered by mortgage certificate or mortgage contracts.</li> </ul> </li> </ul> </li> <li>Steps:<ol> <li>Assign the default risk weight in the field <code>core_positions_calc.CARiskWeight</code> with the corresponding rule. All retail positions will get a 100% risk weight. This happens before before the CRM.</li> <li>Compute the total value of all retail positions:<ol> <li>Filter all retail positions. They can be recognized as those where the counterparty meets the following criteria:<ul> <li>Reminder: SME can be defined as:<ul> <li>BaselFramework CRE 20.47 \u2192 Revenue of max EUR 50m</li> <li>OFRNew \u2192 Revenue of max CHF 75m</li> </ul> </li> </ul> </li> <li>Select exposures and prevent liquidities and non performing positions to enter the filter:<ul> <li><code>((cp.LegalAccountNumber &gt; 0 and cp.LegalAccountNumber &lt; 200000 and cp.LegalAccountNumber not in (105001,107001)) or (cp.LegalAccountNumber &gt; 300000 and cp.LegalAccountNumber &lt; 400000)) and cp.NonPerformingFlag = 0 and cpc.AccountGroupLevel1 not in ('Liquidities','MortgageLoans') and cp.TypeOf &lt;&gt; 'Security'</code></li> </ul> </li> <li>Compute the total value of these positions as the sum of <code>core_positions.BookAmount</code></li> </ol> </li> <li>Compute the total value of positions of each retail client<ol> <li>The field used as the retail client group can be selected in the parameter <code>RETAIL_TEST_GROUP</code></li> <li>Compute the total value of these positions by counterparty as the sum of <code>core_positions.BookAmount</code></li> <li>Check if the total value of positions by counterparty is:<ul> <li>Smaller than 1.5 mio</li> <li>Smaller than 1% of the total value of all retail positions</li> </ul> </li> <li>If the test is passed, assign a a value of 0.75 in the field <code>core_positions_calc.CARiskWeight</code></li> </ol> </li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/", "title": "CRM - Capital Adequacy", "text": ""}, {"location": "FunctionalDoc/Doc_CRMCA/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2017/07 cm 191-278</li> <li>bcbs128 (Basel II Framework)</li> <li>OFR Art. 61</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#description", "title": "Description", "text": "<ul> <li>What is usually referred to as CRM (credit risk mitigation) is actually the 4th of the 4 possible allowed methods aimed at mitigating risk which are list below (OFR Art. 61 let. 1):<ol> <li>Legal and contractual netting</li> <li>Guarantees</li> <li>Credit derivatives</li> <li>Other security \u2192 Collateralized transactions</li> </ol> </li> <li>For this method (Collateralized transactions), two approaches are possible: the simple approach (cm 163-190) and the global approach (cm 191-278). We will describe the global approach here.</li> <li>Two formulas exists for different kind of positions:<ul> <li>The first generic one (Finma circ. 2017/07 cm 204)</li> <li>The second for security financing transaction (SFTs) within a netting agreement (Finma circ. 2017/07 cm 278)</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#formula-of-cm-204", "title": "Formula of cm 204", "text": "<p> * Where:     - E \u2192 <code>core_positions_calc.Exposure</code> of exposures. Computed as:         - Off-BS exposures (not derivatives): <code>core_positions.BookAmount * core_positions_calc.CCF</code>         - Off-BS exposures (derivatives): <code>core_derivatives_calc.EAD</code>         - On-BS exposures: <code>core_positions.BookAmount - core_positions.Provision</code>     - S \u2192 <code>core_positions.BookAmount</code> of collaterals     - E* \u2192 <code>core_positions_calc.ExposureAfterCRM</code>     - H<sub>E</sub>, H<sub>C</sub> \u2192 haircut applied on the securities. H<sub>E</sub> is applied on the exposure side and increases the effective exposure.  H<sub>C</sub> is applied on the collateral side and decreases the value of the collateral.     - H<sub>FX</sub> \u2192 cross-currency mismatch haircut of 8%."}, {"location": "FunctionalDoc/Doc_CRMCA/#recognizing-positions-entering-the-crm", "title": "Recognizing positions entering the CRM", "text": ""}, {"location": "FunctionalDoc/Doc_CRMCA/#exposures", "title": "Exposures", "text": "<ul> <li>Include:<ul> <li><code>core_positions_calc.CAExposureFlag = 1</code></li> <li><code>core_positions.PledgedFlag = 1</code></li> </ul> </li> <li>Exclude (to be treated with formula of cm 278):<ul> <li><code>core_positions.SubType in ('SL','SS') and core_positions.NettingSetId != ''</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#collaterals", "title": "Collaterals", "text": "<ul> <li>Include:<ul> <li><code>core_positions_calc.CAEligibilityFlag = 1</code></li> <li><code>core_positions.PledgedFlag = 1</code></li> </ul> </li> <li>Exclude (to be treated with formula of cm 278):<ul> <li><code>core_positions.SubType in ('SB','SP') and core_positions.NettingSetId != ''</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#ordering-for-exposures-and-collaterals", "title": "Ordering for Exposures and Collaterals", "text": "<ul> <li>Suggestion: 2 passes, in pass apply the ordering bellow for exposures and colalterals<ol> <li>First pass: exposures and collaterals in the same currency</li> <li>Second pass: exposure and collaterals in different currencies</li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#exposures_1", "title": "Exposures", "text": "<ul> <li>Take first exposures with the highest value in field <code>core_positions_calc.CARiskWeight</code>.</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#collaterals_1", "title": "Collaterals", "text": "<ul> <li>Take collaterals in this order:<ol> <li><code>core_positions.SubType not in ('Guarantee','CDGuarantee','MortgageCertificate','MortgageContract')</code><ul> <li>Take first those with lower haircut \u2192 <code>core_positions_calc.RegulatoryHaircut</code></li> </ul> </li> <li><code>core_positions.SubType in ('Guarantee','CDGuarantee')</code><ul> <li>Take first those with lower haircut \u2192 <code>core_positions_calc.RegulatoryHaircut</code></li> </ul> </li> <li><code>core_positions.SubType not in ('MortgageCertificate','MortgageContract')</code></li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#formula-cm-278", "title": "Formula cm 278", "text": "<p> * Where:     -  \u2192 absolute avec of the net exposure in a given security     -  \u21a0 absolute value of the net exposure in any currency other than the agreed currency         - The agreed currency (settlement currency) for SLB is delivered in the master record in the field <code>core_positions.Currency</code>. The FX haircut is computed based on the difference between the currency of the security and this currency. For repurchase and reverse-repurchase agreement, the FX haircut is simply based on the difference between the currency of the cash and security record.</p>"}, {"location": "FunctionalDoc/Doc_CRMCA/#recognizing-positions-entering-the-crm_1", "title": "Recognizing positions entering the CRM", "text": ""}, {"location": "FunctionalDoc/Doc_CRMCA/#exposures_2", "title": "Exposures", "text": "<ul> <li>Include:<ul> <li><code>core_positions_calc.CAExposureFlag = 1</code></li> <li><code>core_positions.PledgedFlag = 1</code></li> <li><code>core_positions.SubType in ('SL','SS') and core_positions.NettingSetId != ''</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#collaterals_2", "title": "Collaterals", "text": "<ul> <li>Include:<ul> <li><code>core_positions_calc.CAEligibilityFlag = 1</code></li> <li><code>core_positions.PledgedFlag = 1</code></li> <li><code>core_positions.SubType in ('SB','SP') and core_positions.NettingSetId != ''</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#additional-remarks", "title": "Additional remarks", "text": "<ul> <li>The exposure haircut must be calculated as well as the collateral. The exposure haircut increases the exposure.</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMCA/#remarks-about-exposures", "title": "Remarks about exposures", "text": "<ul> <li>Exposures with a risk weighted assets (RWA) can arise from different sources.<ol> <li>On-BS asset-side positions \u2192 <code>core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 200000</code></li> <li>Off-BS positions \u2192 <code>core_positions.LegalAccountNumber &gt; 300000 and core_positions.LegalAccountNumber &lt; 400000</code><ul> <li>Note that derivatives are not included here, because only the replacement values are delivered in <code>core_positions</code>.</li> </ul> </li> <li>Derivatives - counterparty credit risk \u2192 <code>core_positions.TypeOf = 'Contract' and core_positions.SubType in ('DerExc','DerOTC')</code><ul> <li>Note that the derivatives with a negative replacement value and an exposure will be on the liability side of the BS.</li> </ul> </li> <li>Derivatives - issuer risk \u2192 <code>cp.TypeOf = 'Contract'  and cp.SubType in ('DerOTC','DerExc') and cd.UnderlyingSecurityId != '' and cd.TypeOf != 'CDS'</code>.</li> <li>On-BS securities \u2192 <code>core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 300000 and core_positions.TypeOf = 'Security'</code><ul> <li>Securities enter a netting by issuer, where we end up taking the absolute value of the net position to compute the exposure which is then distributed back onto the underlying securities. It means that securities on the asset and liability side will receive an exposure.</li> </ul> </li> </ol> </li> <li>Remarks:<ul> <li>The exposures described under point 1, 2 and 3 will by default have the field <code>core_positions_calc.AExposureFlag = 1</code>, which means they will be candidate to enter the CRM. It also include the asset-side securities of point 5 (not liability-side securities though).</li> <li>The exposures described under point 1, 2, 3 and 5 have their exposure computed in <code>core_positions_calc.CAExposure</code>, their risk weight in <code>core_positions_calc.CARiskeWeight</code> and their RWA in <code>core_positions_calc.CARWA</code>.</li> <li>The exposures described under point 4 have their exposure computed under <code>core_positions_calc.CAIssuerExposure</code>, their risk weight in <code>core_positions_calc.CAIssuerRiskWeight</code> and their RWA in <code>core_positions_calc.CAIssuerRWA</code>.</li> </ul> </li> </ul> On-BS asset-side positions Off-BS positions Derivatives - counterparty credit risk Derivatives - issuer risk On-BS securities Filter <code>core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 200000</code> <code>core_positions.LegalAccountNumber &gt; 300000 and core_positions.LegalAccountNumber &lt; 400000</code> <code>core_positions.TypeOf = 'Contract' and core_positions.SubType in ('DerExc','DerOTC')</code> <code>cp.TypeOf = 'Contract'  and cp.SubType in ('DerOTC','DerExc') and cd.UnderlyingSecurityId != '' and cd.TypeOf != 'CDS'</code> <code>core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 300000 and core_positions.TypeOf = 'Security'</code> Candidate to enter CRM TRUE TRUE TRUE FALSE TRUE for asset-side securities, FALSE for liability-side securities Exposure field <code>core_positions_calc.CAExposure</code> <code>core_positions_calc.CAExposure</code> <code>core_positions_calc.CAExposure</code> <code>core_positions_calc.CAIssuerExposure</code> <code>core_positions_calc.CAExposure</code> and <code>core_positions_calc.CAIssuerExposure</code> Risk weight field <code>core_positions_calc.CARiskeWeight</code> <code>core_positions_calc.CARiskeWeight</code> <code>core_positions_calc.CARiskeWeight</code> <code>core_positions_calc.CAIssuerRiskWeight</code> <code>core_positions_calc.CARiskeWeight</code> RWA field <code>core_positions_calc.CARWA</code> <code>core_positions_calc.CARWA</code> <code>core_positions_calc.CARWA</code> <code>core_positions_calc.CAIssuerRWA</code> <code>core_positions_calc.CARWA</code> ## Output fields ### core_positions_crm_ca * LoadId * CollateralId * ExposureId * AmountCovered * CollateralAmountUsed * FXHaircut * MaturityHaircut \u2192 Short term solution: set to 0 so far * AdaptedHaircut \u2192 Total haircut applied with adaptation. Short term solution: - If param AdaptedHaircutFlag = 1:  - If param AdaptedHaircutFlag = 0:  * RWA"}, {"location": "FunctionalDoc/Doc_CRMCA/#crm-country-risk-asta", "title": "CRM - Country risk (ASTA)", "text": ""}, {"location": "FunctionalDoc/Doc_CRMCA/#crm-large-exposures", "title": "CRM - Large exposures", "text": ""}, {"location": "FunctionalDoc/Doc_CRMCA/#crm-liq", "title": "CRM - LIQ", "text": ""}, {"location": "FunctionalDoc/Doc_CRMLEX/", "title": "CRM - Capital Adequacy", "text": ""}, {"location": "FunctionalDoc/Doc_CRMLEX/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMLEX/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2017/07 cm 191-278</li> <li>bcbs128 (Basel II Framework)</li> <li>OFR Art. 61</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMLEX/#description", "title": "Description", "text": "<ul> <li>In most ways, the CRM for the large exposure is the same as for capital adequacy: same formula, exposure &amp; collateral recognition and haircuts.<ul> <li>The sections related to treatments which are identical to capital adequacy CRM are not in this document.</li> </ul> </li> <li>A particularity of the large exposure (vs. capital adequacy), is that exposures must be aggregated at the level of the group of counterparty (<code>list_counterparty.GroupLEXId</code> or <code>list_counterparty_groups_lex.Id</code>).</li> <li>Another particularity, is that the exposure reduction toward a counterparty (<code>AmountCovered</code>) in the CRM is always transferred on the group of issuer of the collateral (when applicable, i.e. for securities and guarantee). This logic exists for the capital adequacy CRM, but only for guarantees.<ul> <li>Simplification: some exceptions apply: they are some cases where the exposure does not need to be transferred. But they will be treated in a second step.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMLEX/#ordering-for-exposures-and-collaterals", "title": "Ordering for Exposures and Collaterals", "text": "<ul> <li>Suggestion: 2 passes, in pass apply the ordering bellow for exposures and colalterals<ol> <li>First pass: exposures and collaterals in the same currency</li> <li>Second pass: exposure and collaterals in different currencies</li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMLEX/#exposures", "title": "Exposures", "text": "<ul> <li>Take first exposures with the highest value in field <code>core_positions_calc.CARiskWeight</code>.</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMLEX/#collaterals", "title": "Collaterals", "text": "<ul> <li>Take collaterals in this order:<ol> <li><code>core_positions.SubType not in ('Guarantee','CDGuarantee','MortgageCertificate','MortgageContract')</code><ul> <li>Take first those with lower haircut \u2192 <code>core_positions_calc.RegulatoryHaircut</code></li> </ul> </li> <li><code>core_positions.SubType in ('Guarantee','CDGuarantee')</code><ul> <li>Take first those with lower haircut \u2192 <code>core_positions_calc.RegulatoryHaircut</code></li> </ul> </li> <li><code>core_positions.SubType not in ('MortgageCertificate','MortgageContract')</code></li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMLEX/#formula-cm-278", "title": "Formula cm 278", "text": ""}, {"location": "FunctionalDoc/Doc_CRMLEX/#remarks-about-exposures", "title": "Remarks about exposures", "text": "<ul> <li>Exposures with a risk weighted assets (RWA) can arise from different sources.<ol> <li>On-BS asset-side positions \u2192 <code>core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 200000</code></li> <li>Off-BS positions \u2192 <code>core_positions.LegalAccountNumber &gt; 300000 and core_positions.LegalAccountNumber &lt; 400000</code><ul> <li>Note that derivatives are not included here, because only the replacement values are delivered in <code>core_positions</code>.</li> </ul> </li> <li>Derivatives - counterparty credit risk \u2192 <code>core_positions.TypeOf = 'Contract' and core_positions.SubType in ('DerExc','DerOTC')</code><ul> <li>Note that the derivatives with a negative replacement value and an exposure will be on the liability side of the BS.</li> </ul> </li> <li>Derivatives - issuer risk \u2192 <code>cp.TypeOf = 'Contract'  and cp.SubType in ('DerOTC','DerExc') and cd.UnderlyingSecurityId != '' and cd.TypeOf != 'CDS'</code>.</li> <li>On-BS securities \u2192 <code>core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 300000 and core_positions.TypeOf = 'Security'</code><ul> <li>Securities enter a netting by issuer, where we end up taking the absolute value of the net position to compute the exposure which is then distributed back onto the underlying securities. It means that securities on the asset and liability side will receive an exposure.</li> </ul> </li> </ol> </li> <li>Remarks:<ul> <li>The exposures described under point 1, 2 and 3 will by default have the field <code>core_positions_calc.AExposureFlag = 1</code>, which means they will be candidate to enter the CRM. It also include the asset-side securities of point 5 (not liability-side securities though).</li> <li>The exposures described under point 1, 2, 3 and 5 have their exposure computed in <code>core_positions_calc.CAExposure</code>, their risk weight in <code>core_positions_calc.CARiskeWeight</code> and their RWA in <code>core_positions_calc.CARWA</code>.</li> <li>The exposures described under point 4 have their exposure computed under <code>core_positions_calc.CAIssuerExposure</code>, their risk weight in <code>core_positions_calc.CAIssuerRiskWeight</code> and their RWA in <code>core_positions_calc.CAIssuerRWA</code>.</li> </ul> </li> </ul> On-BS asset-side positions Off-BS positions Derivatives - counterparty credit risk Derivatives - issuer risk On-BS securities Filter <code>core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 200000</code> <code>core_positions.LegalAccountNumber &gt; 300000 and core_positions.LegalAccountNumber &lt; 400000</code> <code>core_positions.TypeOf = 'Contract' and core_positions.SubType in ('DerExc','DerOTC')</code> <code>cp.TypeOf = 'Contract'  and cp.SubType in ('DerOTC','DerExc') and cd.UnderlyingSecurityId != '' and cd.TypeOf != 'CDS'</code> <code>core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 300000 and core_positions.TypeOf = 'Security'</code> Candidate to enter CRM TRUE TRUE TRUE FALSE TRUE for asset-side securities, FALSE for liability-side securities Exposure field <code>core_positions_calc.CAExposure</code> <code>core_positions_calc.CAExposure</code> <code>core_positions_calc.CAExposure</code> <code>core_positions_calc.CAIssuerExposure</code> <code>core_positions_calc.CAExposure</code> and <code>core_positions_calc.CAIssuerExposure</code> Risk weight field <code>core_positions_calc.CARiskeWeight</code> <code>core_positions_calc.CARiskeWeight</code> <code>core_positions_calc.CARiskeWeight</code> <code>core_positions_calc.CAIssuerRiskWeight</code> <code>core_positions_calc.CARiskeWeight</code> RWA field <code>core_positions_calc.CARWA</code> <code>core_positions_calc.CARWA</code> <code>core_positions_calc.CARWA</code> <code>core_positions_calc.CAIssuerRWA</code> <code>core_positions_calc.CARWA</code> ## Output fields ### core_positions_crm_ca * LoadId * CollateralId * ExposureId * AmountCovered * CollateralAmountUsed * FXHaircut * MaturityHaircut \u2192 Short term solution: set to 0 so far * AdaptedHaircut \u2192 Total haircut applied with adaptation. Short term solution: - If param AdaptedHaircutFlag = 1:  - If param AdaptedHaircutFlag = 0:  * RWA"}, {"location": "FunctionalDoc/Doc_CRMLEX/#crm-country-risk-asta", "title": "CRM - Country risk (ASTA)", "text": ""}, {"location": "FunctionalDoc/Doc_CRMLEX/#crm-large-exposures", "title": "CRM - Large exposures", "text": ""}, {"location": "FunctionalDoc/Doc_CRMLEX/#crm-liq", "title": "CRM - LIQ", "text": ""}, {"location": "FunctionalDoc/Doc_CRMMona/", "title": "CRM - MONA", "text": ""}, {"location": "FunctionalDoc/Doc_CRMMona/#legal-references", "title": "Legal references", "text": "<ul> <li>MONA Notes:   </li> <li>Finma circ. 2020/01 appendix 4 cm 32   </li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMMona/#description", "title": "Description", "text": "<ul> <li>Order of treatment depending on Legal Account Number</li> <li>Amounts due from customers (104xxx)</li> <li>Amounts due from Security financing transactions (102xxx)</li> <li>Amounts due from Other Instrument evaluated at Fair Value' (108xxx)</li> <li>What we need to know: 1. What is the amount covered - What amount is covered by mortgage contracts (hypoth\u00e8que) - If the counterparty is a public sector entity 2. What is the amount not covered</li> </ul> <p> - MONA_US (Par secteurs des postes du bilan):</p> <p></p> <ul> <li>We don't apply any haircut</li> <li>Main characteristics of the treatment</li> <li>Exposures = Due from customers AND PledgeFlag = 1 \u2192 LegalAccountNumber starts with 104</li> <li>Eligible Collaterals = Any collateral that is pledged (core_positions.PledgedFlaged = 1 &amp; CollateralHolderId != '')</li> <li>Link exposures and eligible collaterals with the fields:<ul> <li>core_positions.CounterpartyId of the exposure</li> <li>core_positions.CollateralHolderId of the collateral</li> </ul> </li> <li>We distribute and cover due from customer positions with title deeds first, then we cover the rest of the exposures with the other collaterals.</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMMona/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_CRMMona/#core_positions", "title": "core_positions", "text": "<ul> <li>LegalAccountNumber</li> <li>CounterpartyId</li> <li>CollateralHolderId</li> <li>PledgedFlag</li> <li>TypeOf</li> <li>SubType</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMMona/#output-fields", "title": "Output fields", "text": ""}, {"location": "FunctionalDoc/Doc_CRMMona/#core_positions_calc", "title": "core_positions_calc", "text": "<ul> <li>MonaExposure \u2192 filled on exposure side</li> <li>MonaExposureAfterCRM \u2192 filled on exposure side</li> <li>MonaCollateralUsedAmount \u2192 filled on collateral side</li> </ul>"}, {"location": "FunctionalDoc/Doc_CRMMona/#core_positions_crm_mona", "title": "core_positions_crm_mona", "text": "<ul> <li>LoadId</li> <li>CollateralId (CoverId)</li> <li>ExposureId (LoanId)</li> <li>AmountCovered</li> <li>CollateralTypeOf</li> <li>CollateralSubType</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/", "title": "Credit valuation adjustment", "text": ""}, {"location": "FunctionalDoc/Doc_CVA/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2017/07 cm 487-518</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#description", "title": "Description", "text": "<ul> <li>Credit valuation risk (CVA) risk is the risk of suffering losses on the market value of derivatives, because of changes in the  creditworthiness of the counterparty. In other words, the CVA in the regulatory framework is the cost of counterparty creditworthiness volatility (see document CVA VaR Explained).</li> <li>Without going into math/fnancial details, the capital charge is computed as the 1-year 99% Value at Risk (VaR) of the market value of derivatives expressed in function of the creditworthiness of the counterparties. The 1-year 99% VaR is equivalent to the minimum loss that will be exceeded over a one year time horizon, with a probability of 1%<ul> <li>Every year, there is a 1% chance that this level of loss is exceeded</li> <li>Statistically every 100 years, this level of loss is exceeded</li> </ul> </li> <li>Positions included:<ul> <li>Derivatives<ul> <li><code>core_positions.TypeOf = 'Contract' and core_positions.SubType in ('DerExc','DerOTC')</code></li> </ul> </li> </ul> </li> <li>Positions not included:<ul> <li>Those guaranteed by a central counterparty<ul> <li><code>list_counterparties.TypeOf in ('CCP','QCCP')</code> \u2192 link on list_counterparties through <code>core_positions.CounterpartyId</code></li> </ul> </li> <li>Those internal to the group<ul> <li><code>lcg.TypeOf = 'G' from list_counterparties lc inner join list_counterparty_groups_lex lcg on lc.GroupLEX = lcg.ID</code></li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#advanced-approach", "title": "Advanced approach", "text": "<ul> <li>Not supported</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#simplified-approach", "title": "Simplified approach", "text": "<ul> <li>Not supported</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#standard-approach", "title": "Standard approach", "text": "<ul> <li>Capital requirement (K):<ul> <li> , where:<ul> <li>i = counterparty i</li> <li>Counterparty (i) / Reference entity level of aggregation:<ul> <li>   = approximation of the standard deviation of value fluctuations due to CVA risks for counterparty i (<code>list_counterparties.Id</code>), where:<ul> <li>Counterparty level aggregation \u2192 <code>core_positions.CounterpartyId</code><ul> <li>  = weighting of counterparty i as defined under cm 511</li> <li>Field <code>list_counterparties.CVAWeight</code></li> <li>Netting set level of aggregation (j) \u2192 Note: if a derivative is not subject to a recognized netting agreement (<code>core_positions.NettingAgreementType not in ('CN','NbN')</code>), the netting set contains only the derivative itself. In this case, let's use the field <code>core_positions.Id</code> as the netting set id:<ul> <li>  = exposure at default of netting set j. Can be either computed with the current exposure method (CEM) or standard approach (SA-CCR).</li> <li> <ul> <li>Residual duration in years: <code>core_positions_calc.ResidualDurationDays/360</code></li> <li>Nominal used for weighting: <code>core_positions.Notional</code></li> </ul> </li> <li> </li> </ul> </li> </ul> </li> <li>\u2193 \u2193 \u2193 \u2193 \u2193 Optional \u2193 \u2193 \u2193 \u2193 \u2193</li> <li>Reference entity level of aggregation \u2192 <code>core_derivatives.ReferenceEntityId</code> \u2192 CDS protection bought can be recognized as: <code>core_positions.TypeOf = 'Contract' and core_positions.SubType = ('DerExc','DerOTC') and core_positions.LongContractFlag = 1 and core_derivatives.TypeOf = 'CDS' and core_derivatives.ReferenceEntityId != ''</code><ul> <li>  = Nominal amount of CDS position h used as protection against CVA risk of counterparty i<ul> <li>Nominal amount: <code>core_positions.Notional</code></li> <li>CDS protection against counterpart i: <code>core_derivatives.ReferenceEntityId = Counterpartyi</code></li> </ul> </li> <li>  = residual duration in years of credit protection of nominal amount  \u2192 <code>core_positions_calc.ResidualDurationDays/360</code></li> <li> </li> </ul> </li> </ul> </li> </ul> </li> <li>Index (ind) \u2192 Protection bought through CDS on index can be recognized as: <code>core_positions.TypeOf = 'Contract' and core_positions.SubType = ('DerExc','DerOTC') and core_positions.LongContractFlag = 1 and core_derivatives.TypeOf = 'CDS' and core_derivatives.UnderlyingSecurityId != '' and list_securities.IndexFlag = 1</code><ul> <li>  = approximation of the standard deviation of value fluctuations for bought protection through CDS on index ind, where:<ul> <li>  = weighting applied on CDS protection on index ind as defined under cm 511. The weighting is based on the average spread \u2192 The \"spread\" of a CDS is the annual amount the protection buyer must pay the protection seller over the length of the contract, expressed as a percentage of the notional amount.<ul> <li>How to choose the weighting using the spread ??  to discuss with JMM </li> </ul> </li> <li>  = Nominal amount of CDS protection on index ind used as protection against CVA risk of counterparty i \u2192 <code>core_positions.Notional</code></li> <li>  = residual duration in years of credit protection of nominal amount  \u2192 <code>core_positions_calc.ResidualDurationDays/360</code></li> <li> </li> <li>\u2191 \u2191 \u2191 \u2191 \u2191 Optional \u2191 \u2191 \u2191 \u2191 \u2191</li> </ul> </li> </ul> </li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#suggestion-for-the-design-of-the-technical-solution", "title": "Suggestion for the design of the technical solution", "text": "<ul> <li>One table/view for each level of granularity with the following values<ul> <li>Netting set level (could be the same table/view used for CEM/SA-CCR)<ul> <li>Id (of netting set \u2192 either NettingSetId if there is a netting agreement or core_positions.Id if there is not)</li> <li>EAD</li> <li> </li> <li> </li> </ul> </li> <li>Position level for all CDS protection bought on reference entities (vs index)<ul> <li>Id (of position)</li> <li> </li> <li> </li> <li> </li> <li>ReferenceEntityId</li> </ul> </li> <li>Counterparty level<ul> <li>Id (counterparty)</li> <li> </li> <li> </li> </ul> </li> <li>Highest level<ul> <li> </li> <li> </li> <li>K </li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_CVA/#core_positions", "title": "core_positions", "text": "<ul> <li>CounterpartyId</li> <li>Notional</li> <li>TypeOf</li> <li>SubTypeOf</li> <li>LongContractFlag</li> <li>NettingAgreementType</li> <li>NettingSetId</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#core_positions_1", "title": "core_positions", "text": "<ul> <li>ResidualDurationDays</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#list_derivatives", "title": "list_derivatives", "text": "<ul> <li>TypeOf</li> <li>UnderlyingSecurityId</li> <li>ReferenceEntityId</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#list_securities", "title": "list_securities", "text": "<ul> <li>IndexFlag</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#output-fields", "title": "Output fields", "text": ""}, {"location": "FunctionalDoc/Doc_CVA/#list_counterparies", "title": "list_counterparies", "text": "<ul> <li>CVAWeight</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#v_netting_set-one-entry-per-positions", "title": "v_netting_set \u2192 one entry per positions", "text": "<ul> <li>Id (of position)</li> <li>LoadId</li> <li>NettingSetId</li> <li>CounterpartyId</li> <li>CounterpartyPIT</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#v_netting_set_sum_notional-one-entry-per-netting-set", "title": "v_netting_set_sum_notional \u2192 one entry per netting set", "text": "<ul> <li>NettingSetId</li> <li>LoadId</li> <li>CounterpartyId</li> <li>CounterpartyPIT</li> <li>sumNotional</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#v_cre_cem_netting_set_level", "title": "v_cre_cem_netting_set_level", "text": "<ul> <li>lcId</li> <li>Id (of netting set)</li> <li>NettingAgreement</li> <li>SumNotional</li> <li>SumPFE</li> <li>SumPRV</li> <li>NetRV</li> <li>EAD</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#v_cre_cva_netting_level", "title": "v_cre_cva_netting_level", "text": "<ul> <li>lcId</li> <li>Id (of netting set)</li> <li>Mj</li> <li>Dj</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#v_cre_cva_counterparty_level", "title": "v_cre_cva_counterparty_level", "text": "<ul> <li>lcId</li> <li>Id (of counterparty)</li> <li>Wi</li> <li>Si</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#v_cre_cva_cds_level", "title": "v_cre_cva_cds_level", "text": "<ul> <li>lcId</li> <li>Id (of counterparty)</li> <li>Ng</li> <li>Mh</li> <li>Dh</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA/#v_cre_cva_top_level", "title": "v_cre_cva_top_level", "text": "<ul> <li>lcId </li> <li>sumSi</li> <li>sumSi2</li> <li>Sind</li> <li>K </li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/", "title": "Doc CVA B4", "text": ""}, {"location": "FunctionalDoc/Doc_CVA_B4/#used-in-the-following-modules", "title": "Used in the following modules", "text": ""}, {"location": "FunctionalDoc/Doc_CVA_B4/#used-in-the-following-modules_1", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2017/07 cm 487-518</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#description", "title": "Description", "text": "<ul> <li>Credit valuation risk (CVA) risk is the risk of suffering losses on the market value of derivatives, because of changes in the  creditworthiness of the counterparty. In other words, the CVA in the regulatory framework is the cost of counterparty creditworthiness volatility (see document CVA VaR Explained).</li> <li>Without going into math/fnancial details, the capital charge is computed as the 1-year 99% Value at Risk (VaR) of the market value of derivatives expressed in function of the creditworthiness of the counterparties. The 1-year 99% VaR is equivalent to the minimum loss that will be exceeded over a one year time horizon, with a probability of 1%<ul> <li>Every year, there is a 1% chance that this level of loss is exceeded</li> <li>Statistically every 100 years, this level of loss is exceeded</li> </ul> </li> <li>Positions included:<ul> <li>Derivatives<ul> <li><code>core_positions.TypeOf = 'Contract' and core_positions.SubType in ('DerExc','DerOTC')</code></li> </ul> </li> </ul> </li> <li>Positions not included:<ul> <li>Those guaranteed by a central counterparty<ul> <li><code>list_counterparties.TypeOf in ('CCP','QCCP')</code> \u2192 link on list_counterparties through <code>core_positions.CounterpartyId</code></li> </ul> </li> <li>Those internal to the group<ul> <li><code>lcg.TypeOf = 'G' from list_counterparties lc inner join list_counterparty_groups_lex lcg on lc.GroupLEX = lcg.ID</code></li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#advanced-approach", "title": "Advanced approach", "text": "<ul> <li>Not supported</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#simplified-approach", "title": "Simplified approach", "text": "<ul> <li>Not supported</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#standard-approach", "title": "Standard approach", "text": "<ul> <li>Capital requirement (K):<ul> <li> , where:<ul> <li>i = counterparty i</li> <li>Counterparty (i) / Reference entity level of aggregation:<ul> <li>   = approximation of the standard deviation of value fluctuations due to CVA risks for counterparty i (<code>list_counterparties.Id</code>), where:<ul> <li>Counterparty level aggregation \u2192 <code>core_positions.CounterpartyId</code><ul> <li>  = weighting of counterparty i as defined under cm 511</li> <li>Field <code>list_counterparties.CVAWeight</code></li> <li>Netting set level of aggregation (j) \u2192 Note: if a derivative is not subject to a recognized netting agreement (<code>core_positions.NettingAgreementType not in ('CN','NbN')</code>), the netting set contains only the derivative itself. In this case, let's use the field <code>core_positions.Id</code> as the netting set id:<ul> <li>  = exposure at default of netting set j. Can be either computed with the current exposure method (CEM) or standard approach (SA-CCR).</li> <li> <ul> <li>Residual duration in years: <code>core_positions_calc.ResidualDurationDays/360</code></li> <li>Nominal used for weighting: <code>core_positions.Notional</code></li> </ul> </li> <li> </li> </ul> </li> </ul> </li> <li>\u2193 \u2193 \u2193 \u2193 \u2193 Optional \u2193 \u2193 \u2193 \u2193 \u2193</li> <li>Reference entity level of aggregation \u2192 <code>core_derivatives.ReferenceEntityId</code> \u2192 CDS protection bought can be recognized as: <code>core_positions.TypeOf = 'Contract' and core_positions.SubType = ('DerExc','DerOTC') and core_positions.LongContractFlag = 1 and core_derivatives.TypeOf = 'CDS' and core_derivatives.ReferenceEntityId != ''</code><ul> <li>  = Nominal amount of CDS position h used as protection against CVA risk of counterparty i<ul> <li>Nominal amount: <code>core_positions.Notional</code></li> <li>CDS protection against counterpart i: <code>core_derivatives.ReferenceEntityId = Counterpartyi</code></li> </ul> </li> <li>  = residual duration in years of credit protection of nominal amount  \u2192 <code>core_positions_calc.ResidualDurationDays/360</code></li> <li> </li> </ul> </li> </ul> </li> </ul> </li> <li>Index (ind) \u2192 Protection bought through CDS on index can be recognized as: <code>core_positions.TypeOf = 'Contract' and core_positions.SubType = ('DerExc','DerOTC') and core_positions.LongContractFlag = 1 and core_derivatives.TypeOf = 'CDS' and core_derivatives.UnderlyingSecurityId != '' and list_securities.IndexFlag = 1</code><ul> <li>  = approximation of the standard deviation of value fluctuations for bought protection through CDS on index ind, where:<ul> <li>  = weighting applied on CDS protection on index ind as defined under cm 511. The weighting is based on the average spread \u2192 The \"spread\" of a CDS is the annual amount the protection buyer must pay the protection seller over the length of the contract, expressed as a percentage of the notional amount.<ul> <li>How to choose the weighting using the spread ??  to discuss with JMM </li> </ul> </li> <li>  = Nominal amount of CDS protection on index ind used as protection against CVA risk of counterparty i \u2192 <code>core_positions.Notional</code></li> <li>  = residual duration in years of credit protection of nominal amount  \u2192 <code>core_positions_calc.ResidualDurationDays/360</code></li> <li> </li> <li>\u2191 \u2191 \u2191 \u2191 \u2191 Optional \u2191 \u2191 \u2191 \u2191 \u2191</li> </ul> </li> </ul> </li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#suggestion-for-the-design-of-the-technical-solution", "title": "Suggestion for the design of the technical solution", "text": "<ul> <li>One table/view for each level of granularity with the following values<ul> <li>Netting set level (could be the same table/view used for CEM/SA-CCR)<ul> <li>Id (of netting set \u2192 either NettingSetId if there is a netting agreement or core_positions.Id if there is not)</li> <li>EAD</li> <li> </li> <li> </li> </ul> </li> <li>Position level for all CDS protection bought on reference entities (vs index)<ul> <li>Id (of position)</li> <li> </li> <li> </li> <li> </li> <li>ReferenceEntityId</li> </ul> </li> <li>Counterparty level<ul> <li>Id (counterparty)</li> <li> </li> <li> </li> </ul> </li> <li>Highest level<ul> <li> </li> <li> </li> <li>K </li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_CVA_B4/#core_positions", "title": "core_positions", "text": "<ul> <li>CounterpartyId</li> <li>Notional</li> <li>TypeOf</li> <li>SubTypeOf</li> <li>LongContractFlag</li> <li>NettingAgreementType</li> <li>NettingSetId</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#core_positions_1", "title": "core_positions", "text": "<ul> <li>ResidualDurationDays</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#list_derivatives", "title": "list_derivatives", "text": "<ul> <li>TypeOf</li> <li>UnderlyingSecurityId</li> <li>ReferenceEntityId</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#list_securities", "title": "list_securities", "text": "<ul> <li>IndexFlag</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#output-fields", "title": "Output fields", "text": ""}, {"location": "FunctionalDoc/Doc_CVA_B4/#list_counterparies", "title": "list_counterparies", "text": "<ul> <li>CVAWeight</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#v_netting_set-one-entry-per-positions", "title": "v_netting_set \u2192 one entry per positions", "text": "<ul> <li>Id (of position)</li> <li>LoadId</li> <li>NettingSetId</li> <li>CounterpartyId</li> <li>CounterpartyPIT</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#v_netting_set_sum_notional-one-entry-per-netting-set", "title": "v_netting_set_sum_notional \u2192 one entry per netting set", "text": "<ul> <li>NettingSetId</li> <li>LoadId</li> <li>CounterpartyId</li> <li>CounterpartyPIT</li> <li>sumNotional</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#v_cre_cem_netting_set_level", "title": "v_cre_cem_netting_set_level", "text": "<ul> <li>lcId</li> <li>Id (of netting set)</li> <li>NettingAgreement</li> <li>SumNotional</li> <li>SumPFE</li> <li>SumPRV</li> <li>NetRV</li> <li>EAD</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#v_cre_cva_netting_level", "title": "v_cre_cva_netting_level", "text": "<ul> <li>lcId</li> <li>Id (of netting set)</li> <li>Mj</li> <li>Dj</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#v_cre_cva_counterparty_level", "title": "v_cre_cva_counterparty_level", "text": "<ul> <li>lcId</li> <li>Id (of counterparty)</li> <li>Wi</li> <li>Si</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#v_cre_cva_cds_level", "title": "v_cre_cva_cds_level", "text": "<ul> <li>lcId</li> <li>Id (of counterparty)</li> <li>Ng</li> <li>Mh</li> <li>Dh</li> </ul>"}, {"location": "FunctionalDoc/Doc_CVA_B4/#v_cre_cva_top_level", "title": "v_cre_cva_top_level", "text": "<ul> <li>lcId </li> <li>sumSi</li> <li>sumSi2</li> <li>Sind</li> <li>K </li> </ul>"}, {"location": "FunctionalDoc/Doc_Conso/", "title": "Consolidation", "text": ""}, {"location": "FunctionalDoc/Doc_Conso/#used-in-the-following-modules", "title": "Used in the following modules", "text": ""}, {"location": "FunctionalDoc/Doc_Conso/#legal-references", "title": "Legal references", "text": ""}, {"location": "FunctionalDoc/Doc_Conso/#description", "title": "Description", "text": ""}, {"location": "FunctionalDoc/Doc_Conso/#principles-for-consolidation-elimination", "title": "Principles for consolidation &amp; Elimination", "text": "<ul> <li>Rules for selecting the positions to report and to eliminate depending on the consolidation level:<ul> <li>BankOffice:<ul> <li>Report positions of booking centers (core_positions.BookingCenterId) in (CH,LI) (list_booking_centers.OfficeCountry) which have the following type of office (list_booking_centers.OfficeType):<ul> <li>FinancialHolding</li> <li>HeadOffice</li> <li>Branch (Sucursale)</li> <li>RepresentationOffice (part of Branch)</li> <li>Agency (part of Branch)</li> </ul> </li> <li>Eliminate positions where the counterparty is a booking center (core_positions.CounterpartyBookingCenterId) with the same characteristics as above</li> </ul> </li> <li>ParentCompany<ul> <li>Report positions of booking centers (core_positions.BookingCenterId) in any country (list_booking_centers.OfficeCountry) which have the following type of office (list_booking_centers.OfficeType):<ul> <li>FinancialHolding</li> <li>HeadOffice</li> <li>Branch (Sucursale)</li> <li>RepresentationOffice (part of Branch)</li> <li>Agency (part of Branch)</li> </ul> </li> <li>Eliminate positions where the counterparty is a booking center (core_positions.CounterpartyBookingCenterId) with the same characteristics as above</li> </ul> </li> <li>Group<ul> <li>Report positions of all booking centers (core_positions.BookingCenterId) in any country (list_booking_centers.OfficeCountry) which have any type of office (list_booking_centers.OfficeType) \u2192 Subsidiary (Filliale) added compared to ParentCompany</li> <li>Eliminate all positions where the counterparty is a booking center (core_positions.CounterpartyBookingCenterId)</li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_Conso/#workflow-for-rt01-input", "title": "Workflow for RT01 input", "text": "<ol> <li>User imports RT01</li> <li>Mercury fills table list_reporting_entities \u2192 one line for each unique combination of Entity and EntityType = \"CH\"<ul> <li>Id \u2192 Entity </li> <li>SNBCode empty</li> <li>ConsoLevelBankOffice, ConsoLevelParentCompany, ConsoLevelGroup set to TRUE by default</li> </ul> </li> <li>Mercury fills table list_booking_centers \u2192 one line for each Entity<ul> <li>Id (unique) \u2192 Entity </li> <li>OfficeType / OfficeCountry \u2192 EntityType through mapping (see document Interface_RT01-QDL)</li> <li>OfficeCountry \u2192 CounterpartyDomicile (if not inferred from EntityType) </li> <li>By default, fill the field OwnerId with the Id of of the first entry of list_reporting_entities</li> </ul> </li> <li>Mercury fills table list_reporting_sets<ul> <li>ReportingEntity (pk) \u2192 list_reporting_entities.Id</li> <li>ConsolidatedBookingCenterId (pk) \u2192 list_booking_centers.Id which have ReportingEntity as the OwnerId in list_booking_centers</li> <li>ConsolidatedBookingCenterOfficeType:<ul> <li><code>HeadOffice</code> when ReportingEntity = ConsolidatedBookingCenterId</li> <li><code>Branch</code> when list_booking_centers.OfficeType = Branch</li> <li><code>Subsidiary</code> when list_booking_centers.OfficeType = Subsidiary</li> </ul> </li> </ul> </li> <li>User amends tables list_reporting_entities, list_booking_centers, list_reporting_sets</li> <li>User launch calculation on a load collection and must choose the ReportingEntity for that load collection if empty<ul> <li>Each load collection has its set of reports</li> </ul> </li> </ol>"}, {"location": "FunctionalDoc/Doc_Conso/#filtering-in-the-reports", "title": "Filtering in the reports:", "text": ""}, {"location": "FunctionalDoc/Doc_Conso/#consolidation-level-bankoffice", "title": "Consolidation level BankOffice", "text": "<pre><code>\nselect * from core_positions cp inner join core_positions_calc cpc\non cp.Id = cpc.Id and cp.LoadId = cpc.LoadId\nwhere cp.BookingCenterId in (\n    select ConsolidatedBookingCenterId from\n    list_reporting_sets lrs inner join core_load_collections clc\n    on lrs.ReportingEntityId = clc.ReportingEntityId\n    where lrs.OfficeType in ('FinancialHolding','HeadOffice','Branch','Agency','RepresentationOffice')\n    and lrs.OfficeCountry in ('CH','LI')\n    and clc.LoadCollectionId in\n        (select core_loads_loads_collection.LoadCollectionsLoadCollectionId from \n        core_loads_loads_collection cllc inner join core_positions cp\n        on cllc.LoadsLoadId = core_positions.LoadId)\nand cp.CounterpartyBookingCenterId not in (\n    select ConsolidatedBookingCenterId from\n    list_reporting_sets lrs inner join core_load_collections clc\n    on lrs.ReportingEntityId = clc.ReportingEntityId\n    where lrs.OfficeType in ('FinancialHolding','HeadOffice','Branch','Agency','RepresentationOffice')\n    and lrs.OfficeCountry in ('CH','LI')\n    and clc.LoadCollectionId in\n        (select core_loads_loads_collection.LoadCollectionsLoadCollectionId from \n        core_loads_loads_collection cllc inner join core_positions cp\n        on cllc.LoadsLoadId = core_positions.LoadId) \n </code></pre>"}, {"location": "FunctionalDoc/Doc_Conso/#consolidation-level-parentcompany", "title": "Consolidation level ParentCompany", "text": "<pre><code>\nselect * from core_positions cp inner join core_positions_calc cpc\non cp.Id = cpc.Id and cp.LoadId = cpc.LoadId\nwhere cp.BookingCenterId in (\n    select ConsolidatedBookingCenterId from\n    list_reporting_sets lrs inner join core_load_collections clc\n    on lrs.ReportingEntityId = clc.ReportingEntityId\n    where lrs.OfficeType in ('FinancialHolding','HeadOffice','Branch','Agency','RepresentationOffice')\n    and clc.LoadCollectionId in\n        (select core_loads_loads_collection.LoadCollectionsLoadCollectionId from \n        core_loads_loads_collection cllc inner join core_positions cp\n        on cllc.LoadsLoadId = core_positions.LoadId)\nand cp.CounterpartyBookingCenterId not in (\n    select ConsolidatedBookingCenterId from\n    list_reporting_sets lrs inner join core_load_collections clc\n    on lrs.ReportingEntityId = clc.ReportingEntityId\n    where lrs.OfficeType in ('FinancialHolding','HeadOffice','Branch','Agency','RepresentationOffice')\n    and clc.LoadCollectionId in\n        (select core_loads_loads_collection.LoadCollectionsLoadCollectionId from \n        core_loads_loads_collection cllc inner join core_positions cp\n        on cllc.LoadsLoadId = core_positions.LoadId)  \n </code></pre>"}, {"location": "FunctionalDoc/Doc_Conso/#consolidation-level-group", "title": "Consolidation level Group", "text": "<pre><code>\nselect * from core_positions cp inner join core_positions_calc cpc\non cp.Id = cpc.Id and cp.LoadId = cpc.LoadId\nwhere cp.CounterpartyBookingCenterId not in (\n    select ConsolidatedBookingCenterId from\n    list_reporting_sets lrs inner join core_load_collections clc\n    on lrs.ReportingEntityId = clc.ReportingEntityId\n    where lrs.OfficeType in ('FinancialHolding','HeadOffice','Branch','Agency','RepresentationOffice','Subsidiary')\n    and clc.LoadCollectionId in\n        (select core_loads_loads_collection.LoadCollectionsLoadCollectionId from \n        core_loads_loads_collection cllc inner join core_positions cp\n        on cllc.LoadsLoadId = core_positions.LoadId)  \n </code></pre>"}, {"location": "FunctionalDoc/Doc_Conso/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_Conso/#core_positions", "title": "core_positions", "text": "<ul> <li>BookingCenterId</li> <li>CounterpartyBookingCenterId</li> </ul>"}, {"location": "FunctionalDoc/Doc_Conso/#core_load_collections", "title": "core_load_collections", "text": "<ul> <li>LoadCollectionId</li> <li>CreateDate</li> <li>ReportingDate</li> <li>Name</li> <li>ReportingEntityId</li> </ul>"}, {"location": "FunctionalDoc/Doc_Conso/#core_loads_loads_collection", "title": "core_loads_loads_collection", "text": "<ul> <li>LoadCollectionsLoadCollectionId</li> <li>LoadsLoadId</li> </ul>"}, {"location": "FunctionalDoc/Doc_Conso/#list_booking_centers", "title": "list_booking_centers", "text": "<ul> <li>Id</li> <li>OfficeType</li> <li>OfficeCountry</li> <li>OfficeCanton</li> <li>OwnerId</li> </ul>"}, {"location": "FunctionalDoc/Doc_Conso/#list_reporting_entities", "title": "list_reporting_entities", "text": "<ul> <li>Id</li> <li>SNBCode</li> <li>ConsoLevelBankOffice</li> <li>ConsoLevelParentCompany</li> <li>ConsoLevelGroup</li> </ul>"}, {"location": "FunctionalDoc/Doc_Conso/#output-fields", "title": "Output fields", "text": ""}, {"location": "FunctionalDoc/Doc_Conso/#list_reporting_set", "title": "list_reporting_set", "text": "<ul> <li>ReportingEntityId</li> <li>ConsolidatedBookingCenterId</li> <li>OfficeType</li> <li>OfficeCountry</li> </ul>"}, {"location": "FunctionalDoc/Doc_Derivatives/", "title": "Derivatives", "text": ""}, {"location": "FunctionalDoc/Doc_Derivatives/#delivery", "title": "Delivery", "text": "<ul> <li>Each derivatives has one record in <code>core_positions</code> and a corresponding record in <code>core_derivatives</code> or <code>core_derivatives_swaps</code><ul> <li>Possibility to have 2 records in <code>core_positions</code> if interfacing from RT01 file. See next section.</li> </ul> </li> <li><code>core_derivatives_swaps</code> is the container for IRS, CCS and other swaps which involve two sets of cash flows (total return swaps, commodity swaps, etc.). All other derivatives are delivered in <code>core_derivatives</code> (including CDS).</li> <li>The fields which are central for derivatives in <code>core_positions</code> are listed below (it does not mean that the other fields should not be delivered or are unimportant).<ul> <li><code>LegalAccountNumber</code>: 107001 for positive replacement values and 205001 for negative replacement values of derivatives which are booked on-balance sheet. 0 Otherwise.</li> <li><code>Account</code>: 107001 for positive replacement values and 205001 for negative replacement values. Should always be delivered.</li> <li><code>BookAmount</code>: replacement value in reporting currency.</li> <li><code>Notional</code>: notional in reporting currency.</li> <li><code>MaturityDate</code></li> <li><code>TradingBookFlag</code></li> <li><code>NumberOfCompontents</code></li> <li><code>LongContractFlag</code></li> <li><code>DerivativeId</code></li> <li><code>DerivativeSwapId</code></li> <li><code>TypeOf = 'Contract'</code></li> <li><code>SubType in ('DerOTC','DerExc')</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_Derivatives/#interfacing-from-flat-file", "title": "Interfacing from flat file", "text": "<ul> <li>There are differences between the native delivery in the RT01 versus the QDL.<ul> <li>RT01: Two off-balance sheet records (505xxx, 605xxx, ...) and optionally, 1 replacement value record with account numbers 107100, 205100 and 801100<ul> <li>Set the parameter <code>RV_DELIVERY</code> to 1 if the replacement values are delivered in the RT01.</li> </ul> </li> <li>QDL: 1 single record in <code>core_positions</code> linked to the corresponding derivative table.</li> </ul> </li> <li>To ease interfacing data from an RT01 to the QDL, if the replacement values are delivered (<code>RV_DELIVERY</code> set to 1), each derivatives will have two records in <code>core_positions</code>.<ul> <li><code>AccountNumber = 107100</code><ul> <li><code>LegalAccountNumber = 107001</code></li> <li><code>Account = ''</code></li> <li><code>TypeOf = ''</code></li> <li><code>SubType = ''</code></li> <li><code>InternalReference3 = 'Input: on-BS RV'</code></li> </ul> </li> <li><code>AccountNumber = 205100 and ValuationMethod &lt;&gt; 3</code><ul> <li><code>LegalAccountNumber = 205001</code></li> <li><code>Account = ''</code></li> <li><code>TypeOf = ''</code></li> <li><code>SubType = ''</code></li> <li><code>InternalReference3 = 'Input: on-BS RV'</code></li> </ul> </li> <li><code>AccountNumber = 205100 and ValuationMethod = 3</code><ul> <li><code>LegalAccountNumber = 0</code></li> <li><code>Account = '205001'</code></li> <li><code>TypeOf = ''</code></li> <li><code>SubType = ''</code></li> <li><code>InternalReference3 = 'Input: on-BS RV'</code></li> </ul> </li> <li><code>AccountNumber = 801100</code><ul> <li><code>LegalAccountNumber = 0</code></li> <li><code>Account = '107001'</code></li> <li><code>TypeOf = ''</code></li> <li><code>SubType = ''</code></li> <li><code>InternalReference3 = 'Input: off-BS RV'</code></li> </ul> </li> <li><code>AccountNumber in (505xxx, 605xxx, ...)</code><ul> <li><code>LegalAccountNumber = 0</code></li> <li><code>Account = '107001' or '205001' (depending on sign of ReplacementValueAmount)</code></li> <li><code>TypeOf = 'Contract'</code></li> <li><code>SubType = 'DerOTC' or 'DerExc'</code></li> <li><code>InternalReference3 = 'Input: off-BS der'</code></li> </ul> </li> </ul> </li> <li>Otherwise, <code>core_positions</code> contains a single record per derivatives with either a 0 <code>LegalAccountNumber</code> if the derivative is not booked on-balance sheet, or a <code>LegalAccountNumber</code> equal to 107001 or 205001 if booked on-balance sheet.</li> </ul>"}, {"location": "FunctionalDoc/Doc_Derivatives/#useful-queries-for-reconciliation", "title": "Useful queries for reconciliation", "text": ""}, {"location": "FunctionalDoc/Doc_Derivatives/#all-derivatives-which-will-be-considered-for-risk-calculation", "title": "All derivatives which will be considered for risk calculation", "text": "<ul> <li><code>core_positions_single</code>:</li> </ul> <pre><code>select * from core_positions_single cps \nwhere LoadId = 1\nand left(AccountNumber,3) in (505,506,605,606)\n</code></pre> <ul> <li><code>core_positions_single_ext</code>:</li> </ul> <pre><code>select * from core_positions_single_ext cpse  \nwhere LoadId = 1\nand IsDerivative = 1\n</code></pre> <ul> <li><code>core_positions</code>:</li> </ul> <pre><code>select LegalAccountNumber,Account,TypeOf,SubType,BookAmount,InternalReference3,cp.* from core_positions cp\nwhere LoadId = 1\nand TypeOf = 'Contract' and SubType in ('DerOTC','DerExc')\n</code></pre>"}, {"location": "FunctionalDoc/Doc_Derivatives/#all-on-balance-sheet-positive-replacement-values", "title": "All on-balance sheet positive replacement values", "text": "<ul> <li><code>core_positions_single</code>:</li> </ul> <pre><code>select * from core_positions_single cps \nwhere LoadId = 1\nand AccountNumber = 107100\n</code></pre> <ul> <li><code>core_positions_single_ext</code>:</li> </ul> <pre><code>select * from core_positions_single_ext cpse  \nwhere LoadId = 1\nand AccountNumber = 107100\n</code></pre> <ul> <li><code>core_positions</code>:</li> </ul> <pre><code>select LegalAccountNumber,Account,TypeOf,SubType,BookAmount,InternalReference3,cp.* from core_positions cp\nwhere LoadId = 1\nand LegalAccountNumber = 107001\n</code></pre>"}, {"location": "FunctionalDoc/Doc_Derivatives/#all-on-balance-sheet-negative-replacement-values", "title": "All on-balance sheet negative replacement values", "text": "<ul> <li><code>core_positions_single</code>:</li> </ul> <pre><code>select * from core_positions_single cps \nwhere LoadId = 1\nand AccountNumber = 205100\nand ValuationMethod &lt;&gt; 3\n</code></pre> <ul> <li><code>core_positions_single_ext</code>:</li> </ul> <pre><code>select * from core_positions_single_ext cpse  \nwhere LoadId = 1\nand AccountNumber = 205100\nand ValuationMethod &lt;&gt; 3\n</code></pre> <ul> <li><code>core_positions</code>:</li> </ul> <pre><code>select LegalAccountNumber,Account,TypeOf,SubType,BookAmount,InternalReference3,cp.* from core_positions cp\nwhere LoadId = 1\nand LegalAccountNumber = 205001\n</code></pre>"}, {"location": "FunctionalDoc/Doc_Derivatives/#all-off-balance-sheet-positive-replacement-values", "title": "All off-balance sheet positive replacement values", "text": "<pre><code>select * from core_positions_single cps \nwhere LoadId = 1\nand AccountNumber = 801100\n</code></pre> <ul> <li><code>core_positions_single_ext</code>:</li> </ul> <pre><code>select * from core_positions_single_ext cpse  \nwhere LoadId = 1\nand AccountNumber = 801100\n</code></pre> <ul> <li><code>core_positions</code>:</li> </ul> <pre><code>select LegalAccountNumber,Account,TypeOf,SubType,BookAmount,InternalReference3,cp.* from core_positions cp\nwhere LoadId = 1\nand LegalAccountNumber = 0\nand Account = 107001\nand TypeOf = ''\n</code></pre>"}, {"location": "FunctionalDoc/Doc_Derivatives/#all-off-balance-sheet-negative-replacement-values", "title": "All off-balance sheet negative replacement values", "text": "<ul> <li><code>core_positions_single</code>:</li> </ul> <pre><code>select * from core_positions_single cps \nwhere LoadId = 1\nand AccountNumber = 205100\nand ValuationMethod = 3\n</code></pre> <ul> <li><code>core_positions_single_ext</code>:</li> </ul> <pre><code>select * from core_positions_single_ext cpse  \nwhere LoadId = 1\nand AccountNumber = 205100\nand ValuationMethod = 3\n</code></pre> <ul> <li><code>core_positions</code>:</li> </ul> <pre><code>select LegalAccountNumber,Account,TypeOf,SubType,BookAmount,InternalReference3,cp.* from core_positions cp\nwhere LoadId = 1\nand Account = 205001\nand LegalAccountNumber = 0\nand TypeOf = ''\n</code></pre>"}, {"location": "FunctionalDoc/Doc_Derivatives/#views", "title": "Views", "text": ""}, {"location": "FunctionalDoc/Doc_Fidu/", "title": "On-Balance sheet fiduciary generation", "text": ""}, {"location": "FunctionalDoc/Doc_Fidu/#draft", "title": "DRAFT", "text": ""}, {"location": "FunctionalDoc/Doc_Fidu/#context", "title": "Context:", "text": "<p>Banks with multiples entities:    When Fiduciary are booked as contract (off-balance sheet) in a branch/sister company. These contracts are not necessarily replicated in the counterparty bank accounting but still need to be part of the balance sheet.</p>"}, {"location": "FunctionalDoc/Doc_Fidu/#accounting-logic", "title": "Accounting logic", "text": ""}, {"location": "FunctionalDoc/Doc_Fidu/#mercury-setup", "title": "Mercury Setup", "text": "<ul> <li>Can be activated whith the parameter GENERATE_FIDU_BS</li> </ul>"}, {"location": "FunctionalDoc/Doc_Fidu/#data-requirements", "title": "Data requirements", "text": "<ul> <li>core_positions.counterpartyBookingCenterId should contain a specific BookingCenterID. This allow the bank to include or exclude the on balance sheet position with the reporting set configuration. The disadvantage of this solution is the balance sheet for one specific entity where these fiduciary are booked it can be bypassed with a specific reporting set</li> </ul>"}, {"location": "FunctionalDoc/Doc_Fidu/#mercury-treatments", "title": "Mercury Treatments", "text": ""}, {"location": "FunctionalDoc/Doc_Fidu/#core_positions-input", "title": "core_positions \u2192 Input", "text": "<p>Only the following position will be taken in the treatment: - TypeOf = 'Contract' - SubType in('FiduInvestment','FiduLoans','FiduSLB','FiduOther') - LongContractFlag = 0 - CounterpartyBookingCenterId &lt;&gt; ''</p>"}, {"location": "FunctionalDoc/Doc_Fidu/#core_positions-output", "title": "core_positions \u2192 Output", "text": "<ul> <li>legalAccountNumber 203001</li> <li>positionTypeOf = 'Account'</li> <li>subType = ''</li> <li>bookingCenter = \"source\" counterpartyBookingCenterId</li> <li>counterpartyBookingCenterId = '' (empty)</li> <li>rest of the fields are identical to the source</li> </ul>"}, {"location": "FunctionalDoc/Doc_Fidu/#positions-generated-target", "title": "positions generated \u2192 target", "text": "<ul> <li>A new position with the result is generated in the same data load</li> </ul>"}, {"location": "FunctionalDoc/Doc_Guarantees/", "title": "Guarantees", "text": ""}, {"location": "FunctionalDoc/Doc_Guarantees/#parties-to-a-guarantee", "title": "Parties to a guarantee", "text": "<ul> <li>Guarantor \u2192 the party which provides the guarantee</li> <li>Principal \u2192 the person in respect of whose default the guarantee is given</li> <li>Beneficiary \u2192 the party to whom the guarantee is given</li> </ul>"}, {"location": "FunctionalDoc/Doc_Guarantees/#delivery", "title": "Delivery", "text": ""}, {"location": "FunctionalDoc/Doc_Guarantees/#received-guarantee-collateral", "title": "Received guarantee = collateral", "text": "<ul> <li><code>core_positions.LegalAccountNumber = 0</code></li> <li><code>core_positions.CollateralHolderId</code> \u2192 Principal</li> <li><code>core_positions.CounterpartyId</code> \u2192 Guarantor</li> <li><code>core_positions.TypeOf = 'Contract'</code></li> <li><code>core_positions.SubType = 'Guarantee'</code></li> </ul>"}, {"location": "FunctionalDoc/Doc_Guarantees/#guarantee-issued-off-balance-sheet-exposure", "title": "Guarantee issued = off-balance sheet exposure", "text": "<ul> <li><code>core_positions.LegalAccountNumber in (301001,301002)</code></li> <li><code>core_positions.CollateralHolderId = ''</code> \u2192 empty</li> <li><code>core_positions.CounterpartyId</code> \u2192 Principal</li> <li><code>core_positions.TypeOf = 'Contract'</code></li> <li><code>core_positions.SubType = 'Guarantee'</code></li> </ul>"}, {"location": "FunctionalDoc/Doc_HQLA/", "title": "Management of HQLA category", "text": ""}, {"location": "FunctionalDoc/Doc_HQLA/#methods-of-delivery-and-calculation", "title": "Methods of delivery and calculation", "text": "<ul> <li>Three methods can be used to deliver/manage the HQLA category of securities:<ol> <li>Via the field <code>list_securities.HQLACategory</code>.</li> <li>Via the field <code>core_module_specifics.ForceHQLACategory</code> which can be used to overrule the value delivered in <code>list_securities</code><ul> <li>Note that the delivery of <code>core_module_specifics</code> is done that the position level, not security level.</li> </ul> </li> <li>Via the endpoint LoadSnbBasket.<ul> <li>The endpoint is based on the list provided on the Finma website.</li> <li>The content of the list is loaded in the table <code>ts_snb_basket tsb</code> and updates the fields <code>list_securities.HQLACategory</code> and <code>list_securities.SNBEligibleFlag</code> based on the ISIN, if provided in <code>list_securities</code> \u2192 Note that these two fields will be overwritten if they already contain information, and that the endpoint must be executed after having loaded the security table.</li> </ul> </li> </ol> </li> <li>The value that will ultimately be used for the HQLA category is the one in the table <code>core_positions_calc.HQLACategory</code>.</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/", "title": "IRRBB - Interest rate in the banking book", "text": ""}, {"location": "FunctionalDoc/Doc_IRRBB/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>IRRBB</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2019/02</li> <li>Finma circ. 2016/01 annexe 2<ul> <li>Calculation of EVE and NII</li> </ul> </li> <li>Basel Framework SRP31</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#steps-spr3195", "title": "Steps (SPR31.95)", "text": ""}, {"location": "FunctionalDoc/Doc_IRRBB/#1-zir-categories", "title": "1. ZIR Categories", "text": "<ul> <li><code>core_positions_calc.ZIRCategory</code>used in v_IRRBB_U/v_IRRBB_K.</li> <li>Categories:<ul> <li>I: Positions with determined repricing maturities</li> <li>II: Positions with undetermined repricing maturities</li> <li>III: Positions with no repricing maturities</li> <li>IV: Own funds</li> <li>V: Non-linear derivatives</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#2-repricing-cash-flow-generation", "title": "2. Repricing cash flow generation", "text": "<ul> <li>Definition (EBA, 2021): Notional repricing cash flows refers to interest payments or principal amounts of fixed rate instruments that mature or principal amounts of floating rate instruments that reprice.</li> <li>Each repricing cash flow is generated in the views v_IRRBB_U/v_IRRBB_K which can be of 3 different types (<code>v_IRRBB_U.RCFType</code>):<ul> <li><code>InterestPayment</code></li> <li><code>PrincipalPayment</code></li> <li><code>PrincipalRepricing</code></li> <li><code>PrincipalReplicationKey</code> \u2192 generated with replication key</li> <li><code>PrincipalReplicationKeyDefault</code> \u2192 generated with default replication key</li> </ul> </li> <li>The scope of positions for which repricing cash flow have to be considered, which will in turn enter the views v_IRRBB_U/v_IRRBB_K are those which carry a floating or fixed interest rate, i.e. those were <code>core_posiitons.IRTypeOf in ('Fixed','Floating')</code> and interest rate derivatives.</li> <li>Remarks:<ul> <li>Simplification: in this version, among derivatives, only the interest rate swaps (IRS) and cross currency swaps (CCS) are taken into account.</li> <li>A zero coupon bond should still be delivered with an IRTypeOf, even if the the IR payment is 0%.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#21-slotting", "title": "2.1 Slotting", "text": "<ul> <li>Scope: <code>RCFType in ('PrincipalPayment','PrincipalRepricing')</code></li> <li>The slotting is the division of a position into the repricing cash flows <code>PrincipalPayment</code> or <code>PrincipalRepricing</code>, and the assignement of their repricing slots/bucket.</li> <li>Simplification: In this first version amortizations are ignored.</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#211-slotting-of-fixed-rate-positions", "title": "2.1.1 Slotting of fixed rate positions", "text": "<ul> <li>Scope: <code>core_positions.IRTypeOf = 'Fixed'</code></li> <li>Whole principal (<code>core_positions.BookAmount</code>) assigned to the maturity of the position (<code>core_positions.MaturityDate</code>) \u2192 <code>RCFType = 'PrincipalPayment'</code>.</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#212-slotting-of-floating-rate-position-with-ir-fixing-date", "title": "2.1.2 Slotting of floating rate position with IR fixing date", "text": "<ul> <li>Scope: <code>core_positions.IRTypeOf = 'Floating' and core_positions.IRNextFixingDate &gt; core_load_collections.ReportingDate</code></li> <li>Whole principal (<code>core_positions.BookAmount</code>) assigned to the next IR fixing date (<code>core_positions.IRNextFixingDate</code>) \u2192 <code>RCFType = PrincipalRepricing</code>.</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#213-slotting-of-floating-rate-position-without-ir-fixing-date", "title": "2.1.3 Slotting of floating rate position without IR fixing date", "text": "<ul> <li>Scope: <code>core_positions.IRTypeOf = 'Floating' and core_positions.IRNextFixingDate &lt; core_load_collections.ReportingDate</code></li> <li>The scope corresponds to the ZIR category 2 (<code>v_IRRBB_U/K.ZIRCategory = 2</code>) \u2192 typically includes banks and clients checking account.<ul> <li>See SPR31.103.</li> </ul> </li> <li>This distribution is done with replication keys which generate principal repricing and their corresponding repricing date.</li> <li>Category 2 subcategories and their replication keys \u2192 repricing date = time bucket end- or midpoint depending on value in parameter <code>IRRBB_CAT2_MID_BUCKET</code>:<ul> <li>Due from banks</li> <li>100% \u2192 0 - 1 M</li> <li>Due from customers (on sight)</li> <li>70% \u2192 0 - 1 M</li> <li>30% \u2192 9 - 12 M</li> <li>Due from customers (on call and cancellable)</li> <li>25% \u2192 9 - 12 M</li> <li>50% \u2192 18 - 24 M</li> <li>25% \u2192 2 - 3 Y</li> <li>Floating rate mortgage loans</li> <li>25% \u2192 9 - 12 M</li> <li>50% \u2192 18 - 24 M</li> <li>25% \u2192 4 - 5 Y</li> <li>Other exposures</li> <li>100% \u2192 0 - 1 M</li> <li>Current accounts</li> <li>100% \u2192 0 - 1 M</li> <li>Due to banks</li> <li>100% \u2192 0 - 1 M</li> <li>Due to customers</li> <li>70% \u2192 0 - 1 M</li> <li>30% \u2192 9 - 12 M</li> <li>Other liabilities</li> <li>100% \u2192 0 - 1 M</li> <li>Default replication key (if the position does not fit in any of the categories above):</li> <li>100% \u2192 0 - 1 M</li> </ul> </li> <li>Replication keys can be parametrized by the bank if necessary in the config file irrbbReplicationKeySplits.csv and irrbbReplicationKeyRules.csv.</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#214-slotting-of-derivatives", "title": "2.1.4 Slotting of derivatives", "text": "<ul> <li>As interest rate derivatives need information from various tables, the most important ones are gathered in the view <code>v_derivatives_ir</code> (<code>vds</code>). For simplicity purpose, references will be made to fields of this view when it comes to derivatives in the IRBB.<ul> <li><code>v_derivatives_ir</code> distinguishes the information related to the receivable and payable legs by prefixing the fields of the view with <code>R</code> or <code>P</code>.</li> </ul> </li> <li>Scope: <code>vds.TypeOf in ('IRS','CCS')</code></li> <li>Interest rate swaps (IRS) and cross currency swaps (CCS) which pays two stream of cash flows are treated as two positions, one long, one short.</li> <li>Each leg can either pay a fixed rate or a floating rate, although the common type of IRS is fix vs floating.</li> <li>The fixed leg of an IRS/CCS is treated as a fixed rate position (see section 2.1.1): the whole notional (<code>vds.R/PNotional</code>) is assigned to the maturity of the position (<code>vds.MaturityDate</code>) \u2192 <code>RCFType = 'PrincipalPayment'</code>.</li> <li>The floating leg of an IRS is treated as a floating rate position with IR fixing date (see section 2.1.2): the whole notional (<code>core_positions.Notional</code>) is assigned to the next IR fixing date (<code>vds.P/RNextFixingDate</code>) \u2192 <code>RCFType = PrincipalRepricing</code>.</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#3-repricing-cash-flow-interest-payment-rcftype-interestpayment", "title": "3. Repricing cash flow: interest payment (<code>RCFType = 'InterestPayment'</code>)", "text": "<ul> <li>The following fields of <code>core_positions</code> are relevant for the calculation of the interest payments of on-balance sheet positions:<ul> <li><code>IRPaymentFrequency</code></li> <li><code>IRNextPaymentDate</code></li> <li><code>MaturityDate</code></li> <li><code>IRNextFixingDate</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#31-interest-payment-of-derivatives", "title": "3.1 Interest payment of derivatives", "text": "<ul> <li>As for slotting interest payments are treated separately for each leg of the derivatives.</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#case-1-irpaymentfrequency-and-irnextpaymentdate-provided", "title": "Case 1: IRPaymentFrequency and IRNextPaymentDate provided", "text": "<ul> <li>In a perfect world the algorithm to generate the IR payment is the following:<ol> <li>The next IR payment is generated at the next IR payment date (<code>core_positions.IRNextPaymentDate</code> or <code>vds.R/PNextPaymentDate</code>).</li> <li>The following IR payment are generated by adding the IR payment period (based on the IR payment frequency (<code>core_positions.IRPaymentFrequency</code> or <code>vds.R/PPaymentFrequency</code>)) to the next IR payment date as long as 1) the maturity date is not exceeded for fixed interest rate instruments (<code>core_posiitons.IRTypeOf = 'Fixed'</code> or <code>vds.R/PIRType = 'Fixed'</code>) or 2) the IR next fixing date for floating interest rate instruments is not exceeded (<code>core_posiitons.IRTypeOf = 'Floating'</code> or <code>vds.R/PIRType = 'Floating'</code>).<ul> <li>Remark: It is assumed that for floating interest rate instruments, the interest rate risk is limited to the next cash flows until refixing. Consequently, only the IR payments until that date are considered in this case (SPR31.103).</li> </ul> </li> <li>If the last IR payment does not fall on the maturity date, a last interest payment is computed on the maturity date, based on the duration between the penultimate IR payment and maturity date of the contract.<ul> <li>Remark: For floating interest rates, no IR is computed on the IR next fixing date. This would be equivalent to computing an accrual interest rate, which is irrelevant in this context.</li> </ul> </li> </ol> </li> <li>With contradictory information: In a less perfect world where the IRPaymentFrequency and IRNextPaymentDate are in contradiction, the IRPaymentFrequency prevails. For instance if the interest payment frequency is 1 month, and the next interest payment is in 2 month. In this case, IR payments are generated backward from the IRNextPaymentDate:<ol> <li>IR payments between the IRNextPaymentDate and the reporting date are generated by substracting the IR period (based on the IR payment frequency) from the IRNextPaymentDate, as long as the reporting date is not exceeded.</li> <li>For what happens after the IR next payment date provided in input and the maturity date or the IR next fixing date, follow the algorithm of case 1.</li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#case-2-irpaymentfrequency-provided-but-not-irnextpaymentdate", "title": "Case 2: IRPaymentFrequency provided, but not IRNextPaymentDate", "text": "<ul> <li>IR payments are generated backwards from the maturity date for fixed interest rate instruments (<code>core_posiitons.IRTypeOf = 'Fixed'</code> or <code>vds.R/PIRType = 'Fixed'</code>)or the IR next fixing date for floating interest rate instruments (<code>core_posiitons.IRTypeOf = 'Floating'</code> or <code>vds.R/PIRType = 'Floating'</code>):<ol> <li>Set the last IR payment at maturity or IR next fixing date.</li> <li>IR payments generated backward until the reporting date.</li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#case-3-irpaymentfrequency-not-provided-but-irnextpaymentdate-is", "title": "Case 3: IRPaymentFrequency not provided, but IRNextPaymentDate is", "text": "<ul> <li>We set a default IR payment frequency at 1 year which leads to the following algorithm:<ol> <li>First cash flow takes place at the IR next payment date provided.</li> <li>The subsequent IR payment takes place every year after the IR next payment date until the maturity date or IR next fixing date.</li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#case-4-irpaymentfrequency-and-irnextpaymentdate-not-provided", "title": "Case 4: IRPaymentFrequency and IRNextPaymentDate not provided", "text": "<ul> <li>We set a default IR payment frequency at 1 year and generate IR payments backwards from the maturity date or IR next fixing date.</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#risk-indicators", "title": "Risk Indicators", "text": ""}, {"location": "FunctionalDoc/Doc_IRRBB/#net-interest-income-nii", "title": "Net interest income (NII)", "text": "<ul> <li>The net interest income is a financial performance measure that reflects the difference between the revenue generated from a bank's interest-bearing assets and the expenses associated with paying on its interest-bearing liabilities (source)</li> <li>The NII (change in NII) is measured by assessing the impact of interest rate shocks over a one year period, with a constant balance sheet view. For this reason, only the positions with a repricing date within one year are considered: those are the ones that would be impacted by changes in interest rates, if rolled over.</li> <li>The calculation implies computing the net shock (impact on assets - liabilities) from the repricing date of the RCF until the one year after the reporting date (since it is assumed positions are rolled over because of the constant balance sheet).</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#base-scenario", "title": "Base scenario", "text": "<ul> <li>The base scenario intends to reflect the net interest income generated by the maturing position if reinvested, from its maturity until a one year horizon, with no shock applied.</li> <li>The reinvestment rate of a position is estimated using the forward rate applicable between its maturity and its rolled-over maturity plus the spread carried by the position.</li> <li>Spread: if not delivered, it is estimated as the difference between the interest rate carried by the position and the interest rate applicable for the original maturity of the position using today's interest rate curve:<ul> <li><code>core_positions.InterestRate</code> -  </li> </ul> </li> <li>Forward rate:<ul> <li>The forward rate  between the maturity of the position  and it's rolled-over maturity  is today's best approximation of what will be the interest rate applicable at  when rolling over the position for an equivalent duration.</li> <li>Reminder \u2192 the followings are equivalent (where T is expressed as a number of years, and r as an annual interest rate):</li> <li>Discrete compounding:  </li> <li>Continuous compounding:  </li> <li>Calculation:  </li> <li>where:</li> <li>  = time to maturity in years of the position ()</li> <li>  = rate implied by the interest rate curve until the maturity of the position</li> <li>  = time to maturity in years of the rolled over position, i.e.  <ul> <li>Note that if , then  </li> <li>This treatment which sets the minimal original duration at one year approximates the rollover of the transaction as many times as necessary to exceed the one year horizon.</li> </ul> </li> <li>  = rate implied by the interest rate curve until the maturity of the rolled over position ()</li> <li>  = forward rate between the maturity of the position () and its rolled over maturity ()</li> </ul> </li> <li>NII:<ul> <li>It is made of the expected net interest income perceived during a one year horizon, both effective and accrued. It is therefore composed of (1) the paid interest of the position at expiration and (2) the accrued interest of the rolled over position between its maturity () and the end of the one year time horizon.</li> <li>Reinvested amount = Notional + Interest paiement</li> <li>Reinvestment rate:  </li> <li>NII  </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#scenarios-1-2", "title": "Scenarios 1 &amp; 2", "text": "<ul> <li>The parallel shifts of the yield curve of the scenarios 1 and 2 impact the calculation of the forward rate calculation, by shifting  and  by the amount of the shock. Compared to the base scenario, the NII is impacted only by this change of forward rate, all other variable staying constant.</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#complementary-information-for-category-1-positions-with-floating-rates", "title": "Complementary information for category 1 positions with floating rates", "text": "<ul> <li>The maturity date and corresponding time to maturity () are defined by the maturity of the repricing cash flow as defined above</li> <li>Original duration (which enters the calculation of  = the time to maturity of the rolled over position):<ul> <li>Option 1: Set to one year by default.</li> <li>Option 2: The original duration which enters the calculation of  (the time to maturity of the rolled over position) is defined by the interest rate refixing frequency <code>core_positions.IRReFixingFrequency</code>.</li> <li>Remark: the condition if , then  still applies.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#complementary-information-for-category-2-positions", "title": "Complementary information for category 2 positions", "text": "<ul> <li>The maturity date and corresponding time to maturity () are defined by the middle of the time bucket to which the repricing cash flow is assigned.</li> <li>Original duration:<ul> <li>Option 1: Set to one year by default.</li> <li>Option 2: The original duration is defined by the interest rate refixing frequency <code>core_positions.IRReFixingFrequency</code>. It means that all the repricing cash flows generated by a given position and its replication keys (not matter the time bucket) will have the same original duration, which is equal to the interest rate refixing frequency.</li> <li>Remark: the condition if , then  still applies.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#economic-value-of-equity-eve", "title": "Economic value of equity (EVE)", "text": "<ul> <li>The economic value of equity (EVE) is a cash flow calculation that takes the present value of all asset cash flows and subtracts the present value of all liability cash flows. (source)</li> <li>The EVE is computed as the impact of interest rate shocks on the EVE, through the discount factor.</li> <li>Reminder about present value: Present value (PV) is the current value of a future sum of money or stream of cash flows given a specified rate of return. Present value takes the future value and applies a discount rate or the interest rate that could be earned if invested. (source)<ul> <li> , where:<ul> <li>  = interest rate</li> <li>  = time in years</li> </ul> </li> </ul> </li> <li>Calculation:<ol> <li>Compute the discount rate rate of the RCF before applying shocks. Interest rates for a given currency are provided for some tenors, and the RCF maturity will usually fall between this tenors. In order to compute the appropriate discount rate, the appropriate interest rate must be interpolated based on the interest rate of the previous and next tenor (linear interpolation to start with). With the interpolated (discount) interest rate, the discount factor and the present value of the position can be computed.</li> <li>Fields<ul> <li><code>v_IRRBB_U/K.InterpolatedDiscountIR</code></li> <li><code>v_IRRBB_U/K.DiscountFactor</code></li> <li><code>v_IRRBB_U/K.DiscountedRCF</code></li> </ul> </li> <li>Apply the shocks of the corresponding maturity bucket to the interpolated interest rates for each scenario to obtain successively the shocked interpolated discount rate, the shocked discount factor and shocked discounted RCF:</li> <li><code>v_IRRBB_U/K.ShockedXInterpolatedDiscountIR</code></li> <li><code>v_IRRBB_U/K.ShockedXDiscountFactor</code></li> <li><code>v_IRRBB_U/K.ShockedXDiscountedRCF</code></li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#zir2_b", "title": "ZIR2_B", "text": "<ul> <li>Pas prendre en compte payment d'int\u00e9r\u00eat</li> <li>Moyenne des RCFDuration days</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#remarks", "title": "Remarks", "text": "<ul> <li>Positions delivered with a negative <code>BookAmount</code> will be treated as follow:<ul> <li>Category 1: only the notional is considered, and the cash flow treated as <code>PrincipalPayment</code> or <code>PrincipalRepricing</code> depending if the interest rate carried by the position is fixed or floating, respectively. Interest payments are not generated.</li> <li>Category 2: the slotting is performed as regular category 2 positions using replication keys.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#parameters", "title": "Parameters", "text": "<ul> <li>IRRBB_K_LIST_CURRENCIES &amp; IRRBB_U_LIST_CURRENCIES<ul> <li>Legal ref. Finma Notes Le formulaire d\u2019enqu\u00eate comprend une liste \u00e9num\u00e9rant 22 monnaies, y compris la position collective \u00abAutres monnaies\u00bb. Si la part des actifs u des passifs de l\u2019une de ces monnaies repr\u00e9sente 10% ou plus de la somme du bilan, un formulaire ZIR1 doit \u00eatre rempli pour chacune de ces monnaies</li> </ul> </li> <li>IRRBB_TB<ul> <li>Set to 1 to include trading book positions.</li> </ul> </li> <li>IRRBB_NII_IP<ul> <li>Set to 1 to include interest paiement in NII calculation.</li> </ul> </li> <li>IRRBB_NII_OD_DEFAULT<ul> <li>Option 1 (Set to one year by default.), 2 Option 2 (Use the refixing frequency to calculate the original duration).</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_IRRBB/#internal_indicatorscenarios", "title": "internal_indicator/scenarios", "text": "<ul> <li>The shock applied to the positions for the calculation of the EVE (l.22-25 ZIR2_A).</li> <li>One line per Finma scenarios possibility for the user to add their own scenarios.</li> <li>One column to flag the scenario that should be used for the internal indicator. </li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#core_positions", "title": "core_positions", "text": "<ul> <li>InterestRate</li> <li>IRTypeOf</li> <li>IRNextFixingDate</li> <li>IRRefixingFrequency</li> <li>IRNextPaymentDate</li> <li>IRPaymentFrequency</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#list_interest_rate_curves", "title": "list_interest_rate_curves", "text": "<ul> <li>Category</li> <li>ReportingDate</li> <li>Currency</li> <li>Tenor</li> <li>InterestRate</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#param_irrbb_shocks-is-param_-the-good-prefix", "title": "param_IRRBB_shocks \u2192 is param_ the good prefix?", "text": "<ul> <li>Currency</li> <li>TimeBand</li> </ul>"}, {"location": "FunctionalDoc/Doc_IRRBB/#output-viewstables", "title": "Output views/tables", "text": ""}, {"location": "FunctionalDoc/Doc_IRRBB/#v_irrbb_uk", "title": "v_IRRBB_U/K", "text": "<ul> <li>lcId</li> <li>Id</li> <li>rcfNum</li> <li>LegalAccountNumber</li> <li>Currency</li> <li>IRBBCurrency</li> <li>Value can be 'U'</li> <li>AccountGroupLevel1</li> <li>PositionType</li> <li>PositionSubType</li> <li>SecurityType</li> <li>SecuritySubType</li> <li>CommodityType</li> <li>ReportingDate</li> <li>StartDate</li> <li>MaturityType</li> <li>IRType</li> <li>Subordination</li> <li>RCFType \u2192 Repricing cash flow type</li> <li>legal ref.: SRP31.98</li> <li>MainRCFlag \u2192 Interest rate main cash flow flag</li> <li>Legal ref.: Finma Notes Les actifs dont le volume nominal repr\u00e9sente moins de 1% des op\u00e9rations au bilan ainsi que les passifs et op\u00e9rations hors-bilan dont le volume nominal repr\u00e9sente moins de 1% de la somme des op\u00e9rations au bilan et hors-bilan ne sont pas consid\u00e9r\u00e9s comme principaux dans les cas o\u00f9 ils devraient \u00eatre rapport\u00e9s uniquement dans les \u00e9ch\u00e9ances allant jusqu'\u00e0 12 mois</li> <li>RCF \u2192 repricing cash flow</li> <li>RCFDate \u2192 Repricing cash flow date</li> <li>RCFDurationDays</li> <li>ZIRCategory \u2192 1 to 5</li> <li>Rules for non-derivatives positions</li> <li>ZIRTimeBand</li> <li>Legal ref.: Finma circ. 2019/02 Annexe 2</li> <li>Value 1 to 19</li> <li>InterpolatedDiscountIR</li> <li>DiscountFactor</li> <li>DiscountedRCF</li> <li>Shocked1InterpolatedDiscountIR</li> <li>Shocked2InterpolatedDiscountIR</li> <li>Shocked3InterpolatedDiscountIR</li> <li>Shocked4InterpolatedDiscountIR</li> <li>Shocked5InterpolatedDiscountIR</li> <li>Shocked6InterpolatedDiscountIR</li> <li>Shocked1DiscountFactor</li> <li>Shocked2DiscountFactor</li> <li>Shocked3DiscountFactor</li> <li>Shocked4DiscountFactor</li> <li>Shocked5DiscountFactor</li> <li>Shocked6DiscountFactor</li> <li>Shocked1DiscountedRCF</li> <li>Shocked2DiscountedRCF</li> <li>Shocked3DiscountedRCF</li> <li>Shocked4DiscountedRCF</li> <li>Shocked5DiscountedRCF</li> <li>Shocked6DiscountedRCF</li> <li>DeltaNIIUpShock</li> <li>DeltaNIIDownShock</li> <li>DeltaNIIBaseShock</li> </ul>"}, {"location": "FunctionalDoc/Doc_Interco_Conso/", "title": "Intercompany transactions and consolidation", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/", "title": "Large exposure reporting", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>LEX</li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2019/01</li> <li>LER Notes</li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#description", "title": "Description", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/#unknown-client", "title": "Unknown client", "text": "<p>The treatment to assign a position to the unknown client (UC) is the following:</p> <ol> <li> <p>Is a position candidate to be assigned to the UC?</p> <ul> <li>If the nature of the position meets the criteria to potentially be assigned to the UC, the calculation field <code>core_positions_calc.LEXUnknownClientFlag</code> is set to True. It includes funds (nostro or clients) and derivatives on funds or index. It is not because the flag value is True that the position will necessarily be assigned to the UC</li> </ul> </li> <li> <p>What is the threshold to assign a group to the UC?</p> <ul> <li>In the view <code>v_LEX_U_UC_threshold</code>, the exposure threshold is computed, above which the exposures toward the same index/structure is assigned to the UC. It will either be 2% or 0.25% depending on the value of the parameter <code>LEX_CMA_UC3</code>.</li> </ul> </li> <li> <p>Does a group meet the conditions to be assigned to the UC?</p> <ul> <li>In the view <code>v_LEX_U_group_exposure</code> the flag <code>LEXUnknownClientFlag</code> is set to True if for a group of counterparty where the positions with <code>core_positions_calc.LEXUnknownClientFlag = True</code> and where the UC threshold is exceeded. Note that if you have more than one line for a group of counterparty (<code>GroupLEXID</code>), it means that in some cases the same group ID is recognized as a potential candidate to be assigned to the UC and sometimes not, which indicates a likely issue in the input data quality.</li> </ul> </li> <li> <p>Is the UC reportable?</p> <ul> <li>In the view <code>v_LEX_U_UC_reportable</code>, will contain the value 1 in the <code>UCReportableFlag</code> if the UC should be reported in the Large Exposures</li> </ul> </li> </ol>"}, {"location": "FunctionalDoc/Doc_LEX/#definitions", "title": "Definitions", "text": "<ul> <li>Large exposure: when the global position (LER report column AE) exceeds 10% of Tier 1. Legal ref.: OFR Art. 95 al.1</li> <li>Important credit risk (Risque de cr\u00e9dit \u00e9lev\u00e9): when the gross exposure (LER report column Z) exceeds 10% of Tier 1 capital. Legal ref.: OFR Art. 95 al.2 &amp; OFR Art. 100 al.4 let.b</li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#capital", "title": "Capital", "text": "<ul> <li>Tier 1</li> <li>R\u00e9server latente for category 4-5 banks</li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#positions-to-be-reported-in-ler-report-art-100-al-4", "title": "Positions to be reported in LER report (Art. 100 al. 4)", "text": "<ul> <li>Large exposures</li> <li>Import credit risks</li> <li>Individual intragroup position (toward entities of the group) exceeding 2% of Tier 1</li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#treatment-of-intra-group-positions", "title": "Treatment of intra-group positions", "text": "<ul> <li>Positions toward the group can be recognized thanks to the value <code>G</code> in the field <code>list_counterparty_groups_lex.TypeOf</code></li> <li>How to distinguish between regulated and unregulated entities of the group should be done at the counterparty level (i.e. in <code>list_counterparties</code>) \u2192 solution not defined yet</li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#treatment-of-mortgages-for-category-4-5-banks", "title": "Treatment of mortgages for category 4 &amp; 5 banks", "text": "<ul> <li>Legal ref<ul> <li>Finma notes, colonne AE</li> <li>Finma circ. 2019/01 cm 103</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#treatment-of-sight-and-overnight-exposures-for-category-4-5-banks", "title": "Treatment of sight and overnight exposures for category 4 &amp; 5 banks", "text": "<ul> <li>Legal ref.<ul> <li>Finma notes, colonne AE</li> <li>Finma circ. 2019/01 cm 97-101</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#treatment-of-the-six-group-and-its-entities", "title": "Treatment of the SIX Group and its entities", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/#identifying-these-entities", "title": "Identifying these entities", "text": "<ul> <li>There are two ways to identify the SIX Group and its entities:<ul> <li>Either through the use of dedicated name in the field list_counterparties.LegalName, or their LEI in the field list_counterparties.LEI<ul> <li>SIX x-clear Ltd \u2192 5493000C6JWJSISPU377</li> <li>SIX SIS Ltd \u2192 549300A3XI3YWROC2J57</li> <li>SECB \u2192 529900YI7GR9R4L1UI63</li> <li>SIX Group Ltd \u2192 529900ZMNQFCPP762W05</li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/#list_counterparty_groups_lex", "title": "list_counterparty_groups_lex", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/#list_counterparty_groups_aris", "title": "list_counterparty_groups_aris", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/#list_counterparties", "title": "list_counterparties", "text": "<ul> <li>LegalName</li> <li>LEI</li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#table-b", "title": "Table B", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/#_1", "title": "...", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/#output-fields", "title": "Output fields", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/#core_positions_calc", "title": "core_positions_calc", "text": "<ul> <li>LEXRiskWeight</li> </ul>"}, {"location": "FunctionalDoc/Doc_LEX/#table-d", "title": "Table D", "text": ""}, {"location": "FunctionalDoc/Doc_LEX/#_2", "title": "...", "text": ""}, {"location": "FunctionalDoc/Doc_LEXParams/", "title": "LEX parameters", "text": "<ul> <li>ARIS_THRESHOLD: Boolean: Set to 1 to apply the insignificance threshold described in the ARIS notes under section 1.4. Default value 1.<ul> <li>The section 1.4 of the ARIS notes states that If a counterpart position amounts to less than CHF 1 million and, additionally, represents less than 4% of the reporting institution\u2019s core capital after deductions in accordance with arts. 31 \u2013 40 CAO, it is deemed to be insignificant and need not be reported. This param can either apply (param value = 1) or not (param value = 0) this alleviation.</li> </ul> </li> <li>LEX_GUARANTEED_SECURITIES: Boolean: Set to 1 to take the guarantor of guaranteed securities into account in LEX.<ul> <li>If set to 1, securities delivered which with a guarantor in the field <code>core_positions.GuarantorId</code> and the corresponding information in the table <code>list_counterparties</code> will be considered 100% covered by their guarantor. As a result:<ol> <li>Nostro securities will be considered covered by their guarantor, resulting in 0 net exposure against the group of issuer of the security and an indirect exposure toward the guarantor.</li> <li>Client securities used in the CRM will create indirect exposure toward the group of the guarantor instead of the group of the issuer of the security.</li> </ol> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/", "title": "LIQ - Calculated amounts fields", "text": ""}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>LIQ</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/#legal-references", "title": "Legal references", "text": "<ul> <li>N/A</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/#description", "title": "Description", "text": "<p>These fields are used for allocation in the LCR:   - LessStableNonHvdAmount: Uninsured, non-high-value deposits    - ExcessAmountHVD: High-value deposits   - OperationalAmountInsured: Operational amount insured by the protection scheme   - OperationalAmountNotInsured: Operational amount not insured by the protection scheme   - NonOperationalAmountInsured: Non Operational amount insured by the protection scheme   - NonOperationalAmountNotInsured: Non Operational amount not insured by the protection scheme   - IRNextPaymentAmount: Next Interest payment</p>"}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/#mercury-treatment", "title": "Mercury treatment:", "text": ""}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/#output", "title": "output:", "text": "<p>These fields are stored in the table core_positions_calc_lc when they can multiple data load source (ie. conso or adjustement) or core_positions_calc when it's specific to a position</p>"}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/#input", "title": "input:", "text": "<p>The \"sources\" of the calculation are: - core_positions_calc_lc.InsuredAmount (see: Doc_LIQDepositGaranteeCalc) - view: v_LCR_LiqInsuredAndHVDCalc:   - In this view we calculate per counterparty:     - The total amount insured     - The High Value Deposit (HVD) Threshold: threshold is 1.5 million CHF per counterparty minus the amount insured     - The amount uninsured above HVD which is the rest (if any) of the BookAmoun minus total insured minus HVD threshold - core_positions_calc.OperationalAmount (see: Doc_LIQOperationalAmountTreatment)</p>"}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/#calculation", "title": "calculation:", "text": "<p>scope: <code>AccountGroupLevel1 in('DueToBanks','DueToCustomer')</code> - core_positions_calc_lc.LessStableNonHvdAmount: \"split\" the BookAmount with the logic of the view above: BookAmount - InsuredAmount Threshold: 1'500'000 CHF (per counterparty) Order by: BookAmount desc - core_positions_calc_lc.ExcessAmountHVD: BookAmount - InsuredAmount - LessStableNonHvdAmount</p> <p>Check InsuredAmount + LessStableNonHvdAmount + ExcessAmountHVD = BookAmount - core_positions_calc_lc.OperationalAmountInsured: <code>IF core_positions_calc.OperationalAmount &gt;= core_positions_calc_lc.InsuredAmount THEN core_positions_calc_lc.InsuredAmount ELSE core_positions_calc.OperationalAmount</code> - core_positions_calc_lc.OperationalAmountNotInsured: <code>IF core_positions_calc.OperationalAmount &gt;= core_positions_calc_lc.InsuredAmount THEN core_positions_calc.OperationalAmount - core_positions_calc_lc.InsuredAmount ELSE 0</code> - core_positions_calc_lc.NonOperationalAmountInsured: <code>IF (core_positions.BookAmount - core_positions_calc_lc.OperationalAmountInsured) &lt;= (core_positions_calc_lc.InsuredAmount - core_positions_calc.OperationalAmountInsured) THEN core_positions_calc_lc.InsuredAmount - core_positions_calc_lc.OperationalAmountInsured - core_positions_calc.OperationalAmountNotInsured ELSE 0</code> - core_positions_calc_lc.NonOperationalAmountNotInsured: <code>core_positions.BookAmount - core_positions_calc_lc.OperationalAmountInsured - core_positions_calc_lc.OperationalAmountNotInsured - core_positions_calc_lc.NonOperationalAmountInsured</code></p> <p>Check OperationalAmountInsured + OperationalAmountNotInsured + NonOperationalAmountInsured + NonOperationalAmountNotInsured = BookAmount</p>"}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/#calculation-core_positions_calcirresidualpayementdays", "title": "calculation core_positions_calc.IRResidualPayementDays:", "text": "<pre><code>case \n    when cp.IRNextPaymentDate &gt; cl.ReportingDate then DATEDIFF(cp.IRNextPaymentDate,cl.ReportingDate) \n    when cp.IRNextFixingDate &gt; cl.ReportingDate then DATEDIFF(cp.IRNextFixingDate,cl.ReportingDate)\n    when cp.MaturityDate &gt; cl.ReportingDate then DATEDIFF(cp.MaturityDate,cl.ReportingDate)\nelse 0 end IRResidualPaymentDays\n</code></pre> <p>The fallback approach used is: If the IRNextPaymentDate is not delivered (or invalid) we use the IRNextFixingDate. If the IRNextFixingDate is not delivered (or invalid) we use the MaturityDate.</p> <p>then this date is compared whith the ReportingDate to calculate the Interest rate residual payment days on a 365 / year duration basis.</p>"}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/#calculation-core_positions_calcircalcnextpaymentdate", "title": "calculation core_positions_calc.IRCalcNextPaymentDate:", "text": "<pre><code>case \n    when cp.IRNextPaymentDate &gt; cl.ReportingDate then cp.IRNextPaymentDate\n    when cp.IRNextFixingDate &gt; cl.ReportingDate then cp.IRNextFixingDate\n    when cp.MaturityDate &gt; cl.ReportingDate then cp.MaturityDate\nelse '1900-01-01' end IRCalcNextPaymentDate,\n</code></pre> <p>By default we use IRNextPaymentDate The fallback approach used is: If the IRNextPaymentDate is not delivered (or invalid) we use the IRNextFixingDate. If the IRNextFixingDate is not delivered (or invalid) we use the MaturityDate.</p>"}, {"location": "FunctionalDoc/Doc_LIQCalculatedAmountsFields/#calculation-core_positions_calcirnextpaymentamount", "title": "calculation core_positions_calc.IRNextPaymentAmount:", "text": "<p>scope: <code>core_positions.InterestRate &lt;&gt; 0 and core_positions.MaturityType in('Cancellable','FixedTerm','OnCall','FixedTermRollover') and (core_positions.AccountGroupLevel1 in('DueFromBanks','DueFromSFT','DueFromCustomer','MortgageLoans','TradingPortfolioAssets','OtherInstrumentAtFV','FinancialInvestment','DueToBanks','LiabilitiesFromSFT','DueToCustomer','TradingPortfolioLiabilities','LiabilitiesOtherInstrumentAtFV','MTBonds','BondMortgageLoans') or (core_positions.TypeOf = 'Contract' and core_positions.SubType in('DerExc','DerOTC')))</code></p> <p><code>when MaturityType not in ('Cancellable','FixedTerm','OnCall')</code> The amount is 0</p> <p>core_positions_calc.IRNextPaymentAmount = </p> <pre><code>when core_positions.SubType not in('DerExc','DerOTC'): core_positions.BookAmount * core_positions.InterestRate * \n\ncase core_positions.IRPaymentFrequency\n    when 'M' then 30\n    when 'Q' then 90\n    when '6M' then 180\n    when 'Y' then 360\n    when '0' then \n          case \n   when StartDate &gt; '1900-01-01' and IRCalcNextPaymentDate &gt; '1900-01-01' and DATEDIFF(IRCalcNextPaymentDate,StartDate) &gt;= 360 then 360\n   when DATEDIFF(IRCalcNextPaymentDate,StartDate) &lt; 360 and StartDate &gt; '1900-01-01' then\ncase \n        when IRCalcNextPaymentDate &gt;= StartDate then DATEDIFF(IRCalcNextPaymentDate,StartDate) \n        else 0 \nend\n   when DATEDIFF(IRCalcNextPaymentDate,StartDate) &lt; 360 then case when IRNextFixingDate &gt; ReportingDate then DATEDIFF(IRCalcNextPaymentDate,ReportingDate) else 0 end\n   else 0\n  end\n    else 0\nend\n\nDIVIDED by 360\n</code></pre> <p>when core_positions.SubType in('DerExc','DerOTC') same calculation but with core_positions.Notional instead of core_positions.BookAmount</p>"}, {"location": "FunctionalDoc/Doc_LIQDepositGaranteeCalc/", "title": "LIQ - Insured deposit calculation", "text": ""}, {"location": "FunctionalDoc/Doc_LIQDepositGaranteeCalc/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>LIQ</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQDepositGaranteeCalc/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2015/02<ul> <li>cm. 186 to 191 </li> </ul> </li> <li>bcbsLCR40 (40.7 - 40.8 - 40.9)</li> <li>OLIQ 952.06<ul> <li>Section 3: </li> <li>Art.18<ul> <li>1b: priviledged</li> <li>1c: guaranteed</li> </ul> </li> </ul> </li> <li>LB 952.00<ul> <li>priviledged: Art. 37a</li> <li>guaranteed: Art. 37h</li> <li>Exceptions:</li> <li>Art. 1b: 1b-4.d</li> </ul> </li> <li>ESI Suisse</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQDepositGaranteeCalc/#201502-cm-186-treatment-requirement", "title": "2015/02 cm. 186 treatment requirement", "text": "<ul> <li>Macro threshold: 6 billion per bank</li> <li>Micro threshold: 100'000 per \"counterparty\"</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQDepositGaranteeCalc/#mercury-calculation", "title": "Mercury calculation:", "text": "<p>Disclaimer Mercury does not handle foreign deposit guarantee scheme yet</p>"}, {"location": "FunctionalDoc/Doc_LIQDepositGaranteeCalc/#input-fields", "title": "Input Fields:", "text": "<ul> <li>Record selection: </li> <li> <p>Perimeter: (no foreign subsidiaries or foreign branches)</p> <p><code>v_conso_entities.ConsoBankOffice = 1</code>    - Positions: </p> <p><code>core_positions_calc.AccountGroupLevel1 in('DueToCustomer','MTBonds')   core_positions.SubType not in('Pillar2','Pillar3A')  core_positions.Currency not in('XAG','XAU','XPD','XPT','XRH')</code> - Type of counterparties:</p> <p><code>core_module_specifics.PosCounterpartyType not in('Bank','BIS','CGCB','CHSIB','GSIB','CBank','MDB1','MDB2','JI','SCMBI','SF')  list_counterpraties.TypeOf not in('Bank','BIS','CGCB','CHSIB','GSIB','CBank','MDB1','MDB2','JI','SCMBI','SF')</code></p> </li> <li> <p>Grouping:</p> </li> <li>Currently, the micro threshold is done by Counterparty ID. There might be more options in a second iteration.</li> </ul> <p>Note: Within each \"rounds\" of coverage we treat position in that order of priority: 1) <code>core_positions.Currency = 'CHF'</code> 2) <code>core_positions.Currency in (select Value from param_parameters pp where Name = 'LIQ_G_LIST_CURRENCIES')</code> 3) <code>core_positions.Currency not in (select Value from param_parameters pp where Name = 'LIQ_G_LIST_CURRENCIES')</code></p> <ul> <li>2015/02 cm. 187 </li> <li>First round: \"Stable retail client deposits\":     <code>core_positions_calc.LiqTypeOf = 'Retail' and (core_module_specifics.PosCounterpartyType not in('NPPO', 'Corp') or list_counterpraties.TypeOf not in('NPPO', 'Corp')) and (core_positions.SubType in('TxAcc','OpAcc') or list_counterparties.EstablishedRelationshipFlag = 1)</code> 2015/02 cm. 187.1 to 187.3 <code>order by ResidualDurationDays desc</code> First iteration <code>core_positions.MaturityType &lt;&gt; 'Cancelled'</code> Second iteration <code>core_positions.MaturityType = 'Cancelled'</code> </li> <li>Second round: \"Stable deposits from small business customers\":    <code>core_positions_calc.LiqTypeOf in('Retail','SMEs') and (core_module_specifics.PosCounterpartyType in('NPPO', 'Corp') or list_counterpraties.TypeOf in('NPPO', 'Corp')) and (core_positions.SubType in('TxAcc','OpAcc') or list_counterparties.EstablishedRelationshipFlag = 1)</code> <code>order by ResidualDurationDays asc</code> </li> <li>Third round: \"less stable retail client deposits\"     <code>core_positions_calc.LiqTypeOf = 'Retail' and (core_module_specifics.PosCounterpartyType not in('NPPO', 'Corp') or list_counterpraties.TypeOf not in('NPPO', 'Corp')) and core_positions.SubType not in('TxAcc','OpAcc') and list_counterparties.EstablishedRelationshipFlag = 0</code> 2015/02 cm. 187.1 to 187.3 <code>order by ResidualDurationDays desc</code> First iteration <code>core_positions.MaturityType &lt;&gt; 'Cancelled'</code> Second iteration <code>core_positions.MaturityType = 'Cancelled'</code> </li> <li> <p>Fourth round: \"less stable deposits from small business customers\":  <code>core_positions_calc.LiqTypeOf in('Retail','SMEs') and (core_module_specifics.PosCounterpartyType in('NPPO', 'Corp') or list_counterpraties.TypeOf in('NPPO', 'Corp')) and core_positions.SubType not in('TxAcc','OpAcc') and list_counterparties.EstablishedRelationshipFlag = 0 order by ResidualDurationDays asc</code> </p> </li> <li> <p>Fifth round: \"deposits from other corporate and wholesale clients\":       <code>core_positions_calc.LiqTypeOf not in('Retail','SMEs') order by ResidualDurationDays asc</code> </p> </li> </ul> <p>### Output:  (calculation is applied on the counterpraty level for each positions of one loadcollection. A counterparty could technically have deposits in various entities or simply on different source files)</p> <ul> <li>This calculation will eventually replace tmp_lcr_LiqInsuredAndHVDCalc</li> <li>Output Fields (to be adapted depending on the solution):<ul> <li>LoadCollectionID</li> <li>PositionId</li> <li>InsuredAmount</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQDepositGaranteeCalc/#coverage-logic", "title": "Coverage logic:", "text": ""}, {"location": "FunctionalDoc/Doc_LIQDepositGaranteeCalc/#examples", "title": "Examples:", "text": "<ul> <li>Add screenshots to illustrate once the solution is up</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQDerivatives/", "title": "LIQ - Derivatives", "text": ""}, {"location": "FunctionalDoc/Doc_LIQDerivatives/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>LIQ</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQDerivatives/#derivatives-cash-inflowsoutflows", "title": "Derivatives cash inflows/outflows", "text": ""}, {"location": "FunctionalDoc/Doc_LIQDerivatives/#legal-references", "title": "Legal references", "text": "<ul> <li>Outflows derivatives:<ul> <li>LCR_G, l.138</li> <li>OLiq annexe 2 5.1</li> <li>Finma circ. 2015/02 249-271</li> </ul> </li> <li>Inflows derivatives:<ul> <li>LCR_G, l.206</li> <li>OLiq annexe 3 6.1</li> <li>Finma circ. 2015/02 298-298.1<ul> <li>cm 298 reference to cm 249 - 251</li> </ul> </li> </ul> </li> <li>OLiq annexe 2 5.6 ??</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQDerivatives/#inflowsoutflows-definition", "title": "Inflows/Outflows definition", "text": "<ul> <li>Relevant date to account for the 30 days threshold:<ul> <li>If no interest rate payment: <code>core_positions_calc.ResidualDurationDays</code></li> <li>If interest payment: <code>core_interest_rates.NextPaymentDate</code></li> </ul> </li> <li>Relevant amount to consider:<ul> <li>If options, consider only positions in-the-money:<ul> <li>Calls: <code>core_derivatives.SpotUnderlyingCurrency &gt; core_derivatives.StrikeUnderlyingCurrency</code> or <code>0.5 &lt; core_derivatives_calc.Delta &lt; 1</code></li> <li>Puts: <code>core_derivatives.SpotUnderlyingCurrency &lt; core_derivatives.StrikeUnderlyingCurrency or -0.5 &gt; core_derivatives_calc.Delta &gt; -1</code></li> </ul> </li> <li>If no interest rate payment:<ul> <li>Physically settled \u2192 consider both legs: if <code>core_derivatives.DeliveryMethod &lt;&gt; 'Cash'</code> or <code>core_derivatives_swaps.DeliveryMethod &lt;&gt; 'Cash'</code><ul> <li>Inflow: <code>core_derivatives_calc.RAmount</code></li> <li>Outflow: <code>core_derivatives_calc.PAmount</code></li> </ul> </li> <li>Cash settled \u2192 consider only the replacement value: if <code>core_derivatives.DeliveryMethod = 'Cash'</code> or <code>core_derivatives_swaps.DeliveryMethod = 'Cash'</code><ul> <li><code>core_positions.BookAmount</code> \u2192 inflow si positive replacement value, negative otherwise           </li> </ul> </li> </ul> </li> <li>If interest rate payment (IRS &amp; CCS):<ul> <li>Inflow: <code>core_derivatives_calc.RInterestPayment</code></li> <li>Outflow: <code>core_derivatives_calc.PInterestPayment</code></li> </ul> </li> <li>Remark:<ul> <li>If <code>RAmount = PAmount &amp; DeliveryMethod in ('','Cash')</code> \u2192 Input and output taken into account. Input error.</li> <li>Treatment of CDS to be clarified</li> </ul> </li> </ul> </li> <li>cm 252, 253, 298.1 ??</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQDerivatives/#netting-by-counterparty", "title": "Netting by counterparty", "text": "<ul> <li>If netting agreement in place (<code>core_positions.NettingAgreementType in ('CN','PN','NbN')</code>)<ul> <li>Assumption: all netting agreement types are recognized.</li> </ul> </li> <li>If FX derivative (independently of netting agreement) \u2192 Legal ref.: Finma circ. 2015/02 cm250.<ul> <li>For the LCR in CHF, positions on FX derivatives can be netted if they are executed the same day</li> <li>This treatment can be activated or deactivated with the parameter <code>LIQ_DER_FX_NETTING</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQHighValueDeposit/", "title": "LIQ - High Value deposit - High Value loan", "text": ""}, {"location": "FunctionalDoc/Doc_LIQHighValueDeposit/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>LIQ</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQHighValueDeposit/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2015/02<ul> <li>Retail: cm. 201-204</li> <li>SBC: cm. 211</li> <li>Pledged third pillar: cm. 240.1</li> </ul> </li> <li>bcbsLCR40 (40.23 &amp; 40.24)</li> <li>OLIQ Annex 2 - 1.2</li> <li>LCR_G, l.078</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQHighValueDeposit/#description", "title": "Description", "text": "<ul> <li>Demand and term deposits provided by retail clients with deposits greater than CHF 1.5m and a remaining maturity or cancellation period of up to 30 calendar days</li> <li>As explained in Finma circ. 2015/02 and OLiq annexe 2 1.2, only the part exceeding CHF1.5mio get an outflow rate of 20%. This portion of the deposit shall be computed in the field <code>core_positions_calc.HighValueDeposit</code> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQHighValueDeposit/#mercury-calculation", "title": "Mercury calculation:", "text": ""}, {"location": "FunctionalDoc/Doc_LIQHighValueDeposit/#input-fields", "title": "Input Fields:", "text": "<ul> <li>Record selection:   </li> <li> <p>Positions: High Value deposit (Missing: rationale)</p> <p><code>AccountGroupLevel1 in('DueToCustomer','MTBonds')   core_positions.SubType not in('Pillar2','Pillar3A')</code>    - Positions: High Value loan (Missing: rationale)</p> <p><code>AccountGroupLevel1 in('DueFromBanks','DueFromSFT','DueFromCustomer','MortgageLoans','ContingentLiabilities','IrrevocableCommitments','ObligationToPayUp','CreditCommitments')</code> - Grouping: (Missing: rationale)   - For now, grouping is done by Counterparty ID. We might give more options in a second iteration.</p> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQHighValueDeposit/#output", "title": "Output:", "text": "<p>(Requirements: we need to be able to apply a calculation on the counterparty level for one loadcollection. A counterparty could technically have deposits/loans in various entities or simply on different source files) - Table v_LCR_LiqRetailSmeEligibleFlag (to be adapted by CTO)   - Fields (to be adapted depending on the solution):     - LoadCollectionID     - CounterpartyId      - HighValueDeposit (sum BookAmount)     - HighValueLoan (sum BookAmount)     - (might be removed, simplifies the rule) LiqRetailSmeEligibleFlag: <code>case when HighValueDeposit &gt; 1'500'000 and HighValueLoan &gt; 1'500'000 then 0 else 1 end</code></p>"}, {"location": "FunctionalDoc/Doc_LIQHighValueDeposit/#mercury-treatment", "title": "Mercury treatment:", "text": "<ul> <li>We use this flag to define if a counterparty can be considered as Retail in the field LiqTypeOf according to Finma circ. 2015/02 cm. 211</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQOperationalAmountTreatment/", "title": "LIQ - Operational deposit treatment", "text": ""}, {"location": "FunctionalDoc/Doc_LIQOperationalAmountTreatment/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>LIQ</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQOperationalAmountTreatment/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2015/02</li> <li>Definition: cm. 214 to 224</li> <li>cm. 225 to 227 (internal model)</li> <li>cm. 228 to 231 (cat 4 &amp; 5 treatment)</li> <li> <p>cm. 296</p> </li> <li> <p>OLIQ 952.06</p> </li> <li>Appendix 3 nb. 4</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQOperationalAmountTreatment/#201502-cm-228-to-231-requirements", "title": "2015/02 cm. 228 to 231 requirements:", "text": "<ol> <li>For non-financial corporates, central governments, central banks, subordinated local authorities and other public sector entities and multilateral development banks: 80 percent of their deposits are not operational</li> <li>For financial institutions which are not banks and for all other legal entities and corporate clients: 90 percent of their deposits are not operational</li> <li>For banks: 100 percent of their deposits are not operational</li> </ol>"}, {"location": "FunctionalDoc/Doc_LIQOperationalAmountTreatment/#parameter", "title": "Parameter", "text": "<p><code>param_parameters.Name = 'LIQ_OPERATIONAL_AMOUNT'</code></p> <p>Possible values: - D: Default value, no specific treatment Operational amount will only be applied on Retail and small business customers. No internal models - S: Simplification for cat. 4&amp;5 bank described in circ. 2015/02 cm228-231 - M: Internal model. For setup please contact Quadrum - I: Use delivered values, regardless of the counterparty type  </p>"}, {"location": "FunctionalDoc/Doc_LIQOperationalAmountTreatment/#mercury-calculation", "title": "Mercury calculation:", "text": "<p>Disclaimer Mercury does not handle internal model yet</p>"}, {"location": "FunctionalDoc/Doc_LIQOperationalAmountTreatment/#input-fields", "title": "Input Fields:", "text": "<ul> <li>The input field for the operational amount is: <code>core_module_specifics.OperationalAmount</code></li> <li>Operational accounts can be flagged in: <code>core_positions.SubType = 'OpAcc'</code></li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQOperationalAmountTreatment/#output-fields", "title": "Output Fields:", "text": "<ul> <li>The report will use the amount calculated in field: <code>core_positions_calc.OperationalAmount</code> depending on the parameter LIQ_OPERATIONAL_AMOUNT</li> <li>Example for Value S:<ul> <li><code>LiqTypeOf in ('Retail','SME') -&gt; core_positions_calc.OperationalAmount = core_module_specifics.OperationalAmount</code></li> <li><code>LiqTypeOf in ('NonFinancialCorp','Sovereign','CentralBank','PSEs','MDBs') -&gt; core_positions_calc.OperationalAmount = core_positions.BookAmount*0.2</code></li> <li><code>LiqTypeOf in ('FinancialNonBanks') -&gt; core_positions_calc.OperationalAmount = core_positions.BookAmount*0.1</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQRetailSmeEligibleFlag/", "title": "LIQ - Retail or SME Eligible Flag", "text": ""}, {"location": "FunctionalDoc/Doc_LIQRetailSmeEligibleFlag/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>LIQ</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQRetailSmeEligibleFlag/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2015/02 cm. 211</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQRetailSmeEligibleFlag/#description", "title": "Description", "text": "<ul> <li>Small and medium company or private non financial company with (consolidated) credit or deposit volume lower than 1.5m can be considered as retail deposits</li> <li>In mercury we consider:<ul> <li>AccountGroupLevel1 in('DueToBanks','DueToCustomer') for TotalDeposits</li> <li>AccountGroupLevel1 in('DueFromBanks','DueFromCustomer') for TotalLoans</li> <li>list_counterparties.TypeOf in('NPPO','Corp')</li> <li>sum of core_positions.Bookamount</li> <li>if none of the sums above pass the threshold of CHF 1.5m the field LiqRetailSmeEligibleFlag is equal to 1 in the view v_LCR_LiqRetailSmeEligibleFlag. As a consequence the core_positions_calc.LiqTypeOf field is forced to Retail or SMEs</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/", "title": "LIQ - Secured Funding and Lending treatment", "text": ""}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>LIQ</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2015/02</li> <li> <p>nb. 175 </p> </li> <li> <p>OLIQ 952.06</p> </li> <li> <p>Art. 15e</p> </li> <li> <p>LCR 40</p> </li> <li>40.5 FAQ 1   BCBS</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#high-level-concept", "title": "High level concept", "text": "<ul> <li>In section B) 1 c) Secured funding run-off</li> <li>It is required to define the type of security used to back the Repo</li> <li>In secition B) 2 a) a) Secured lending including reverse repo and securities borrowing</li> <li>It is required to define the type of security used to back the ReverseRepo</li> <li>This link is also used to calculate unwind according to Art. 15e of OLIQ. Required in line 125 - 126 - 130 - 131 - 548 to 184.</li> <li>According to BCBS 40.5 FAQ1:</li> </ul> <p>If a deposit is contractually pledged to a bank as collateral to secure a credit facility or loan granted by the bank that will not mature or be settled in the next 30 days, should the pledged deposit be excluded from the calculation of the total expected cash outflows under the LCR?</p> <pre><code>The pledged deposit may be excluded from the LCR calculation only if the following conditions are met:\n-   the loan will not mature or be settled in the next 30 days;\n-   the pledge arrangement is subject to a legally enforceable contract disallowing withdrawal of the deposit before the loan is fully settled or repaid; and\n-   the amount of deposit to be excluded cannot exceed the outstanding balance of the loan (which may be the drawn portion of a credit facility).\nThe above treatment does not apply to a deposit which is pledged against an undrawn facility, in which case the higher of the outflow rate applicable to the undrawn facility or the pledged deposit applies.\n</code></pre> <p>As this FAQ is not directly mentionned into Swiss regulations it is not a defaut treatment. It is triggered only when the parameter: - LIQ_RetailDepositRunOff;LIQ;1;Exclude from LCR retail deposits used to cover loan with a maturity &gt; 30 days. Default value 0</p>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#secured-fundinglending-calculation", "title": "Secured funding/lending calculation:", "text": "<p>During LIQ Secured calculation Mercury will match the on-balance sheet Repo and Reverse Repo and the corresponding security: - Either with a Legal Account number corresponding to:   - Item 1.3: Amounts due from securities financing transactions: core_positions.LegalAccountNumber = 103001   - Item 2.2: Liabilities from securities financing transactions: core_positions.LegalAccountNumber = 202001 - Or any Load or Deposit flagged as repo/rrepo:   - core_positions.SubType = 'Repo'</p>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#input-fields", "title": "Input Fields:", "text": "<p>Position secured: <code>core_positions.LegalAccountNumber in(103001,202001) or (left(core_positions.LegalAccountNumber,3) in (102,104,105,201,203) and core_positions.SubType = 'Repo')</code> Security lended/borrowed:<code>core_positions.TypeOf = 'Security'</code> link with Position secured:<code>core_positions.ContractId</code> relation prerequisite:<code>Position secured 1 : n Security lended/borrowed</code></p>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#process", "title": "Process:", "text": "<p>Treatment is similar to a crm we use securities to \"cover\" load/deposit  \"Order by\" of Security lended/borrowed used: core_positions_calc.HQLACategory:    1. 'L1'     2. 'L2a'     3. 'L2b'    4. '' (empty)</p> <p>Position secured is covered up to his core_positions.BookAmount Security lended/borrowed is used up to his core_positions.BookAmount</p>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#output-fields", "title": "Output Fields:", "text": ""}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#table-core_positions_crm_liq", "title": "table: core_positions_crm_liq", "text": "<ul> <li>LoadCollectionId  </li> <li>CollateralLoadId  </li> <li>CollateralId  </li> <li>ExposureLoadId    </li> <li>ExposureId    </li> <li>Order </li> <li>AmountCovered </li> <li>CollateralAmountUsed  </li> <li>CollateralPVUsed  (core_positions.PV of the collateral proportional of the BookoAmount used)</li> <li>(nice to have) CollateralHQLACategory </li> <li>(nice to have) CollateralLiqTypeOf    </li> <li>(nice to have) CollateralCARiskWeight </li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#retail-deposit-runoff-calculation", "title": "Retail Deposit RunOff calculation:", "text": "<p>if LIQ_RetailDepositRunOff = 1 then:  During LIQ Deposit RunOff calculation Mercury will match the loan with a maturity above 30 days with the deposits with a maturity &lt; 30 days providing there are pledged</p>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#input-fields_1", "title": "Input Fields:", "text": "<p>Loans:<code>left(core_positions.LegalAccountNumber,3) in (102,104,105) and PledgeFlag = 1 and ((MaturityType not in('Cancellable') and ResidualDurationDays &gt; 30) or LCRIncludeFlow = 1)</code> Deposits:<code>left(core_positions.LegalAccountNumber,3) in (202) and PledgeFlag = 1 and ((MaturityType not in('Cancellable') and ResidualDurationDays &lt;= 30) or LCRIncludeFlow = 1) and core_positions_calc.LiqTypeOf = 'Retail</code> Link:<code>Loans.CounterpartyId = Deposits.CollateralHolderId</code></p>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#process_1", "title": "Process:", "text": "<p>Treatment is similar to a crm we use securities to \"cover\" load/deposit  No priority applied</p> <p>Loan is covered up to his core_positions.BookAmount Deposit are used up to his core_positions.BookAmount</p>"}, {"location": "FunctionalDoc/Doc_LIQSecuredFundingAndLending/#output-fields_1", "title": "Output Fields:", "text": "<p><code>core_positions_calc_lc.LIQDepositRunOff</code> similar to what is calculated on MonaCollateralUsedAmount but on the Deposits record use case:  if a deposits covers completely a loan deposit.BookAmount - deposit.LIQDepositRunOff = 0 if a deposits covers partially a loan deposit.BookAmount - deposit.LIQDepositRunOff &gt; 0</p> <p>details could be added in <code>core_positions_crm_liq</code> only these fields would be filled: - LoadCollectionId - CollateralLoadId - CollateralId - ExposureLoadId   - ExposureId   - Order  - AmountCovered  - CollateralAmountUsed  </p>"}, {"location": "FunctionalDoc/Doc_LIQWithdrawalLimit/", "title": "LIQ - Withdrawal restrictions DRAFT", "text": ""}, {"location": "FunctionalDoc/Doc_LIQWithdrawalLimit/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>LIQ</li> <li>SNB</li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQWithdrawalLimit/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2015/02<ul> <li>cm. 183.3</li> <li>cm. 194-197</li> <li>cm. 198:</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LIQWithdrawalLimit/#mercury-input", "title": "Mercury input:", "text": ""}, {"location": "FunctionalDoc/Doc_LIQWithdrawalLimit/#input-fields", "title": "Input Fields:", "text": "<ul> <li>Account with a withdrawal limitation: </li> </ul> <p><code>core_positions.SubType = 'WLACC'</code></p> <ul> <li>Account with a partial withdrawal limitation</li> </ul> <p><code>core_positions.\"LimitWithdrawalAmount\" = 123456</code></p> <p>### Parameter:    - Only used when importing a flat file:      - PARAM_NAME possible values:        - 1: (def)</p>"}, {"location": "FunctionalDoc/Doc_LTV/", "title": "Mortgage-backed exposures", "text": ""}, {"location": "FunctionalDoc/Doc_LTV/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_LTV/#legal-references", "title": "Legal references", "text": "<ul> <li>OFRnew<ul> <li>Art.72-72g</li> <li>Appendix 3 chi.3</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LTV/#risk-weighting", "title": "Risk weighting", "text": "<ul> <li>Requirement of art.72c al.1-3 are met:<ul> <li>Residential property - Own-use (appendix 3 chi.3.1)<ul> <li> <ul> <li>If the position is subordinated AND the RW associated to the LTV is not the lowest one \u2192  (art.72c al.6)</li> </ul> </li> </ul> </li> <li>Residential property - Other (appendix 3 chi.3.2)<ul> <li> <ul> <li>If the position is subordinated AND the RW associated to the LTV is not the lowest one \u2192  (art.72c al.6)</li> </ul> </li> </ul> </li> <li>Commercial property - Own-use \u2192  (appendix 3 chi.3.3)<ul> <li> <ul> <li>If the position is subordinated AND the RW associated to the LTV is not the lowest one \u2192  (art.72c al.6)</li> </ul> </li> </ul> </li> <li>Commercial property - Own-use \u2192  (appendix 3 chi.3.3)<ul> <li> <ul> <li>If the position is subordinated AND the RW associated to the LTV is not the lowest one \u2192  (art.72c al.6)</li> </ul> </li> </ul> </li> <li>Commercial property - Other (appendix 3 chi.3.4)<ul> <li> <ul> <li>If the position is subordinated AND the RW associated to the LTV is not the lowest one \u2192  (art.72c al.6)</li> </ul> </li> </ul> </li> </ul> </li> <li>Requirement of Art.72c al.1-3 are not met:<ul> <li>Residential &amp; commercial property - Own-use (art.72c al.5 let.a):<ul> <li>Individual person:  </li> <li>SME:  </li> <li>Other: RW of the counterparty</li> </ul> </li> <li>Residential &amp; commercial property - Other (art.72c al.5 let.b):<ul> <li> </li> </ul> </li> </ul> </li> <li>Land &amp; construction loans<ul> <li>For residential property - Own-use (appendix 3 chi.3.1) where requirements of art.72c al.1 let.b-f are met (art.72e al.2)<ul> <li> </li> </ul> </li> <li>For residential property - Own-use (appendix 3 chi.3.1) where requirements of art.72c al.1 let.b-f are not met (art.72e al.2)<ul> <li>  (see above)</li> </ul> </li> <li>For residential property - Other, where requirements of art.72c al.1 let.b-f are met (art.72e al.3) and <ul> <li> </li> </ul> </li> <li>For residential property - Other, where requirements of art.72c al.1 let.b-f are not met (art.72e al.3) or <ul> <li> </li> </ul> </li> <li>For commercial property - Own-use<ul> <li>  (see above)</li> </ul> </li> <li>For commercial property - Other<ul> <li> </li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_LTV/#relevant-input-fields-for-corresponding-conceptsnotions", "title": "Relevant input fields for corresponding concepts/notions", "text": "<ul> <li>Own-use \u2192 <code>list_properties.UseOf = 'PU'</code></li> <li>Residential property \u2192 <code>list_properties.TypeOf in ('Condo','SFH','MFH')</code></li> <li>Commercial property \u2192 <code>list_properties.TypeOf not in ('Condo','SFH','MFH')</code></li> <li>One of the requirements of art.72c al.1-3 are not met (for land/construction loan)<ul> <li><code>core_positions.SubType in ('MortgageLoanROL-ETP','MortgageLoanCons-ETP','MortgageLoanPA-ETP')</code></li> </ul> </li> <li>Land/Construction loan \u2192 <code>core_positions.SubType in ('MortgageLoanCons','MortgageLoanCons-ETP')</code></li> <li>Lending value (valeur de nantissement) \u2192 <code>list_properties.LendingValue</code></li> </ul>"}, {"location": "FunctionalDoc/Doc_LTV/#loan-to-value-ltv-calculation", "title": "Loan-to-value (LTV) calculation", "text": "<ul> <li>  (art.72a al.1)<ul> <li>The pledged cash which can decrease the numerator is pledged cash which enter an asset-liability netting agreement and can be recognized as: <code>core_positions.NettingAgreementType='NAL' and core_positions.PledgedFlag = 1 and core_positions.Type = 'Account' and core_positions_calc.CAEligibilityFlag = 1</code></li> <li>If this cash is used here, it should not be used during the CRM again</li> </ul> </li> <li>The LTV is computed per pledged property<ul> <li>If multiple pledges for one credit, use an appropriate distribution key to distribute the total credit amount to each pledge so that an LTV can be computed for each pledge (art.72a al.2)<ul> <li>Suggestion: proportional to the initial pledge value (=lending value) of each pledge </li> <li>Actually the same as adding the property values together and apply the same LTV to the whole loan</li> </ul> </li> </ul> </li> <li>New table/view with following fields \u2192 <code>LTV_calc</code><ul> <li><code>lcId</code> [pk]</li> <li><code>Id</code> [pk] \u2192 <code>core_positions.ContractId</code> or <code>core_positions.Id</code> if the first not delivered </li> <li><code>GrossExposure</code></li> <li><code>NetExposure</code></li> <li><code>LendingValue</code></li> <li><code>LTV</code></li> </ul> </li> <li>We probably need another table similar to <code>core_positions_crm_ca</code> to show how properties/loans/cash/... are linked together.</li> </ul>"}, {"location": "FunctionalDoc/Doc_LTV/#process", "title": "Process", "text": "<ul> <li>LTV calculation \u2192 <code>LTV_calc</code><ul> <li>Numerator calculation<ul> <li>Group loans and credit commitments together via <code>core_positions.ContractId</code></li> <li>Compute a net exposure by deducting cash deposits which are in the same netting agreement \u2192 link with <code>core_positions.NettingSetId</code></li> </ul> </li> <li>Denominator and ratio calculation<ul> <li>Link the net exposure computed above, to mortgage certificates/contracts in a similar manner as during CRM</li> <li>For each pool of mortgages &amp; mortgage certificates/contracts get the sum of the <code>list_properties.LendingValue</code> of distinct properties<ul> <li><code>list_properties</code> is linked to the mortgage certificate/contract (not the mortgage)</li> </ul> </li> <li>TBD: How to handle portfolio of properties ?</li> </ul> </li> </ul> </li> <li>Rule to compute counterparty risk weight (appendix 2, 3, 4) \u2192 <code>core_positions_calc.CACounterpartyRiskWeight</code> </li> <li>Rule to compute risk weight incorporating LTV  \u2192 <code>core_positions_calc.CALTVRiskWeight</code>(function of LTV and ... )</li> <li>Rule to compute final risk weight \u2192 <code>core_positions_calc.CARiskWeightB4</code> </li> <li>CRM<ul> <li>Mortgage loan positions which got an LTV calculated also enter CRM</li> <li>Mortgage certificates/contracts are excluded from CRM</li> <li>Do not use the cash entering the LTV calculation</li> </ul> </li> </ul> <ul> <li>PropertyId \u2192 lien sur PortfolioId ?</li> <li>utiliser portfolioid pour le cas ou plusieurs propri\u00e9t\u00e9s</li> <li>TrancheId</li> <li>Interface Rt01 if link on mortgage </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCommodityRisk/", "title": "MAR - Commodity Risk", "text": ""}, {"location": "FunctionalDoc/Doc_MARCommodityRisk/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCommodityRisk/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ.</li> <li>cm 145 - 150.1</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCommodityRisk/#description", "title": "Description", "text": "<ul> <li>There are three types of risk to account for:</li> <li>The risk of change in spot price</li> <li>The forward gap risk \u2192 change in forward price not explained by interest rate changes. For example because of change in inventory cost.</li> <li>The basis risk that denotes the risk of a change in price relationships between two similar but not identical commodities </li> <li>Gold not included in commodity risk (foreign exchange risk)</li> <li>cm 150: ?? \u2192 examples? Does it mean that one position can take more than one risk?</li> <li>155.1 says interest rate risk also covered here</li> <li>cm 150.1: physical delivery with the intent to keep it until expiration (??)</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCommodityRisk/#maturity-band-methodmaturity-ladder-approach-cm-1551-1553", "title": "Maturity band method/Maturity ladder approach (cm 155.1 - 155.3)", "text": "<ul> <li>Not supported yet. To develop on request.</li> <li>Treatment done by commodity (<code>list_commoditiy.SubType</code>):</li> <li>Position distributed in maturity bucket</li> <li>Spot positions in the first maturity bucket</li> <li>In each maturity bucket, the matched position is multiplied by corresponding spread (cm 155.2) \u2192 required equity</li> <li>Each net position can be pushed in the next maturity bucket to offset the net position of another maturity bucket (required equity of 0.6% of the \"moved\" net position per maturity bucket)</li> <li>The resulting ultimate net position has a required equity of 15%</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCommodityRisk/#simplified-approach-cm-156", "title": "Simplified approach (cm 156)", "text": "<ul> <li>Required equity:</li> <li>15% of net position by commodity</li> <li>3 % of gross position</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCommodityRisk_B4/", "title": "MAR - Commodity Risk (COM)", "text": ""}, {"location": "FunctionalDoc/Doc_MARCommodityRisk_B4/#used-in-the-following-modules", "title": "Used in the following modules:", "text": "<ul> <li>MAR-SSA</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCommodityRisk_B4/#legal-references", "title": "Legal references", "text": "<ul> <li>Basel framework MAR40.63-40.73;</li> <li>OFR Art.86a;</li> <li>OMar-FINMA Art.31-36, Ann.3.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCommodityRisk_B4/#description", "title": "Description", "text": "<ul> <li>The risks associated with commodities are described in MAR40.65;</li> <li>Gold is excluded from commodities risk (which si treated as a foreign currency);</li> <li>For the purposes of calculating open positions...</li> <li>long and short positions in each commodity may be reported on a net basis (Art.34 let.a).</li> <li>...but netting between different subcategories are permitted in cases where these subcategories: </li> <li>are deliverable against each other (Art.34 let.b) or </li> <li>are close substitutes and a minimum correlation of 0.9 between the price movements can be clearly established over a minimum period of 1 year (Art.43 let.c).</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCommodityRisk_B4/#maturity-ladder-approach-art35", "title": "Maturity ladder approach (Art.35)", "text": "<ul> <li>A separate maturity ladder will be used for each commodity/subcategories of commodities (<code>list_commodities.MARSubType</code>)</li> <li>Position distributed in maturity buckets (OMar-FINMA Ann.3) according to <code>calc_P_mar_base.ContractResidualDurationDays</code>;</li> <li>Physical stocks should be allocated to the first maturity bucket (Art.35 al.2);</li> <li>Position with the same maturity date may be offset (Art.35 al.1 let.a);</li> <li>For markets that have daily delivery dates, any contracts maturing within 10 days of one another may be offset (Art.35 la.1 let.b not supported yet);</li> <li>In each maturity bucket, the sum of short and long positions that are matched will be multiplied first by the spot price for the commodity and then by the spread rate of 1.5% \u2192 required equity (OMar-FINMA Ann.3.2.2);</li> <li>The residual net positions from nearer time bands may then be carried forward to offset exposures in maturity buckets that are further out. However, a surcharge equal to 0.6% of the net position carried forward will be added in respect of each maturity bucket that the net position is carried forward (OMar-FINMA Ann.3.2.3).</li> <li>At the end of the process, a bank will have either only long or only short positions, to which a capital requirement of 15% will apply (OMar-FINMA Ann.3.2.5);</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCommodityRisk_B4/#simplified-approach-art36", "title": "Simplified approach (Art.36)", "text": "<ul> <li>The capital requirement will equal 15% of the net position, long or short, in each commodity/subcategories of commodities;</li> <li>An additional capital requirement to 3 % of gross position, long plus short, in each commodity/subcategories of commodities;</li> <li>In valuing the gross positions in commodity derivatives, banks should use the current spot price (<code>calc_P_mar_base.MarketValue</code>).</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCreditDerivatives/", "title": "MAR - Credit Derivatives", "text": ""}, {"location": "FunctionalDoc/Doc_MARCreditDerivatives/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCreditDerivatives/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. cm 200 - 227.1</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCreditDerivatives_B4/", "title": "MAR - Credit Derivatives", "text": ""}, {"location": "FunctionalDoc/Doc_MARCreditDerivatives_B4/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARCreditDerivatives_B4/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. cm 200 - 227.1</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis/", "title": "MAR - De Minimis approach", "text": ""}, {"location": "FunctionalDoc/Doc_MARDeMinimis/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2008/20 cm 49 - 62</li> <li>OFR Art. 5</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis/#description", "title": "Description", "text": "<ul> <li>Under certain conditions described below, a bank is not obliged to compute interest rate risks and equity risk with the market risk standard approach.<ul> <li>No need as well to compute capital requirement for gamma and vega impact or options on interest rate and equity.</li> <li>equity risk \u2192 calculation in netting by issuer ??</li> </ul> </li> <li>cm 60 \u2192 does it mean that all other options are included in market risk, no matter if banking or trading book?</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis/#determining-volume-of-the-trading-portfolio", "title": "Determining volume of the trading portfolio", "text": "<ul> <li>The determining volume of the trading book is the sum of the following elements:<ol> <li>cm 53: <code>sum(core_positions.BookAmount) where (core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 300000) and core_positions.SubType not in ('DerExc','DerOTC') and core_positions.TradingBookFlag = 1</code></li> <li>cm 54: <code>sum(core_positions.BookAmount * core_derivatives_calc.Delta) where core_positions.SubType in ('DerOTC','DerExc') and core_derivatives.TypeOf in ('Call','Put','SwaptR','SwaptP') and core_positions.TradingBookFlag = 1</code><ul> <li>\"de toutes les valeurs de base sous-jacentes \" (??)</li> </ul> </li> <li>cm 55: <code>sum(max(core_derivatives_calc.Ramount,core_derivatives_calc.Pamount)) where core_positions.SubType in ('DerOTC','DerExc') and core_derivatives.TypeOf not in ('Call','Put','SwaptR','SwaptP') and core_positions.TradingBookFlag = 1</code></li> </ol> </li> <li>The following positions can be ignored (??)<ul> <li>cm 56 to 58 (cm 123)</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis/#conditions-for-de-minimis-application", "title": "Conditions for De Minimis application", "text": "<ul> <li>The De Minimis approach can be applied if the all the conditions below are met (cumulative):<ol> <li>No CDS in the trading book \u2192 <code>core_derivatives.TypeOf = 'CDS' and core_positions.TradingBookFlag = 1</code></li> <li> , where:<ul> <li>Determining trading book volume \u2192 see section above</li> <li>Balance sheet size \u2192<code>sum(core_positions.BookAmount) where (core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 200000)</code></li> <li>Contingent liabilities \u2192 <code>sum(core_positions.BookAmount)  where (core_positions.LegalAccountNumber &gt; 301000 and core_positions.LegalAccountNumber &lt; 302000)</code></li> <li>Irrevocable commitments \u2192 <code>sum(core_positions.BookAmount)  where (core_positions.LegalAccountNumber &gt; 302000 and core_positions.LegalAccountNumber &lt; 303000)</code></li> <li>Obligations to pay up shares and make further contributions \u2192 <code>sum(core_positions.BookAmount)  where (core_positions.LegalAccountNumber &gt; 303000 and core_positions.LegalAccountNumber &lt; 304000)</code></li> <li>Credit commitments \u2192 <code>sum(core_positions.BookAmount) where</code></li> <li>Volume of all derivative contracts open  \u2192 <code>sum(core_positions.Notional) where  where (core_positions.SubType in ('DerOTC','DerExc')</code></li> </ul> </li> <li> </li> </ol> </li> <li>Remarks:<ul> <li>The conditions 2 and 3 above shall not be breached at any moment. As we only have the bank's data at the reporting date, it is the respondibility of the bank to make sure these conditions are not breached when no data are available.</li> <li>In condition 2, the balance sheet size should be the one of the last quarter. As a simplification, we will compute the balance sheet size of the current quarter. The bank should be able to overwrite this value manually with the previous quarter data if it wishes to.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis_B4/", "title": "MAR - de minimis approach", "text": ""}, {"location": "FunctionalDoc/Doc_MARDeMinimis_B4/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR de-minimis</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis_B4/#legal-references", "title": "Legal references", "text": "<ul> <li>Basel framework n/a</li> <li>OFR Art.83 al.3</li> <li>OCre-FINMA Art.50-52</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis_B4/#description", "title": "Description", "text": "<ul> <li>A bank does not need to use one of the standardized or model-based approaches to calculate capital requirements for market risk concerning interest rate risk and equity risk if its trading book:</li> <li>at no time exceeds CHF 30 millions (Art.50 let.a) and</li> <li>at no time exceeds 6% of the BS and OBS since the last quartely statement (Art.50 let.b).  Both conditions must be fulfilled cumulatively and the bank must no hold any credit derivatives in its trading portfolio (Art.83 al.3)</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis_B4/#determining-volume-of-the-trading-portfolio-art51", "title": "Determining volume of the trading portfolio (Art.51)", "text": "<ul> <li>The trading portfolio's size is determined by adding:<ol> <li>Art.51 let.a: <code>sum(core_positions.BookAmount) where (core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 300000) and core_positions.SubType not in ('DerExc','DerOTC') and core_positions.TradingBookFlag = 1</code></li> <li>Art.51 let.b: <code>sum(core_positions.BookAmount * core_derivatives_calc.Delta) where core_positions.SubType in ('DerOTC','DerExc') and core_derivatives.TypeOf in ('Call','Put') and core_positions.TradingBookFlag = 1</code></li> <li>Art.51 let.c: <code>sum(max(core_derivatives_calc.Ramount,core_derivatives_calc.Pamount)) where core_positions.SubType in ('DerOTC','DerExc') and core_derivatives.TypeOf not in ('Call','Put') and core_positions.TradingBookFlag = 1</code></li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis_B4/#volume-limit-for-the-trading-portfolio-art50", "title": "Volume limit for the trading portfolio (Art.50)", "text": "<ul> <li> <p>The De Minimis approach can be applied if the all the conditions below are met (cumulative):</p> <ol> <li> , where:<ul> <li>Determining trading book volume \u2192 see section above</li> <li>Balance sheet size \u2192<code>sum(core_positions.BookAmount) where (core_positions.LegalAccountNumber &gt; 0 and core_positions.LegalAccountNumber &lt; 200000)</code></li> <li>Contingent liabilities \u2192 <code>sum(core_positions.BookAmount)  where (core_positions.LegalAccountNumber &gt; 301000 and core_positions.LegalAccountNumber &lt; 302000)</code></li> <li>Irrevocable commitments \u2192 <code>sum(core_positions.BookAmount)  where (core_positions.LegalAccountNumber &gt; 302000 and core_positions.LegalAccountNumber &lt; 303000)</code></li> <li>Obligations to pay up shares and make further contributions \u2192 <code>sum(core_positions.BookAmount)  where (core_positions.LegalAccountNumber &gt; 303000 and core_positions.LegalAccountNumber &lt; 304000)</code></li> <li>Credit commitments \u2192 <code>sum(core_positions.BookAmount) where</code></li> <li>Volume of all derivative contracts open  \u2192 <code>sum(core_positions.Notional) where  where (core_positions.SubType in ('DerOTC','DerExc')</code></li> </ul> </li> <li> </li> <li>Remarks:</li> <li>The conditions 2 and 3 above shall not be breached at any moment. As we only have the bank's data at the reporting date, it is the respondibility of the bank to make sure these conditions are not breached when no data are available.</li> <li>In condition 2, the balance sheet size should be the one of the last quarter. As a simplification, we will compute the balance sheet size of the current quarter. The bank should be able to overwrite this value manually with the previous quarter data if it wishes to.</li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARDeMinimis_B4/#netting-of-positions-art52", "title": "Netting of positions (Art.52)", "text": "<ul> <li>Positions that can be netted as per simplied standardized approach may be disregarded while observing the following points:<ul> <li>Contrary to Art.9 al.1 let.b, swaps, FRAs and forwards may be netted with each other if the interest fixing date/maturity date are within 10 calendar days of each other.</li> <li>For futures \u2192 identical underlying instruments and maturities not more than seven calendar days apart. This applies not only to IR futures but also to equity, equity index, currency, gold and commodity futures.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MAREquityRisk/", "title": "MAR - Equity Risk", "text": ""}, {"location": "FunctionalDoc/Doc_MAREquityRisk/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAREquityRisk/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2008/20 cm 126 - 130</li> <li>OFR</li> <li>Art. 51</li> <li>Art. 85 al. 2</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAREquityRisk/#description", "title": "Description", "text": "<ul> <li>There are two types of risk to account for:<ol> <li>General risk: Risk due to fluctuations in the relevant national equity market</li> <li>Specific risk: risk which are attributable to the issuer of the equity and cannot be explained by general market fluctuations</li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MAREquityRisk/#general-risk-cm-130", "title": "General risk (cm 130)", "text": "<ul> <li>Net position by national market</li> <li>Required equity represents 8% of the net positions</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAREquityRisk/#specific-risk-cm-126-127", "title": "Specific risk (cm 126 - 127)", "text": "<ul> <li>Net position by issuer (<code>v_mr_net.IssuerId</code>) following the methodology of art. 51 of the OFR</li> <li>Required equity represents 8% of the net positions</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAREquityRisk_B4/", "title": "MAR - Equity Risk (EQ)", "text": ""}, {"location": "FunctionalDoc/Doc_MAREquityRisk_B4/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR-SSA</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAREquityRisk_B4/#legal-references", "title": "Legal references", "text": "<ul> <li>Basel framework MAR40.41-40.52</li> <li>OFR Art.85</li> <li>OMar-FINMA Art.22-27</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAREquityRisk_B4/#description", "title": "Description", "text": "<ul> <li>There are two types of risk to account for:<ol> <li>General EQ risk: risk due to fluctuations in the relevant national equity market.</li> <li>Specific EQ risk: risk which are attributable to the issuer of the equity and cannot be explained by general market fluctuations.</li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MAREquityRisk_B4/#general-eq-risk-art26", "title": "General EQ risk (Art.26)", "text": "<ul> <li>Net position in each national market (<code>calc_P_mar_base.NationalMarket</code>)</li> <li>Capital requirement represents 8% of the sum of the net positions in each national market.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAREquityRisk_B4/#specific-eq-risk-art27", "title": "Specific EQ risk (Art.27)", "text": "<ul> <li>Net position in each individual equity (<code>calc_P_mar_base.SecurityId</code>) following the methodology of OFR Art.51.</li> <li>Capital requirement represents 8% of the sum of net positions in each individual equity.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARForeignExchangeRisk/", "title": "MAR - Foreign Exchange Risk", "text": ""}, {"location": "FunctionalDoc/Doc_MARForeignExchangeRisk/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARForeignExchangeRisk/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2008/20 cm 143 - 144</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARForeignExchangeRisk/#description", "title": "Description", "text": "<ul> <li>All positions on currency and gold included (cm 131 &amp; 145)</li> <li>Net position by currency</li> <li>Required equity = 8 % of:<ul> <li>The highest of: the sum net long position and the sum of net short positions</li> <li>The net position on gold</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARForeignExchangeRisk_B4/", "title": "MAR - Foreign Exchange Risk (FX)", "text": ""}, {"location": "FunctionalDoc/Doc_MARForeignExchangeRisk_B4/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR-SSA</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARForeignExchangeRisk_B4/#legal-references", "title": "Legal references", "text": "<ul> <li>Basel framework MAR40.53-40.62</li> <li>OFR Art.86</li> <li>OMar-FINMA Art.28-30</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARForeignExchangeRisk_B4/#description", "title": "Description", "text": "<ul> <li>The bank's net position in each foreign currency should be calculated according to Art.29.</li> <li>A bank's position can be excluded for FX Risk (OFR Art.81b) using the flag <code>core_module_specifics.MARExcludeFX</code>.</li> <li>Gold is to be dealt with as an FX position (OFR Art.86 al.2)</li> <li>Net future income/expenses not yet accrued but already fully hedged (Art.29 al.1 let.c) are not taken by default. </li> <li>Any other item representing a profit or a loss in foreign currencies (Art.29 al.1 let.f) are not taken by default.</li> <li>Delta-based equivalent of options denominated in a foreign currency are taken by default and not the replacement value (Art.29 al.3)</li> <li>Capital requirement = 8 % of:<ul> <li>The highest of: the sum net long positions and the sum net short positions in each foreign currency.</li> <li>The net position on gold.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk/", "title": "MAR - Interest Rate Risk", "text": ""}, {"location": "FunctionalDoc/Doc_MARIRRisk/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. cm 93 - 115</li> <li>OFR<ul> <li>Art. 51</li> <li>Art. 80 - 88</li> </ul> </li> <li>Bcbs119</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk/#description", "title": "Description", "text": "<ul> <li>There are two types of risk to account for:<ol> <li>General risk: Risk related to a change in the general interest rate structure</li> <li>Specific risk: All risk that relate to factors other than changes in the general interest rate structure</li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk/#general-risk-cm-98-115", "title": "General risk (cm 98 - 115)", "text": "<ul> <li>2 methods:<ol> <li>Maturity method</li> <li>Duration method</li> </ol> </li> <li>For both methods, the calculation is done for each currency separately<ul> <li>Possibility to group currencies where activity is negligible (cm 99) \u2192 not supported </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk/#maturity-method-cm-100-108-annexe-1", "title": "Maturity method (cm 100 - 108, Annexe 1)", "text": "<ul> <li>Methodology:<ol> <li>Distribute positions in the table below based on their<ul> <li>Residual maturity (<code>v_mr_net.ResidualDurationDays</code>)</li> <li>Their coupon rate (<code>v_mr_net.InterestRate</code>)<ul> <li>Remark: Instruments which do not pay coupon (Swaps, FRA) are allocated in the 0 coupon column.</li> </ul> </li> <li>The direction of the position, i.e. long or short (<code>v_mr_net.LongFlag</code>)</li> </ul> </li> <li>Risk weight the long and short positions by multiplying them by the risk weight corresponding to their maturity band.</li> <li>Vertical offsetting<ul> <li>For each maturity band, compute the absorbed positions as:  </li> <li>The required equity for vertical offsetting amounts to 10% of the total matched position.</li> </ul> </li> <li>Compute the net weighted long or net weighted short position for each maturity band:<ul> <li> </li> <li> </li> </ul> </li> <li>For each time time zone (a time zone regroup a couple of maturity bands), compute the total net weighted long and net weighted short positions.</li> <li>Horizontal offsetting within zones<ul> <li>For each time zone, compute the absorbed position as:  </li> <li>The required equity for vertical offsetting within zones amounts to 40% of the total matched position in zone 1, and 30% in zone 2 and 3.</li> </ul> </li> <li>Compute the ultimate net weighted long positions and short positions for each time zone.</li> <li>Horizontal offsetting accross zones<ul> <li>Offset zone 1 and 2 \u2192 required equity of 40% on matched position<ul> <li>Resulting net position in zone 2 if some offsetting occurs</li> </ul> </li> <li>Offset zone 2 and 3 \u2192 required equity of 40% on matched position<ul> <li>Resulting net position in zone 3 if some offsetting occurs</li> </ul> </li> <li>Offset zone 3 and 1 \u2192 required equity of 100% on matched position</li> </ul> </li> <li>Sum the ultimate net weighted positions of the 3 time zones to have a final ultimate net position \u2192 required equity of 100% on that amount </li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk/#duration-method-cm-109-115", "title": "Duration method (cm 109 - 115)", "text": "<ul> <li>Not supported yet. To be developed on request.<ul> <li>Duration field available: <code>core_positions_calc.ModifiedDuration</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk/#specific-risk-cm-93-97", "title": "Specific risk (cm 93 - 97)", "text": ""}, {"location": "FunctionalDoc/Doc_MARIRRisk/#interest-rate-instrument-excluding-securitisations", "title": "Interest rate instrument, excluding securitisations", "text": "<ul> <li>Does not include instruments which are based on reference interest rates (cm 72):<ul> <li>Include only: <code>v_mr_net.IssuerId not in ('','StateBond')</code></li> </ul> </li> <li>Fictitious positions on StateBond: <code>v_mr_net.IssuerId = StateBond</code>, and all positions on government bonds, do not carry a specific risk, as specified in in Table 4 of bcbs119. \u2192 contradiction with Finma circ. 2008/20 cm 94.</li> <li>Net position by issue (<code>v_mr_net.SecurityId</code>) following the methodology of art. 51 of the OFR  and multiply each net position by the weight factor of cm 94 to get the required equity.<ul> <li><code>v_mr_sr_ir</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk/#securitisation", "title": "Securitisation", "text": "<ul> <li>Not supported yet. To be developed on request.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk_B4/", "title": "MAR - Interest Rate Risk", "text": ""}, {"location": "FunctionalDoc/Doc_MARIRRisk_B4/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR-SSA</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk_B4/#legal-references", "title": "Legal references", "text": "<ul> <li>Basel framework MAR40.3-40.40</li> <li>OFR Art.84</li> <li>OMar-FINMA Art.15-21</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk_B4/#description", "title": "Description", "text": "<ul> <li>There are two types of risk to account for:<ol> <li>General risk: risk of loss arising from changes in market interest rates (MAR40.23).</li> <li>Specific risk: risk of adverse movement in the price of an individual security owing to factors related to the individual issuer (MAR40.5).</li> </ol> </li> <li>Opposite positions in the same category of instruments can in certain circumstances be regarded as matched and allowed to offset fully. To qualify for this treatment, the positions must be denominated in the same currency, be of the same nominal value, relate to the same underlying. In addition, for some positions, reference rate, coupon and/or residual maturity must closely match (Art.9). More information in a detailed documentation.</li> <li>Futures and forward contracts (including FRAs) are treated as a combination of a long and a short position in a notional government security (Art.11).</li> <li>IR swaps will be treated as two notional positions in governement securities with relevant maturities (Art.12).</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk_B4/#general-ir-risk-art15-18", "title": "General IR risk (Art.15-18)", "text": "<ul> <li>2 methods:<ol> <li>Maturity method</li> <li>Duration method</li> </ol> </li> <li>For both methods, the calculation is done for each currency separately</li> <li>Possibility to group currencies where activity is negligible (Art.16 al.1 let.a) \u2192 supported on request </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk_B4/#maturity-method-art16-17", "title": "Maturity method (Art.16-17)", "text": "<ul> <li>Methodology:<ol> <li>Distribute positions in the table below based on their<ul> <li>Residual maturity (<code>v_mr_net.ResidualDurationDays</code>)</li> <li>Their coupon rate (<code>v_mr_net.InterestRate</code>)<ul> <li>Remark: Instruments which do not pay coupon (Swaps, FRA) are allocated in the 0 coupon column.</li> </ul> </li> <li>The direction of the position, i.e. long or short (<code>v_mr_net.LongFlag</code>)</li> </ul> </li> <li>Risk weight the long and short positions by multiplying them by the risk weight corresponding to their maturity band.</li> <li>Vertical offsetting<ul> <li>For each maturity band, compute the absorbed positions as:  </li> <li>The required equity for vertical offsetting amounts to 10% of the total matched position.</li> </ul> </li> <li>Compute the net weighted long or net weighted short position for each maturity band:<ul> <li> </li> <li> </li> </ul> </li> <li>For each time time zone (a time zone regroup a couple of maturity bands), compute the total net weighted long and net weighted short positions.</li> <li>Horizontal offsetting within zones<ul> <li>For each time zone, compute the absorbed position as:  </li> <li>The required equity for vertical offsetting within zones amounts to 40% of the total matched position in zone 1, and 30% in zone 2 and 3.</li> </ul> </li> <li>Compute the ultimate net weighted long positions and short positions for each time zone.</li> <li>Horizontal offsetting accross zones<ul> <li>Offset zone 1 and 2 \u2192 required equity of 40% on matched position<ul> <li>Resulting net position in zone 2 if some offsetting occurs</li> </ul> </li> <li>Offset zone 2 and 3 \u2192 required equity of 40% on matched position<ul> <li>Resulting net position in zone 3 if some offsetting occurs</li> </ul> </li> <li>Offset zone 3 and 1 \u2192 required equity of 100% on matched position</li> </ul> </li> <li>Sum the ultimate net weighted positions of the 3 time zones to have a final ultimate net position \u2192 required equity of 100% on that amount </li> </ol> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk_B4/#duration-method-art18", "title": "Duration method (Art.18)", "text": "<ul> <li>Supported on request.<ul> <li>Duration field available: <code>core_positions_calc.ModifiedDuration</code></li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARIRRisk_B4/#specific-ir-risk-art19", "title": "Specific IR risk (Art.19)", "text": "<ul> <li>IR and FX swaps, FRAs, forwards FX contracts, IR futures will not be subject to a specific risk charge. This exemption applies to any derivative on a reference rate as underlying (Art.7 al.2).</li> <li>Even if IRS are treated as two notional positions in governement securities (Art.12 al.1), Art.7 al.2 prevails meaning no specific risk charge for an IRS.</li> <li>Net position by issue (<code>v_mr_net.SecurityId</code>) as per OFR Art.51. Each net position is multiplied by the risk-weighting factor according to OFR Ann.5.<ul> <li><code>v_mr_sr_ir</code></li> </ul> </li> <li>The specific risk capital requirement of securitisation positions that are held in the trading book is to be calculated as positions in the banking book (Art.19 al.2); supported on request.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions/", "title": "MAR - Options", "text": ""}, {"location": "FunctionalDoc/Doc_MAROptions/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. cm 157 - 199</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions/#description", "title": "Description", "text": "<ul> <li>Positions considered:</li> <li>Options : <code>core_positions.SubType in ('DerExc','DerOTC') and core_derivatives.TypeOf in ('Call','Put','SwaptR','SwaptP')</code></li> <li>Optionally, convertible bonds: <code>list_securities.SubType = 'ConvBond'</code><ul> <li>Can and will be treated as equity at the moment.</li> </ul> </li> <li>cm 158 + 159 ??</li> <li>3 possible procedures/approaches:</li> <li>Simplified approach </li> <li>Delta-plus approach</li> <li>Scenario analysis approach</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions/#simple-procedure-cm-162-166", "title": "Simple procedure (cm 162 - 166)", "text": "<ul> <li>Supported ??</li> <li>Applicable only if bank only purchases options</li> <li>Options treated separately for each risk category (interest rate, equity, foreign exchange and commodity) and finally added back to the respective category</li> <li>Required equity:</li> <li>If not offsetting position: highest of () and (MV of option)<ul> <li>Applicable weight: weight for general or specific risk</li> </ul> </li> <li>If offsetting spot position, see methodo in appendix 2<ul> <li>TBD: go in more details if supported (!!)</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions/#delta-plus-procedure-cm-167-188", "title": "Delta-plus procedure (cm 167 - 188)", "text": "<ul> <li>FX derivatives on 2 foreign currencies ??</li> <li>Three types of risk:</li> <li>Delta risk \u2192 accounts for linearity of option pricing in relation to underlying's price</li> <li>Gamma risk \u2192 accounts for non-linearity of option pricing</li> <li>Vega risk \u2192 accounts for sensitivity of option pricing to volatility</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions/#delta-risk", "title": "Delta risk", "text": "<ul> <li>Delta risk is accounted for by incorporating the delta equivalent in the calculation for each risk category like any other position</li> <li>Finma circ. 2008/20 annexe 3 describes the accounting of delta equivalent for general and specific risk when applicable</li> <li>Options on futures \u2192 need proper delivery !! cm 169</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions/#gamma-risk", "title": "Gamma risk", "text": "<ul> <li>Calculation: , where:</li> <li>  = gamma</li> <li>  (cm 172 - 176):<ul> <li>Options on bonds or corresponding forward contracts \u2192 table cm 101</li> <li>Options on IR or corresponding forward contracts \u2192 table cm 112</li> <li>Option on equity and FX or corresponding forward contracts: 8%</li> <li>Option on commodity or corresponding forward contracts: 15%</li> </ul> </li> <li>Aggregate gamma impacts to compute a net value by homogeneous category (cm 177 - 182) \u2192 only consider negative net gamma impact for equity requirements :</li> <li>IR instruments \u2192 same currency and time zone based on cm 101 (maturity method) or cm 112 (duration method)</li> <li>Equity and index on equity \u2192 same national market or single-currency area \u2192 how to choose ??</li> <li>Currency options \u2192 same currency pair</li> <li>Gold</li> <li>Commodity \u2192 <code>list_commodities.SubType</code></li> <li>The method above only accounts for general market risk \u2192 also take into consideration specific risk for banks with significant positions on equity or bond options</li> <li>What is significant ??</li> <li>How to integrate it ??</li> <li>Required equity</li> <li>The absolute net negative gamma impact is the required equity</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions/#vega-risk", "title": "Vega risk", "text": "<ul> <li>Calculation: , where:</li> <li>  = volatility implicite</li> <li>  = vega</li> <li>Aggregate vega impacts to compute a net value by using the same categories as above for the gamma impact</li> <li>The net position is computed as the addition of the long positions (options bought) minus the short positions (options short)</li> <li>Required equity</li> <li>Sum of absolute value of net vega impact by category</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions/#scenarios-procedure-cm-189-199", "title": "Scenarios procedure (cm 189 - 199)", "text": "<ul> <li>Not supported</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions/#greeks-calculation", "title": "Greeks calculation", "text": ""}, {"location": "FunctionalDoc/Doc_MAROptions/#remark-regarding-delivery-consistency", "title": "Remark regarding delivery consistency", "text": "<ul> <li>Gamma and Vega impact are meant to be computed per unit of underlying. That's why the number of underlying factors in the formula. As the spot price enters the calculation of both values, its value impacts them.</li> <li>It can happen, especially with a flat file delivery, that the number of underlying is not delivered/not available. In that case, if computed with Mercury, the Vega and Gamma will be computed using the total spot and strike underlying value, instead of the single underlying value. The order of magnitude will be different from the values expected for one underlying: if the number of underlying is 100'000, Gamma will be 100'000 times smaller than if it's computed at the \"global\" level, and Vega 100'000 times larger. Eventually the Gamma and Vega impact is the same, as the number of underlyings will used in the formula for the impact calculation will be 1 in this case.</li> <li>Banks who deliver Gamma and Vega should be very cautious about this, as it will highly impact the calculation impacts if delivered incorrectly.</li> <li>The fields used in the Delta, Gamma and Vega calculation, as well as the Gamma and Vega impacts are the following:</li> <li><code>core_derivaitves_calc.SingleUnderlyingSpotValue</code></li> <li><code>core_derivaitves_calc.SingleUnderlyingStrikeForwardValue</code></li> <li><code>core_derivatives_calc.NumberOfUnderlyings</code></li> <li>Gamma and Vega in the regulatory framework are meant to assess the impact in reporting currency. For this reason, <code>SingleUnderlyingSpotValue</code> and <code>SingleUnderlyingStrikeForwardValue</code> are in reporting currency.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions_B4/", "title": "MAR - Options", "text": ""}, {"location": "FunctionalDoc/Doc_MAROptions_B4/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR SSA.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions_B4/#legal-references", "title": "Legal references", "text": "<ul> <li>Basel framework MAR40.74-40.86;</li> <li>OFR Art.83a al.2;</li> <li>OMar-FINMA Art.37-49.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions_B4/#description", "title": "Description", "text": "<ul> <li>Positions considered:</li> <li>Options : <code>core_positions.SubType in ('DerExc','DerOTC') and core_derivatives.TypeOf in ('Call','Put','SwaptR','SwaptP')</code></li> <li>Optionally, convertible bonds: <code>list_securities.SubType = 'ConvBond'</code><ul> <li>Can and will be treated as equity at the moment.</li> </ul> </li> <li>3 possible approaches (Art.39 al.1):</li> <li>Simplified approach for banks which solely use purchased options or unless all their written option positions are hedged by perfectly matched long positions in exactly the same options, in which case no capital requirement for market risk is required. (not supported as long as it is not needed);</li> <li>Delta-plus approach;</li> <li>Scenario approach (not supported).</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions_B4/#delta-plus-approach-art40-44", "title": "Delta-plus approach (Art.40-44)", "text": "<ul> <li>Three types of risk:</li> <li>Delta risk \u2192  (delta) is the option's sensitivity to a small movements in the underlying asset price. Delta-weighted options positions capture the delta risk;</li> <li>Gamma risk \u2192 the  (Gamma) of an option measures the rate of change of  and is used to calculate the capital requirement for Gamma risk;</li> <li>Vega risk \u2192  (vega) is the option's sensitivity to a small movement in the volatility () of the underlying asset and is used to calculate the capital requirement for vega risk.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions_B4/#capital-requirement-for-delta-risk-art41", "title": "Capital requirement for delta risk (Art.41)", "text": "<ul> <li>  (Art.41 al.2);</li> <li>Delta-weighted positions are included in each risk category classes, namely IR, EQ, FX and COM, for capital requirement (Art.41 al.1). </li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions_B4/#capital-requirement-for-general-gamma-risk-art42", "title": "Capital requirement for general Gamma risk (Art.42)", "text": "<ul> <li>For each individual option a gamma impact should be calculated as follows (Ann.4)  , where:</li> <li>  = gamma of the option;</li> <li> :<ul> <li>Options on bonds \u2192 MV should be multiplied by the risk weights set out in Ann.1;</li> <li>Options on IR \u2192 MV should be multiplied based on the assumed changes in the corresponding yield in Ann.2;</li> <li>Options on equities and equity indices: MV should be multiplied by 8%;</li> <li>Options on FX and gold: MV should be multiplied by 8%;</li> <li>Options on commodity: MV should be multiplied by 15%.</li> </ul> </li> <li>Each option on the same underlying will have a gamma impact that is either positive or negative;</li> <li>These individual gamma impacts will be summed, resulting in a net gamma impact for each underlying that is either positive or negative.</li> <li>Only those net gamma impacts that are negative will be included in the capital requirement calculation.</li> <li>For the purpose of this calculation the following positions should be treated as the same underlying:</li> <li>for IR \u2192 each time band as set out in Ann.1; </li> <li>for equities and equity indices \u2192 each national market;</li> <li>for FX and gold \u2192 each currency pair and gold;</li> <li>for commodities \u2192 each <code>list_commodities.SubType</code>;</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions_B4/#capital-requirement-for-general-gamma-risk-art43-if-applicable", "title": "Capital requirement for general Gamma risk (Art.43) if applicable", "text": "<ul> <li>The method above only accounts for general market risk \u2192 also take into consideration specific risk for banks with significant positions on equity or bond options</li> <li>Options on bonds \u2192 MV should be multiplied by the risk weights set out in OFR Ann.5 (specific gamma impact);</li> <li>Options on equity indices: MV should be multiplied by 2% when applicable according to Art.27 al.2 (specific gamma impact);</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions_B4/#vega-risk-art44", "title": "Vega risk (Art.44)", "text": "<ul> <li>For each individual option a vega impact should be calculated as follows (Ann.5) , where:</li> <li>  = volatility of the underlying asset;</li> <li>  = vega of the option.</li> <li>Vega impacts are aggregated using the same categories as above for the gamma impact.</li> <li>The net position is computed as the addition of the long positions (bought options) minus the short positions (written options).</li> <li>Required equity</li> <li>Sum of absolute value of net vega impact by category</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions_B4/#scenarios-procedure-art45", "title": "Scenarios procedure (Art.45)", "text": "<ul> <li>Supported on request.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MAROptions_B4/#greeks-calculation", "title": "Greeks calculation", "text": "<ul> <li>Many option pricing formulas exist, most of them are based on the Black-Scholes formula. Relevant information are:</li> <li>Market value of underlying (S);</li> <li>Strike price of the option (K);</li> <li>Risk-free interest rate (r);</li> <li>Time to expiration in years (T);</li> <li>Volatility of underlying ();</li> <li>Continuous dividend yield (q).</li> <li> and  are meant to be computed per unit of underlying and in the reporting currency. For this reason, <code>SingleUnderlyingSpotValue</code> (S) and <code>SingleUnderlyingStrikeForwardValue</code> (K) are in reporting currency;</li> <li>The default value of r (1%) can be changed <code>param_parameters.GREEKS_R</code>;</li> <li>T is calculated from <code>core_positions.MaturityDate</code>;</li> <li>The default value of  (20%) can be changed <code>param_parameters.GREEKS_SIGMA</code>; </li> <li>The default value of q (0%) can be changed <code>param_parameters.GREEKS_DY</code>;</li> <li>Banks who deliver  and  should be very cautious about the number of contracts <code>core_positions.NumberOfContracts</code>, the currency <code>core_positions.Currency</code> and the multiplier <code>core_derivatives.Multiplier</code>, <code>core_derivatives_swaps.Multiplier</code> used as it will highly impact the capital requirement if delivered incorrectly;</li> <li>The number of underlyings for one position <code>core_derivatives.NumberOfUnderlyings</code> is calculated as <code>core_positions.NumberOfContracts</code> * <code>core_derivatives.Multiplier</code>.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/", "title": "MAR - Presentation of positions and permissible netting", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2008/20<ul> <li>Interest rate: cm 70 - 92</li> <li>Equity : cm 120 - 125</li> <li>Commodity: cm 151 - 155</li> </ul> </li> <li>OFR<ul> <li>Art. 51</li> <li>Art. 80 - 88</li> </ul> </li> <li>Bcbs119<ul> <li>Table 4</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#description", "title": "Description", "text": "<ul> <li>Each risk category has requirements for position presentation. A Permissible netting of matching positions exists for interest rate, equity and commodity instruments. These netting rules are specific to the risk category, but the rules for position presentation are fairly consistent across risk categories.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#interest-rate-instruments-cm-70-92", "title": "Interest rate instruments (cm 70 - 92)", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#positions-considered-see-also-bcbs119-table-4", "title": "Positions considered (see also bcbs119 Table 4):", "text": "<ul> <li>Fixed income instruments<ul> <li>Filter: <code>list_securities.TypeOf = 'FI' and core_positions.TradingBookFlag = 1</code><ul> <li>Exclude convertible bonds: <code>list_securities.SubType = 'ConvBond'</code> (cm 157).</li> <li>Include positions on StateBondIssuer: <code>v_mar_base.IssuerId = 'StateBondIssuer'</code></li> <li>Include legs of FX contracts: <code>v_mar_base.RiskCategory = 'FX'</code> (Table 4 bcbs).</li> </ul> </li> <li>Amount (market value): <code>core_posiitons.BookAmount</code><ul> <li>Assumption: the accounting value delivered in <code>core_posiitons.BookAmount</code> for a security is the market price as defined in under cm 36.</li> </ul> </li> </ul> </li> <li>Derivatives on interest rate, excluding options<ul> <li><code>core_positions.SubType in ('DerOTC','DerExc') and core_derivatives.TypeOf not in ('Call','Put','SwaptR','SwaptP') and core_derivatives_calc.AssetClass = 'IR' and and core_positions.TradingBookFlag = 1</code></li> <li>Amount: market value of underlying (cm 71)<ul> <li>Remark: For FRAs and swaps, take the present value of each leg, i.e. <code>core_positions_calc.RPV</code> and  <code>core_positions_calc.PPV</code></li> </ul> </li> </ul> </li> <li>Second leg of equity derivatives. See below.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#presentation-of-positions", "title": "Presentation of positions:", "text": "<ul> <li>Forwards, Futures, FRAs (<code>core_derivatives.TypeOf in ('For','Fut','FRA')</code>) transformed into one long and one short position:<ul> <li>Fictitious position in underlying instrument (long position if <code>core_position.LongContractFlag = 1</code>, else short)<ul> <li><code>v_mar_base.ResidualDurationDays = core_derivatives_calc.EndDateReferencePeriodDays</code></li> <li><code>v_mar_base.SecurityId = case when core_derivatives.TypeOf in ('For','Fut') and core_derivatives.SecurityId &lt;&gt; '' then core_derivatives.SecurityId else ''</code></li> <li><code>v_mar_base.ReferenceInterestRate = core_interest_rates.Reference</code> \u2192 most for FRA<ul> <li>Nice-to-have for forwards and futures, which are expected to be most of the time on a deliverable security.</li> <li>Link from <code>core_derivatives.UnderlyingInterestRateId</code> if not empty, or <code>list_securities.InterestRateId</code> otherwise</li> </ul> </li> <li><code>v_mar_base.InterestRate = core_interest_rates.InterestRate</code><ul> <li>Coupon rate for deliverable security, underlying (floating) rate for FRAs</li> </ul> </li> <li><code>v_mar_base.InterestRateType = core_interest_rate.TypeOf</code><ul> <li>Should be floating for FRAs</li> </ul> </li> </ul> </li> <li>Fictitious position on state security (long position if <code>core_position.LongContractFlag = 0</code>, else short)<ul> <li><code>v_mar_base.ResidualDurationDays = core_positions_calc.ResidualDurationDays</code></li> <li><code>v_mar_base.IssuerId = \"StateBondIssuer\"</code></li> <li><code>v_mar_base.InterestRateType = 'Fixed'</code> for FRAs</li> <li><code>v_mar_base.InterestRate = core_derivatives.ForwardPriceUnderlyingCurrency</code> for FRAs</li> </ul> </li> </ul> </li> <li>Swaps (<code>core_derivatives_swaps = 'IRS'</code>)<ul> <li>2 fictitious positions in state securities<ul> <li><code>ResidualDurationDays = case when core_interest_rates.TypeOf = 'Fixed' then core_positions.ResidualDurationDays else core_derivatives_calc.RNextRefixingDays/PNextRefixingDays</code></li> </ul> </li> <li>cm 88: for swaps where only one leg relates to IR, consider it on its own (cannot only rely on AssetClass) \u2192 TDB (!!)</li> <li>cm 89 - 92: Sensitivity models/Pre-processing models: Not supported</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#permissible-netting-of-matching-positions", "title": "Permissible netting of matching positions:", "text": "<ul> <li>Instrument with a deliverable fixed income security (cm 73) \u2192 <code>(v_mar_base.AssetClass = 'IR' and v_mar_base.IssuerId &lt;&gt; '') or v_mar_base.IssuerId 'StateBondIssuer')</code><ul> <li>Futures &amp; forwards \u2192 <code>v_mar_base.TypeOf in ('For','Fut','SwaptR','SwaptP')</code><ul> <li>Same underlying instrument \u2192 <code>v_mar_base.SecurityId</code></li> <li>Same currency \u2192 <code>v_mar_base.Currency</code></li> <li>Same <code>v_mar_base.UnderlyingResidualDurationDays</code> +/- 7 effective days</li> </ul> </li> <li>Remarks:<ul> <li>Assumption: cm 75 implicitly also includes forwards with deliverable security</li> <li>Appendix 10 assimilates Swaption to a combination of 2 forward positions. It is therefore also considered here for the netting.</li> <li>There will be positions on StateBondIssuer arising from derivatives which are not necessarily derivatives on interest rates (equity, fx or commodity). These positions will also land here, and follow the same netting rules.</li> </ul> </li> </ul> </li> <li>Instrument with a underlying interest rate (fixed or reference interest rate) \u2192 <code>v_mar_base.AssetClass = 'IR' and v_mar_base.IssuerId = ''</code><ul> <li>Swaps and FRAs<ul> <li>Same currency \u2192 <code>v_mar_base.Currency</code></li> <li>Floating rate (<code>v_mar_base.InterestRateType = 'Floating'</code>): same reference interest rate (<code>v_mar_base.InterestRateReference</code>)</li> <li>Fixed rate (<code>v_mar_base.InterestRateType = 'Fixed'</code>): +/- 15 basis points (0.15% or 0.0015) (<code>v_mar_base.InterestRate</code>)</li> <li><code>v_mar_base.UnderlyingResidualDurationDays</code> as described under Presentation of positions must be within a certain range for positions to offset each other. The closer to the reporting date, the shorter the range:<ul> <li><code>v_mar_base.UnderlyingResidualDurationDays &lt;= 30</code>: same day</li> <li><code>v_mar_base.UnderlyingResidualDurationDays &gt; 30 and ResidualDurationDays &lt;= 360</code>: +/- 7 effective days</li> <li><code>v_mar_base.UnderlyingResidualDurationDays &gt; 360</code>: +/- 30 effective days</li> </ul> </li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#netting-strategy", "title": "Netting strategy", "text": "<ul> <li>Post-netting time to maturity<ul> <li>Once two position have been netted, only one remains. A decision must be made to assign a value in the field <code>UnderlyingResidualDurationDays</code> of the resulting net position.<ul> <li>Ex: If there are two positions with <code>UnderlyingResidualDurationDays</code> of 35 and 37 days which can net each other, is the ultimate <code>UnderlyingResidualDurationDays</code> of the net position going to be 35 or 37?</li> </ul> </li> <li>The decision will be impactful in two ways:<ul> <li>If the two positions which net each other are not in the same time zone for the purpose of the general market risk calculations (cm 101). The choice will impact the required equity, as the weighting factor increases with the time zones.</li> <li>If multiple \"rounds\" of netting are performed, i.e. A and B net each other, the resulting position nets itself with C, the resulting position nets itself with D, etc., choosing the date further in the future might support longer \"chains\" of netting, fostering an advantageous treatment.</li> </ul> </li> <li>Suggested strategy:<ul> <li>The resulting net position takes the time zone of the original position with the same sign. For instance if A&gt;0 is in time zone 1, B&lt;0 is in time zone 2 and the resulting net position is &gt;0, the time zone that will be attributed to the net position is the one of A, so the time zone 1.</li> </ul> </li> </ul> </li> <li>Rounds of netting<ul> <li>An optimization strategy can be to apply the rules of netting n times in a row, until there is no permissible netting of matching positions that can be performed anymore.</li> <li>In essence, the netting rules are applied a first time, then a second time on the net position resulting from the first netting, and so on and so forth.</li> <li>To be decided: For reconcilation purpose, the positions that have been netted together should be grouped in a way: netting field in a new table?</li> <li>In a first iteration, we can apply the netting rules only once.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#equity-instruments-cm-120-125", "title": "Equity instruments (cm 120 - 125)", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#positions-considered", "title": "Positions considered:", "text": "<ul> <li>Equity instruments (including indexes):<ul> <li>Filter: <code>(list_securities.TypeOf = 'Equity' or (list_securities.IndexFlag = 1 and list_securities.CMAApproachType != 'LTA')) and core_positions.TradingBookFlag = 1</code><ul> <li>Also include convertible bonds: <code>list_securities.SubType = 'ConvBond'</code> (cm 157)</li> <li>Funds treated with LTA \u2192 TBD</li> <li>Do we distinguish index of equity ??<ul> <li>Yes, see cm 84 for IR</li> </ul> </li> </ul> </li> <li><code>Amount = core_posiitons.BookAmount</code></li> </ul> </li> <li>Derivatives on equity, excluding options<ul> <li><code>core_positions.SubType in ('DerOTC','DerExc') and core_derivatives.TypeOf not in ('Call','Put','SwaptR','SwaptP') and core_derivatives_calc.AssetClass = 'Eq' and and core_positions.TradingBookFlag = 1</code></li> <li>Amount: Market value of underlying (cm 122) \u2192 new calculated field (!!)</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#presentation-of-positions_1", "title": "Presentation of positions:", "text": "<ul> <li>Futures and Forwards<ul> <li>Fictitious position in underlying instrument (long position if <code>core_position.LongContractFlag = 1</code>, else short)<ul> <li><code>UnderlyingId = case when core_derivatives.TypeOf in ('For','Fut') then list_securities.Id</code></li> </ul> </li> <li>Fictitious position on state security (long position if <code>core_position.LongContractFlag = 0</code>, else short)<ul> <li><code>ResidualDurationDays = core_positions.ResidualDurationDays</code></li> <li><code>IssuerId = \"StateBondIssuer\"</code></li> <li>Note: This position will generate an interest rate risk.</li> </ul> </li> </ul> </li> <li>Swaps<ul> <li>Long and short position in underlying security</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#permissible-netting-of-matching-positions_1", "title": "Permissible netting of matching positions:", "text": "<ul> <li>Positions considered: <code>v_mar_base.AssetClass = 'Eq'</code></li> <li>Same security: <code>v_mar_base.SecurityId</code> </li> <li>Same country of domicile of issuer: <code>v_mar_base.IssuerDomicileCountry</code><ul> <li>This rule comes from the fact that the general risk is done at the level of the national market.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#commodity-instruments-cm-151-155", "title": "Commodity instruments (cm 151 - 155)", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#positions-considered_1", "title": "Positions considered:", "text": "<ul> <li>Commodity instruments excluding gold<ul> <li>Filter: <code>list_commodities.Id IS NOT NULL and list_commodities.TypeOf != 'Gold'</code></li> <li><code>Amount = core_posiitons.BookAmount</code></li> <li>Remark: as per cm 1, all commodity positions including those in the banking book, are going to have a market risk computed \u2192 not filter on <code>core_positions.TradingBookFlag</code>.</li> </ul> </li> <li>Derivatives on commodity, excluding options<ul> <li><code>core_positions.SubType in ('DerOTC','DerExc') and core_derivatives.TypeOf not in ('Call','Put','SwaptR','SwaptP') and core_derivatives_calc.AssetClass = 'Co' and and core_positions.TradingBookFlag = 1</code></li> <li>Amount: Market value of underlying (cm 122) \u2192 new calculated field (!!)</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#presentation-of-positions_2", "title": "Presentation of positions:", "text": "<ul> <li>Futures and Forwards<ul> <li>Combination of long/short position on underlying commodity and State security</li> </ul> </li> <li>Swaps<ul> <li>Composed of exchanges of cash flows based on fixed price and market price</li> <li>Each settlement considered as different position corresponding to the notional</li> <li>Long position: pay fix, receive variable. Short: inverse.</li> <li>Not supported yet</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#permissible-netting-of-matching-positions_2", "title": "Permissible netting of matching positions:", "text": "<ul> <li>Positions considered: <code>v_mar_base.AssetClass = 'Co'</code></li> <li>Residual maturity maturity differences of +/- 10 days (<code>v_mar_base.UnderlyingResidualDurationDays</code>)### Foreign exchange risk instruments (cm 131 - 142)</li> <li>Filter: gold and currency</li> <li>Amount:<ul> <li>Spot (market) price of spot positions</li> <li>Present value of forward positions \u2192 translated into CHF at the spot rate</li> </ul> </li> <li>Remarks<ul> <li>cm 135: PNL \u2192 Not covered, on request.</li> <li>cm 138: basket of currencies \u2192 Not covered at the moment. Input to be defined</li> <li>cm 140 - 142: Exclusion<ul> <li>TBD: exclusion with field <code>core_positions_calc.OwnShare</code></li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#permissible-netting-of-matching-positions_3", "title": "Permissible netting of matching positions:", "text": "<ul> <li>Not applicable</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#foreign-exchange-instruments-cm-151-155", "title": "Foreign exchange instruments (cm 151 - 155)", "text": "<ul> <li>Remark: as per cm 1, all commodity positions including those in the banking book, are going to have a market risk computed \u2192 not filter on <code>core_positions.TradingBookFlag</code>.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#credit-derivatives-cm-200-2271", "title": "Credit derivatives (cm 200 - 227.1)", "text": "<ul> <li>TBD</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#table-b", "title": "Table B", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#output-fields", "title": "Output fields", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#v_mar_base", "title": "v_mar_base", "text": "<ul> <li>Id<ul> <li>core_positions.Id for non-derivatives. Add some logic for derivatives to distinguish leg 1 and 2.</li> </ul> </li> <li>LoadId</li> <li>TypeOf</li> <li>Currency<ul> <li><code>core_derivatives.BaseCurrency, core_derivatives_swaps.RCurrency, core_derivatives_swaps.PCurrency</code></li> </ul> </li> <li>AssetClass<ul> <li>IR, Eq, Co, FX (not computed for on-BS positions so far)</li> </ul> </li> <li>MarketValue<ul> <li>Interest rate<ul> <li>cm 70: When calculating the components for general market risk and specific risk, all positions must initially be marked to market</li> <li>cm 71 (derivatives): present value of the actual or fictional underlying instrument (contract volume, i.e. market value  of  the  underlying  instruments)</li> </ul> </li> <li>Equity<ul> <li>cm 120: All positions must initially be marked to market.</li> <li>cm 121 (derivatives): the market value of the actual or fictional underlying instruments (contract volume, i.e. market value of the underlying instruments).</li> </ul> </li> <li>Commodity<ul> <li>cm 152: valued at the current spot price in the reference currency of the financial statements</li> </ul> </li> <li>Foreign exchange<ul> <li>cm 133: Net spot position, i.e. all assets less all liabilities</li> <li>cm 134 (forward positions): The net present values should be applied, i.e. the positions discounted with the current foreign currency interest rates</li> </ul> </li> </ul> </li> <li>PV</li> <li>DeltaEquivalent</li> <li>UnderlyingResidualDurationDays</li> <li>ContractResidualDurationDays</li> <li>LongFlag </li> <li>InterestRateType<ul> <li>Securities: <code>core_interest_rates.TypeOf</code></li> <li>Derivatives: <code>core_derivatives_calc.RIRType</code> and <code>core_derivatives_calc.PIRType</code></li> </ul> </li> <li>InterestRateReference</li> <li>InterestRate<ul> <li>Coupon for bonds, fixed interest rate or floating rate</li> </ul> </li> <li>IssuerId</li> <li>IssuerType<ul> <li>Necessary to exclude government bonds of IR specific risk</li> </ul> </li> <li>IssuerDomicileCountry<ul> <li>Used for equity general market risk</li> </ul> </li> <li>IssuerRatingClass<ul> <li>In case IssuerId = StateBondIssuer, no need for rating class, because bond on governments not included in specific risk on interest rate, as specified in Table 4 of bcbs119.</li> </ul> </li> <li>SecurityId</li> <li>CommodityId \u2192 <code>list_commodities.SubType</code></li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting/#v_mar_net", "title": "v_mar_net", "text": "<ul> <li>Id</li> <li>~~TypeOf~~ \u2192 lost because of possible netting of positions with different types</li> <li>Currency</li> <li>AssetClass</li> <li>MarketValue</li> <li>PV</li> <li>ResidualDurationDays</li> <li>LongFlag</li> <li>InterestRateType</li> <li>InterestRateReference</li> <li>InterestRate</li> <li>IssuerId</li> <li>SecurityId</li> <li>CommodityId</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/", "title": "MAR - Presentation of positions and permissible netting", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>MAR</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2008/20<ul> <li>Interest rate: cm 70 - 92</li> <li>Equity : cm 120 - 125</li> <li>Commodity: cm 151 - 155</li> </ul> </li> <li>OFR<ul> <li>Art. 51</li> <li>Art. 80 - 88</li> </ul> </li> <li>Bcbs119<ul> <li>Table 4</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#description", "title": "Description", "text": "<ul> <li>Each risk category has requirements for position presentation. A Permissible netting of matching positions exists for interest rate, equity and commodity instruments. These netting rules are specific to the risk category, but the rules for position presentation are fairly consistent across risk categories.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#interest-rate-instruments-cm-70-92", "title": "Interest rate instruments (cm 70 - 92)", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#positions-considered-see-also-bcbs119-table-4", "title": "Positions considered (see also bcbs119 Table 4):", "text": "<ul> <li>Fixed income instruments<ul> <li>Filter: <code>list_securities.TypeOf = 'FI' and core_positions.TradingBookFlag = 1</code><ul> <li>Exclude convertible bonds: <code>list_securities.SubType = 'ConvBond'</code> (cm 157).</li> <li>Include positions on StateBondIssuer: <code>v_mar_base.IssuerId = 'StateBondIssuer'</code></li> <li>Include legs of FX contracts: <code>v_mar_base.RiskCategory = 'FX'</code> (Table 4 bcbs).</li> </ul> </li> <li>Amount (market value): <code>core_posiitons.BookAmount</code><ul> <li>Assumption: the accounting value delivered in <code>core_posiitons.BookAmount</code> for a security is the market price as defined in under cm 36.</li> </ul> </li> </ul> </li> <li>Derivatives on interest rate, excluding options<ul> <li><code>core_positions.SubType in ('DerOTC','DerExc') and core_derivatives.TypeOf not in ('Call','Put','SwaptR','SwaptP') and core_derivatives_calc.AssetClass = 'IR' and and core_positions.TradingBookFlag = 1</code></li> <li>Amount: market value of underlying (cm 71)<ul> <li>Remark: For FRAs and swaps, take the present value of each leg, i.e. <code>core_positions_calc.RPV</code> and  <code>core_positions_calc.PPV</code></li> </ul> </li> </ul> </li> <li>Second leg of equity derivatives. See below.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#presentation-of-positions", "title": "Presentation of positions:", "text": "<ul> <li>Forwards, Futures, FRAs (<code>core_derivatives.TypeOf in ('For','Fut','FRA')</code>) transformed into one long and one short position:<ul> <li>Fictitious position in underlying instrument (long position if <code>core_position.LongContractFlag = 1</code>, else short)<ul> <li><code>v_mar_base.ResidualDurationDays = core_derivatives_calc.EndDateReferencePeriodDays</code></li> <li><code>v_mar_base.SecurityId = case when core_derivatives.TypeOf in ('For','Fut') and core_derivatives.SecurityId &lt;&gt; '' then core_derivatives.SecurityId else ''</code></li> <li><code>v_mar_base.ReferenceInterestRate = core_interest_rates.Reference</code> \u2192 most for FRA<ul> <li>Nice-to-have for forwards and futures, which are expected to be most of the time on a deliverable security.</li> <li>Link from <code>core_derivatives.UnderlyingInterestRateId</code> if not empty, or <code>list_securities.InterestRateId</code> otherwise</li> </ul> </li> <li><code>v_mar_base.InterestRate = core_interest_rates.InterestRate</code><ul> <li>Coupon rate for deliverable security, underlying (floating) rate for FRAs</li> </ul> </li> <li><code>v_mar_base.InterestRateType = core_interest_rate.TypeOf</code><ul> <li>Should be floating for FRAs</li> </ul> </li> </ul> </li> <li>Fictitious position on state security (long position if <code>core_position.LongContractFlag = 0</code>, else short)<ul> <li><code>v_mar_base.ResidualDurationDays = core_positions_calc.ResidualDurationDays</code></li> <li><code>v_mar_base.IssuerId = \"StateBondIssuer\"</code></li> <li><code>v_mar_base.InterestRateType = 'Fixed'</code> for FRAs</li> <li><code>v_mar_base.InterestRate = core_derivatives.ForwardPriceUnderlyingCurrency</code> for FRAs</li> </ul> </li> </ul> </li> <li>Swaps (<code>core_derivatives_swaps = 'IRS'</code>)<ul> <li>2 fictitious positions in state securities<ul> <li><code>ResidualDurationDays = case when core_interest_rates.TypeOf = 'Fixed' then core_positions.ResidualDurationDays else core_derivatives_calc.RNextRefixingDays/PNextRefixingDays</code></li> </ul> </li> <li>cm 88: for swaps where only one leg relates to IR, consider it on its own (cannot only rely on AssetClass) \u2192 TDB (!!)</li> <li>cm 89 - 92: Sensitivity models/Pre-processing models: Not supported</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#permissible-netting-of-matching-positions", "title": "Permissible netting of matching positions:", "text": "<ul> <li>Instrument with a deliverable fixed income security (cm 73) \u2192 <code>(v_mar_base.AssetClass = 'IR' and v_mar_base.IssuerId &lt;&gt; '') or v_mar_base.IssuerId 'StateBondIssuer')</code><ul> <li>Futures &amp; forwards \u2192 <code>v_mar_base.TypeOf in ('For','Fut','SwaptR','SwaptP')</code><ul> <li>Same underlying instrument \u2192 <code>v_mar_base.SecurityId</code></li> <li>Same currency \u2192 <code>v_mar_base.Currency</code></li> <li>Same <code>v_mar_base.UnderlyingResidualDurationDays</code> +/- 7 effective days</li> </ul> </li> <li>Remarks:<ul> <li>Assumption: cm 75 implicitly also includes forwards with deliverable security</li> <li>Appendix 10 assimilates Swaption to a combination of 2 forward positions. It is therefore also considered here for the netting.</li> <li>There will be positions on StateBondIssuer arising from derivatives which are not necessarily derivatives on interest rates (equity, fx or commodity). These positions will also land here, and follow the same netting rules.</li> </ul> </li> </ul> </li> <li>Instrument with a underlying interest rate (fixed or reference interest rate) \u2192 <code>v_mar_base.AssetClass = 'IR' and v_mar_base.IssuerId = ''</code><ul> <li>Swaps and FRAs<ul> <li>Same currency \u2192 <code>v_mar_base.Currency</code></li> <li>Floating rate (<code>v_mar_base.InterestRateType = 'Floating'</code>): same reference interest rate (<code>v_mar_base.InterestRateReference</code>)</li> <li>Fixed rate (<code>v_mar_base.InterestRateType = 'Fixed'</code>): +/- 15 basis points (0.15% or 0.0015) (<code>v_mar_base.InterestRate</code>)</li> <li><code>v_mar_base.UnderlyingResidualDurationDays</code> as described under Presentation of positions must be within a certain range for positions to offset each other. The closer to the reporting date, the shorter the range:<ul> <li><code>v_mar_base.UnderlyingResidualDurationDays &lt;= 30</code>: same day</li> <li><code>v_mar_base.UnderlyingResidualDurationDays &gt; 30 and ResidualDurationDays &lt;= 360</code>: +/- 7 effective days</li> <li><code>v_mar_base.UnderlyingResidualDurationDays &gt; 360</code>: +/- 30 effective days</li> </ul> </li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#netting-strategy", "title": "Netting strategy", "text": "<ul> <li>Post-netting time to maturity<ul> <li>Once two position have been netted, only one remains. A decision must be made to assign a value in the field <code>UnderlyingResidualDurationDays</code> of the resulting net position.<ul> <li>Ex: If there are two positions with <code>UnderlyingResidualDurationDays</code> of 35 and 37 days which can net each other, is the ultimate <code>UnderlyingResidualDurationDays</code> of the net position going to be 35 or 37?</li> </ul> </li> <li>The decision will be impactful in two ways:<ul> <li>If the two positions which net each other are not in the same time zone for the purpose of the general market risk calculations (cm 101). The choice will impact the required equity, as the weighting factor increases with the time zones.</li> <li>If multiple \"rounds\" of netting are performed, i.e. A and B net each other, the resulting position nets itself with C, the resulting position nets itself with D, etc., choosing the date further in the future might support longer \"chains\" of netting, fostering an advantageous treatment.</li> </ul> </li> <li>Suggested strategy:<ul> <li>The resulting net position takes the time zone of the original position with the same sign. For instance if A&gt;0 is in time zone 1, B&lt;0 is in time zone 2 and the resulting net position is &gt;0, the time zone that will be attributed to the net position is the one of A, so the time zone 1.</li> </ul> </li> </ul> </li> <li>Rounds of netting<ul> <li>An optimization strategy can be to apply the rules of netting n times in a row, until there is no permissible netting of matching positions that can be performed anymore.</li> <li>In essence, the netting rules are applied a first time, then a second time on the net position resulting from the first netting, and so on and so forth.</li> <li>To be decided: For reconcilation purpose, the positions that have been netted together should be grouped in a way: netting field in a new table?</li> <li>In a first iteration, we can apply the netting rules only once.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#equity-instruments-cm-120-125", "title": "Equity instruments (cm 120 - 125)", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#positions-considered", "title": "Positions considered:", "text": "<ul> <li>Equity instruments (including indexes):<ul> <li>Filter: <code>(list_securities.TypeOf = 'Equity' or (list_securities.IndexFlag = 1 and list_securities.CMAApproachType != 'LTA')) and core_positions.TradingBookFlag = 1</code><ul> <li>Also include convertible bonds: <code>list_securities.SubType = 'ConvBond'</code> (cm 157)</li> <li>Funds treated with LTA \u2192 TBD</li> <li>Do we distinguish index of equity ??<ul> <li>Yes, see cm 84 for IR</li> </ul> </li> </ul> </li> <li><code>Amount = core_posiitons.BookAmount</code></li> </ul> </li> <li>Derivatives on equity, excluding options<ul> <li><code>core_positions.SubType in ('DerOTC','DerExc') and core_derivatives.TypeOf not in ('Call','Put','SwaptR','SwaptP') and core_derivatives_calc.AssetClass = 'Eq' and and core_positions.TradingBookFlag = 1</code></li> <li>Amount: Market value of underlying (cm 122) \u2192 new calculated field (!!)</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#presentation-of-positions_1", "title": "Presentation of positions:", "text": "<ul> <li>Futures and Forwards<ul> <li>Fictitious position in underlying instrument (long position if <code>core_position.LongContractFlag = 1</code>, else short)<ul> <li><code>UnderlyingId = case when core_derivatives.TypeOf in ('For','Fut') then list_securities.Id</code></li> </ul> </li> <li>Fictitious position on state security (long position if <code>core_position.LongContractFlag = 0</code>, else short)<ul> <li><code>ResidualDurationDays = core_positions.ResidualDurationDays</code></li> <li><code>IssuerId = \"StateBondIssuer\"</code></li> <li>Note: This position will generate an interest rate risk.</li> </ul> </li> </ul> </li> <li>Swaps<ul> <li>Long and short position in underlying security</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#permissible-netting-of-matching-positions_1", "title": "Permissible netting of matching positions:", "text": "<ul> <li>Positions considered: <code>v_mar_base.AssetClass = 'Eq'</code></li> <li>Same security: <code>v_mar_base.SecurityId</code> </li> <li>Same country of domicile of issuer: <code>v_mar_base.IssuerDomicileCountry</code><ul> <li>This rule comes from the fact that the general risk is done at the level of the national market.</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#commodity-instruments-cm-151-155", "title": "Commodity instruments (cm 151 - 155)", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#positions-considered_1", "title": "Positions considered:", "text": "<ul> <li>Commodity instruments excluding gold<ul> <li>Filter: <code>list_commodities.Id IS NOT NULL and list_commodities.TypeOf != 'Gold'</code></li> <li><code>Amount = core_posiitons.BookAmount</code></li> <li>Remark: as per cm 1, all commodity positions including those in the banking book, are going to have a market risk computed \u2192 not filter on <code>core_positions.TradingBookFlag</code>.</li> </ul> </li> <li>Derivatives on commodity, excluding options<ul> <li><code>core_positions.SubType in ('DerOTC','DerExc') and core_derivatives.TypeOf not in ('Call','Put','SwaptR','SwaptP') and core_derivatives_calc.AssetClass = 'Co' and and core_positions.TradingBookFlag = 1</code></li> <li>Amount: Market value of underlying (cm 122) \u2192 new calculated field (!!)</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#presentation-of-positions_2", "title": "Presentation of positions:", "text": "<ul> <li>Futures and Forwards<ul> <li>Combination of long/short position on underlying commodity and State security</li> </ul> </li> <li>Swaps<ul> <li>Composed of exchanges of cash flows based on fixed price and market price</li> <li>Each settlement considered as different position corresponding to the notional</li> <li>Long position: pay fix, receive variable. Short: inverse.</li> <li>Not supported yet</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#permissible-netting-of-matching-positions_2", "title": "Permissible netting of matching positions:", "text": "<ul> <li>Positions considered: <code>v_mar_base.AssetClass = 'Co'</code></li> <li>Residual maturity maturity differences of +/- 10 days (<code>v_mar_base.UnderlyingResidualDurationDays</code>)### Foreign exchange risk instruments (cm 131 - 142)</li> <li>Filter: gold and currency</li> <li>Amount:<ul> <li>Spot (market) price of spot positions</li> <li>Present value of forward positions \u2192 translated into CHF at the spot rate</li> </ul> </li> <li>Remarks<ul> <li>cm 135: PNL \u2192 Not covered, on request.</li> <li>cm 138: basket of currencies \u2192 Not covered at the moment. Input to be defined</li> <li>cm 140 - 142: Exclusion<ul> <li>TBD: exclusion with field <code>core_positions_calc.OwnShare</code></li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#permissible-netting-of-matching-positions_3", "title": "Permissible netting of matching positions:", "text": "<ul> <li>Not applicable</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#foreign-exchange-instruments-cm-151-155", "title": "Foreign exchange instruments (cm 151 - 155)", "text": "<ul> <li>Remark: as per cm 1, all commodity positions including those in the banking book, are going to have a market risk computed \u2192 not filter on <code>core_positions.TradingBookFlag</code>.</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#credit-derivatives-cm-200-2271", "title": "Credit derivatives (cm 200 - 227.1)", "text": "<ul> <li>TBD</li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#table-b", "title": "Table B", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#output-fields", "title": "Output fields", "text": ""}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#v_mar_base", "title": "v_mar_base", "text": "<ul> <li>Id<ul> <li>core_positions.Id for non-derivatives. Add some logic for derivatives to distinguish leg 1 and 2.</li> </ul> </li> <li>LoadId</li> <li>TypeOf</li> <li>Currency<ul> <li><code>core_derivatives.BaseCurrency, core_derivatives_swaps.RCurrency, core_derivatives_swaps.PCurrency</code></li> </ul> </li> <li>AssetClass<ul> <li>IR, Eq, Co, FX (not computed for on-BS positions so far)</li> </ul> </li> <li>MarketValue<ul> <li>Interest rate<ul> <li>cm 70: When calculating the components for general market risk and specific risk, all positions must initially be marked to market</li> <li>cm 71 (derivatives): present value of the actual or fictional underlying instrument (contract volume, i.e. market value  of  the  underlying  instruments)</li> </ul> </li> <li>Equity<ul> <li>cm 120: All positions must initially be marked to market.</li> <li>cm 121 (derivatives): the market value of the actual or fictional underlying instruments (contract volume, i.e. market value of the underlying instruments).</li> </ul> </li> <li>Commodity<ul> <li>cm 152: valued at the current spot price in the reference currency of the financial statements</li> </ul> </li> <li>Foreign exchange<ul> <li>cm 133: Net spot position, i.e. all assets less all liabilities</li> <li>cm 134 (forward positions): The net present values should be applied, i.e. the positions discounted with the current foreign currency interest rates</li> </ul> </li> </ul> </li> <li>PV</li> <li>DeltaEquivalent</li> <li>UnderlyingResidualDurationDays</li> <li>ContractResidualDurationDays</li> <li>LongFlag </li> <li>InterestRateType<ul> <li>Securities: <code>core_interest_rates.TypeOf</code></li> <li>Derivatives: <code>core_derivatives_calc.RIRType</code> and <code>core_derivatives_calc.PIRType</code></li> </ul> </li> <li>InterestRateReference</li> <li>InterestRate<ul> <li>Coupon for bonds, fixed interest rate or floating rate</li> </ul> </li> <li>IssuerId</li> <li>IssuerType<ul> <li>Necessary to exclude government bonds of IR specific risk</li> </ul> </li> <li>IssuerDomicileCountry<ul> <li>Used for equity general market risk</li> </ul> </li> <li>IssuerRatingClass<ul> <li>In case IssuerId = StateBondIssuer, no need for rating class, because bond on governments not included in specific risk on interest rate, as specified in Table 4 of bcbs119.</li> </ul> </li> <li>SecurityId</li> <li>CommodityId \u2192 <code>list_commodities.SubType</code></li> </ul>"}, {"location": "FunctionalDoc/Doc_MARPositionPresentationAndNetting_B4/#v_mar_net", "title": "v_mar_net", "text": "<ul> <li>Id</li> <li>~~TypeOf~~ \u2192 lost because of possible netting of positions with different types</li> <li>Currency</li> <li>AssetClass</li> <li>MarketValue</li> <li>PV</li> <li>ResidualDurationDays</li> <li>LongFlag</li> <li>InterestRateType</li> <li>InterestRateReference</li> <li>InterestRate</li> <li>IssuerId</li> <li>SecurityId</li> <li>CommodityId</li> </ul>"}, {"location": "FunctionalDoc/Doc_Mortgages/", "title": "Mortgage loans, contracts, certificates and related properties", "text": ""}, {"location": "FunctionalDoc/Doc_Mortgages/#delivery", "title": "Delivery", "text": ""}, {"location": "FunctionalDoc/Doc_Mortgages/#delivery-1-loan-before-the-money-is-actually-lent", "title": "Delivery 1 - Loan before the money is actually lent:", "text": "<ol> <li>Mortgage loan commitment from the bank to a client (engagement de cr\u00e9dit) \u2192 Tranches not paid. Record exists on its own. Key characteristics:<ul> <li><code>core_positions</code><ul> <li>LegalAccountNumber = 30xxxx</li> <li>CounterpartyId = counterparty of the loan</li> </ul> </li> </ul> </li> </ol>"}, {"location": "FunctionalDoc/Doc_Mortgages/#delivery-2-mortgage-loan-and-its-tranches-mortgage-certificatecontract-and-property", "title": "Delivery 2 - Mortgage loan and its tranches, mortgage certificate/contract and  property", "text": "<ol> <li>Mortgage loan and its tranches (potentially different maturities, interest rates, ...) \u2192 pr\u00eat hypoth\u00e9caire - according to the Code Civil. Key characteristics:<ul> <li><code>core_positions</code><ul> <li>LegalAccountNumber = 105001</li> <li>LocationCountry = <code>list_properties.Country</code> \u2192 consistency could be checked in validation rule</li> <li>CounterpartyId = counterparty of the loan</li> <li>CollateralHolderId = empty</li> <li>PledgedFlag = 1</li> <li>Type = Contract</li> <li>SubType in (MortgageLoanABL,MortgageLoanABL-ETP,MortgageLoanBAU,MortgageLoanBAU-ETP,MortgageLoanERW,MortgageLoanERW-ETP)</li> <li>PropertyId = <code>list_properties.Id</code></li> <li>ContractId \u2192 not used for legal reporting</li> </ul> </li> </ul> </li> <li>Property. Key characteristics:<ul> <li><code>core_positions</code> \u2192 record used for reconcilation purpose.<ul> <li>LegalAccountNumber = empty</li> <li>BookAmount = 0</li> <li>TypeOf = TangibleAsset</li> <li>SubType = not defined</li> <li>PledgedFlag \u2192 irrelevant </li> <li>CounterpartyId = empty</li> <li>CollateralHolderId = counterparty of the loan (or different if entry in list_pledges to link exposure and collateral)</li> <li>PropertyId = <code>list_properties.Id</code></li> <li>ContractId \u2192 not used for legal reporting</li> </ul> </li> <li><code>list_properties</code><ul> <li>Id = <code>core_positions.PropertyId</code></li> <li>MarketValue \u2192 value used to split the mortgages certificate and mortgage contract according to OFR Appendix 3 under Basel 3.</li> </ul> </li> </ul> </li> <li>Mortgage certificate (c\u00e9dule hypoth\u00e9caire) or Mortgage contract (hypoth\u00e8que) \u2192 both are garanties hypoth\u00e9caires - gages immobiliers - according to the Code Civil. Key characteristics:<ul> <li><code>core_positions</code><ul> <li>LegalAccountNumber = empty</li> <li>TypeOf = Contract</li> <li>SubType = MortgageCertificate or MortgageContract</li> <li>CounterpartyId = empty</li> <li>CollateralHolderId = counterparty of the loan (or different if entry in list_pledges to link exposure and collateral)</li> <li>PledgedFlag = for BaselIII: 1, for BaselIV: irrelevant</li> <li>ContractId = not necessarily the same as tranches</li> <li>PropertyId = <code>list_properties.Id</code></li> </ul> </li> </ul> </li> </ol>"}, {"location": "FunctionalDoc/Doc_Mortgages/#delivery-3-land-loan-tbd", "title": "Delivery 3 - Land loan \u2192 TBD", "text": "<ol> <li>Land loan. Key characteristics:<ul> <li><code>core_positions</code>:<ul> <li>LegalAccountNumber = 102xxx,104xxx ??</li> <li>TypeOf = Contract</li> <li>SubType = LandLoan</li> <li>CounterpartyId = counterparty of the loan</li> <li>CollateralHolderId = empty</li> </ul> </li> </ul> </li> <li>Land ??. Key characteristics<ul> <li><code>core_positions</code>:<ul> <li>LegalAccountNumber = empty</li> <li>TypeOf = TangibleAsset</li> <li>SubType = Land</li> <li>CounterpartyId = empty</li> <li>CollateralHolderId = counterparty of the loan (or different if entry in list_pledges to link exposure and collateral)</li> </ul> </li> </ul> </li> </ol>"}, {"location": "FunctionalDoc/Doc_Mortgages/#delivery-4-financement-de-portefeuille-immobilier-tbd", "title": "Delivery 4 - Financement de portefeuille immobilier \u2192 TBD", "text": ""}, {"location": "FunctionalDoc/Doc_Mortgages/#calculation-of-the-limit", "title": "Calculation of the limit", "text": "<ul> <li>Limit = Initial commitment<ul> <li>Tranches paid (by the bank to the borrower) + remaining commitment</li> </ul> </li> <li>Remarque: on peut partir du principe qu'\u00e0 la date du reporting toutes les tranches sont pay\u00e9 \u2192 limit = tranches</li> </ul>"}, {"location": "FunctionalDoc/Doc_Mortgages/#treatments", "title": "Treatments", "text": ""}, {"location": "FunctionalDoc/Doc_Mortgages/#basel-iii", "title": "Basel III", "text": "<ul> <li>The split of covered mortgage loans according to OFR Appendix 3 is done in the table <code>core_positions_calc</code> in the following fields: <code>MortgageLoanClaimLevel1</code>, <code>MortgageLoanClaimLevel2</code> and <code>MortgageLoanClaimLevel3</code>.</li> <li>Each field contains the amount to be risk weighted at 35%, 75% or 100% respectively, if covered by a mortgage certificate or mortgage contract.</li> <li>For the treatment to function correctly, the property must be linked to the mortgage loan via the fields <code>core_positions.PropertyId</code> (of the mortgage loan record) and <code>list_properties.Id</code> so that the <code>MarketValue</code> can be retrieved.</li> </ul>"}, {"location": "FunctionalDoc/Doc_Mortgages_B4/", "title": "Mortgage loans, contracts, certificates and related properties", "text": ""}, {"location": "FunctionalDoc/Doc_Mortgages_B4/#delivery", "title": "Delivery", "text": ""}, {"location": "FunctionalDoc/Doc_Mortgages_B4/#delivery-1-loan-before-the-money-is-actually-lent", "title": "Delivery 1 - Loan before the money is actually lent:", "text": "<ol> <li>Mortgage loan commitment from the bank to a client (engagement de cr\u00e9dit) \u2192 Tranches not paid. Record exists on its own. Key characteristics:<ul> <li><code>core_positions</code><ul> <li>LegalAccountNumber = 30xxxx</li> <li>CounterpartyId = counterparty of the loan</li> </ul> </li> </ul> </li> </ol>"}, {"location": "FunctionalDoc/Doc_Mortgages_B4/#delivery-2-mortgage-loan-and-its-tranches-mortgage-certificatecontract-and-property", "title": "Delivery 2 - Mortgage loan and its tranches, mortgage certificate/contract and  property", "text": "<ol> <li>Mortgage loan and its tranches (potentially different maturities, interest rates, ...) \u2192 pr\u00eat hypoth\u00e9caire - according to the Code Civil. Key characteristics:<ul> <li><code>core_positions</code><ul> <li>LegalAccountNumber = 105001</li> <li>LocationCountry = <code>list_properties.Country</code> \u2192 consistency could be checked in validation rule</li> <li>CounterpartyId = counterparty of the loan</li> <li>CollateralHolderId = empty</li> <li>PledgedFlag = 1</li> <li>Type = Contract</li> <li>SubType in (MortgageLoanABL,MortgageLoanABL-ETP,MortgageLoanBAU,MortgageLoanBAU-ETP,MortgageLoanERW,MortgageLoanERW-ETP)</li> <li>PropertyId = <code>list_properties.Id</code></li> <li>ContractId \u2192 not used for legal reporting</li> </ul> </li> </ul> </li> <li>Property. Key characteristics:<ul> <li><code>core_positions</code> \u2192 record used for reconcilation purpose.<ul> <li>LegalAccountNumber = empty</li> <li>BookAmount = 0</li> <li>TypeOf = TangibleAsset</li> <li>SubType = not defined</li> <li>PledgedFlag \u2192 irrelevant </li> <li>CounterpartyId = empty</li> <li>CollateralHolderId = counterparty of the loan (or different if entry in list_pledges to link exposure and collateral)</li> <li>PropertyId = <code>list_properties.Id</code></li> <li>ContractId \u2192 not used for legal reporting</li> </ul> </li> <li><code>list_properties</code><ul> <li>Id = <code>core_positions.PropertyId</code></li> <li>MarketValue \u2192 value used to split the mortgages certificate and mortgage contract according to OFR Appendix 3 under Basel 3.</li> </ul> </li> </ul> </li> <li>Mortgage certificate (c\u00e9dule hypoth\u00e9caire) or Mortgage contract (hypoth\u00e8que) \u2192 both are garanties hypoth\u00e9caires - gages immobiliers - according to the Code Civil. Key characteristics:<ul> <li><code>core_positions</code><ul> <li>LegalAccountNumber = empty</li> <li>TypeOf = Contract</li> <li>SubType = MortgageCertificate or MortgageContract</li> <li>CounterpartyId = empty</li> <li>CollateralHolderId = counterparty of the loan (or different if entry in list_pledges to link exposure and collateral)</li> <li>PledgedFlag = for BaselIII: 1, for BaselIV: irrelevant</li> <li>ContractId = not necessarily the same as tranches</li> <li>PropertyId = <code>list_properties.Id</code></li> </ul> </li> </ul> </li> </ol>"}, {"location": "FunctionalDoc/Doc_Mortgages_B4/#delivery-3-land-loan-tbd", "title": "Delivery 3 - Land loan \u2192 TBD", "text": "<ol> <li>Land loan. Key characteristics:<ul> <li><code>core_positions</code>:<ul> <li>LegalAccountNumber = 102xxx,104xxx ??</li> <li>TypeOf = Contract</li> <li>SubType = LandLoan</li> <li>CounterpartyId = counterparty of the loan</li> <li>CollateralHolderId = empty</li> </ul> </li> </ul> </li> <li>Land ??. Key characteristics<ul> <li><code>core_positions</code>:<ul> <li>LegalAccountNumber = empty</li> <li>TypeOf = TangibleAsset</li> <li>SubType = Land</li> <li>CounterpartyId = empty</li> <li>CollateralHolderId = counterparty of the loan (or different if entry in list_pledges to link exposure and collateral)</li> </ul> </li> </ul> </li> </ol>"}, {"location": "FunctionalDoc/Doc_Mortgages_B4/#delivery-4-financement-de-portefeuille-immobilier-tbd", "title": "Delivery 4 - Financement de portefeuille immobilier \u2192 TBD", "text": ""}, {"location": "FunctionalDoc/Doc_Mortgages_B4/#calculation-of-the-limit", "title": "Calculation of the limit", "text": "<ul> <li>Limit = Initial commitment<ul> <li>Tranches paid (by the bank to the borrower) + remaining commitment</li> </ul> </li> <li>Remarque: on peut partir du principe qu'\u00e0 la date du reporting toutes les tranches sont pay\u00e9 \u2192 limit = tranches</li> </ul>"}, {"location": "FunctionalDoc/Doc_Mortgages_B4/#treatments", "title": "Treatments", "text": ""}, {"location": "FunctionalDoc/Doc_Mortgages_B4/#basel-iii", "title": "Basel III", "text": "<ul> <li>The split of covered mortgage loans according to OFR Appendix 3 is done in the table <code>core_positions_calc</code> in the following fields: <code>MortgageLoanClaimLevel1</code>, <code>MortgageLoanClaimLevel2</code> and <code>MortgageLoanClaimLevel3</code>.</li> <li>Each field contains the amount to be risk weighted at 35%, 75% or 100% respectively, if covered by a mortgage certificate or mortgage contract.</li> <li>For the treatment to function correctly, the property must be linked to the mortgage loan via the fields <code>core_positions.PropertyId</code> (of the mortgage loan record) and <code>list_properties.Id</code> so that the <code>MarketValue</code> can be retrieved.</li> </ul>"}, {"location": "FunctionalDoc/Doc_Netting/", "title": "Netting", "text": ""}, {"location": "FunctionalDoc/Doc_Netting/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>SNB</li> </ul>"}, {"location": "FunctionalDoc/Doc_Netting/#legal-references", "title": "Legal references", "text": ""}, {"location": "FunctionalDoc/Doc_Netting/#description", "title": "Description", "text": ""}, {"location": "FunctionalDoc/Doc_Netting/#principles-for-netting", "title": "Principles for netting", "text": "<ul> <li>Netting is applied to assets and liabilities account depending on a defined identification criteria. The result is a 'net' positive amount on the highest side.</li> </ul>"}, {"location": "FunctionalDoc/Doc_Netting/#workflow-for-rt01-input", "title": "Workflow for RT01 input", "text": "<ol> <li>User imports RT01</li> <li>Netting is done by neutralizing positions depending on parameters defined in param_netting</li> </ol>"}, {"location": "FunctionalDoc/Doc_Netting/#input-fields", "title": "Input fields", "text": ""}, {"location": "FunctionalDoc/Doc_Netting/#core_positions", "title": "core_positions", "text": "<ul> <li>BookingCenterId</li> <li>LegalAccountNumber</li> <li>{ID DEFINED IN PARAM_NETTING TABLE}</li> </ul>"}, {"location": "FunctionalDoc/Doc_Netting/#param_netting", "title": "param_netting", "text": "<ul> <li>BookingCenterId</li> <li>LegalAccountNumber</li> <li>Field</li> <li>Identifier</li> </ul>"}, {"location": "FunctionalDoc/Doc_Netting/#output-fields", "title": "Output fields", "text": ""}, {"location": "FunctionalDoc/Doc_Netting/#core_positions_1", "title": "core_positions", "text": "<ul> <li>Duplicate line and/or proportionally  apply the net amount to the positions.</li> </ul>"}, {"location": "FunctionalDoc/Doc_OnRequestTreatments/", "title": "On-request treatments", "text": "<p>The treatments listed below have been recognized but not developed in Mercury, because not requested and/or not relevant for any of the banks we are working with. Upon request, we can open the discussion as to how to support these treatments in Mercury if relevant to you:</p> <ul> <li>Treatment 1</li> <li>Treatment 2</li> <li>...</li> </ul>"}, {"location": "FunctionalDoc/Doc_Parameters/", "title": "Doc Parameters", "text": ""}, {"location": "FunctionalDoc/Doc_Parameters/#list-of-parameters", "title": "List of parameters", "text": ""}, {"location": "FunctionalDoc/Doc_Parameters/#per-categorymodule", "title": "Per category/module", "text": ""}, {"location": "FunctionalDoc/Doc_Parameters/#mona", "title": "MONA :", "text": "<ul> <li>MONA_CANCELLABLE_OVER_MATURITY : Boolean. In the MONA_U and MONA_B reports, there are positions that are splitted between 'OnSight', 'Cancellable' and 'FixedTerm'. You can decide if you want to allocate your positions with a priority on the maturity date (Default approach) or on the maturity type  Example: Reporting Date is 2024-06-30. You have a Due From Customer (LegalAccountNumber=104001) with MaturityDate = 2024-12-31 and MaturityType = 'Cancellable'.  With the first approach (Value=0), position will be alloacted line 67 and 70 in MONA, fixed term between 3 months and a year.  With the second approach (Value=1), position will be allocated line 66 in MONA, cancellable.</li> </ul>"}, {"location": "FunctionalDoc/Doc_ProvisionsAdjustments/", "title": "Provisions and adjustments", "text": ""}, {"location": "FunctionalDoc/Doc_ProvisionsAdjustments/#provisions", "title": "Provisions", "text": "<ul> <li>Provisions must be delivered in the field <code>core_positions.Provision</code> with a positive amount, on the record for which the provision applies.</li> <li>The provisions can in addition be delivered as a negative amount in a separate record in the field <code>core_positions.BookAmount</code>. The provision must also be delivered as a positive amount in the field <code>core_positions.Provision</code>. This record will be ignored in the reporting and get an exposure of 0 (<code>core_positions_calc.CAExposure</code>).</li> </ul>"}, {"location": "FunctionalDoc/Doc_ProvisionsAdjustments/#adjustments", "title": "Adjustments", "text": "<ul> <li>Adjustments must be delivered with a negative amount in the field <code>core_positions.BookAmount</code>. To distinguish these records from provisions their field <code>core_positions.Provision</code> must contain 0. Adjustment will have a negative exposure computed in <code>core_positions_calc.CAExposure</code> following the regular rules.</li> </ul>"}, {"location": "FunctionalDoc/Doc_Ratings/", "title": "Management of ratings", "text": ""}, {"location": "FunctionalDoc/Doc_Ratings/#general-statements-about-rating-classes", "title": "General statements about rating classes", "text": "<ul> <li>The rating class is a legal creation, which is mapped from external ratings of selected rating agencies using two mapping tables provided by the Finma.<ul> <li>Two types of rating class exist: the short term (ST1, ST2, ST3, ST4) and long term ones (1,2,3,4,5,6,7):  </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_Ratings/#use-of-rating-classes", "title": "Use of rating classes", "text": ""}, {"location": "FunctionalDoc/Doc_Ratings/#risk-weights", "title": "Risk weights", "text": "<ul> <li>As defined in the appendix 2 of the OFR, risk weights are used for capital adequacy purpose and computed using the long term ratings.</li> </ul>"}, {"location": "FunctionalDoc/Doc_Ratings/#haircuts", "title": "Haircuts", "text": "<ul> <li>As defined in the circular 2017/07 cm 209, haircuts can be computed either with the long term rating of the emissions or the short term ratings of the emissions for short term bonds.</li> </ul>"}, {"location": "FunctionalDoc/Doc_Ratings/#computed-vs-delivered", "title": "Computed vs delivered", "text": "<ul> <li>The rating class of positions can be delivered in the fields core_positions.RatingClass, list_counterparties.RatingClass or list_securities.RatingClass, or computed by Mercury based on an external rating.</li> <li>To have the field RatingClass computed by Mercury at the position, counterparty or security level, the table list_external_ratings should be delivered as explained below, with a corresponding ID in the field ExternalRatingId.<ul> <li>Id \u2192 Unique ID of the rating defined by the bank</li> <li>TypeOf \u2192 Type of rating:<ul> <li>LongTerm</li> <li>ShortTerm</li> </ul> </li> <li>RatingAgency \u2192 Rating agency<ul> <li>DBRS</li> <li>Fitch</li> <li>Moodys</li> <li>SP</li> <li>Fedafin</li> <li>Scope</li> <li>AMBestK</li> <li>AMBestFS</li> <li>AMBest</li> </ul> </li> <li>RatingName \u2192 Name of the rating (can be decided by the bank)</li> <li>RatingValue \u2192 Value of the rating</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_Ratings/#use-of-short-term-external-ratings", "title": "Use of short term external ratings", "text": "<ul> <li>Short term external ratings are only useful when it comes to computing the haircut of short term bonds for capital adequacy purpose. The definition of short term is not even provided in this context, which makes it difficult to judge when to use them for this subclass of securities. In addition, short term ratings cannot be used to compute risk weights. For this reasons and for simplification purpose:<ul> <li>An integer between 0 and 7 (long term rating class scale) is expected in the field RatingClass. If short term ratings are used as an input, map the short term rating into their equivalent long term rating classes for the purpose of haircuts calculation:<ul> <li>ST1 \u2192 1</li> <li>ST2 \u2192 3</li> <li>ST4 \u2192 4</li> <li>ST5 \u2192 5</li> <li>This delivery is expected, and if the rating classes are computed by Mercury, it is the mapping that will be applied.</li> </ul> </li> </ul> </li> <li>As explained in the next section Cascading from one table to the other, for a security, if the field core_positions.RatingClass is not delivered, but the field list_securities.RatingClass is, the rating class will be taken from list_securities to core_positions, and in turn used to compute the risk weights for capital adequacy purpose. If it applies, and short term ratings are delivered in list_securities, short term ratings will end up being used to compute risk weights, which is incorrect. To avoid this situation, make sure the core_positions.RatingClass contains the correct rating class to compute the risk weight.</li> <li>In case a bank has external ratings from multiple rating agencies available, it is the responsibility of the bank to deliver in the field ExternalRatingId the Id of the rating it want to use to compute the rating class, based on the principle described in OFR Art.64 al.3: L\u2019utilisation des notations externes doit \u00eatre appliqu\u00e9e de fa\u00e7on coh\u00e9rente par les \u00e9tablissements selon un concept pr\u00e9cis et sp\u00e9cifique.</li> </ul>"}, {"location": "FunctionalDoc/Doc_Ratings/#cascading-from-one-table-to-another", "title": "Cascading from one table to another", "text": "<ul> <li>The simplest delivery option is to deliver only the long term rating classes/external ratings in the table core_positions, which are then in turn used for both the risk weights and the haircuts.</li> <li>Alternatively, rating classes/external ratings can be delivered in list_counterparties and/or list_securities and/or core_positions. In this case the following rules apply:<ul> <li>Rating class will cascade as follow:<ul> <li><code>If core_positions.RatingClass = 0 and core_positions.TypeOf != 'Security' and list_counterparties.RatingClass != 0 (join on CounterpartyId)</code><ul> <li><code>core_positions.RatingClass = list_counterparties.RatingClass</code></li> </ul> </li> <li><code>If list_securities.RatingClass = 0 and and list_counterparties.RatingClass != 0 (join on IssuerId)</code><ul> <li><code>list_securities.RatingClass = list_counterparties.RatingClass</code></li> </ul> </li> <li><code>If core_positions.RatingClass = 0  and core_positions.TypeOf = 'Security and list_securities.RatingClass != 0</code><ul> <li><code>core_positions.RatingClass = list_securities.RatingClass</code></li> </ul> </li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_Ratings/#which-rating-class-is-used-for-what-in-rules-for-calculated-fields", "title": "Which rating class is used for what in rules for calculated fields:", "text": "<ul> <li><code>core_positions_calc.CARiskWeight</code> \u2192 <code>core_positions.RatingClass</code></li> <li><code>core_positions_calc.RegulatoryHaircut</code> \u2192 <code>list_securities.RatingClass</code> if delivered, otherwise <code>core_positions.RatingClass</code></li> <li><code>core_positions_calc.CAEligibilityFlag</code> \u2192 <code>list_securities.RatingClass</code></li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/", "title": "Standardised Approach for Counterparty Credit Risk (SA-CCR)", "text": ""}, {"location": "FunctionalDoc/Doc_SACCR/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2017/07 cm 32-122</li> <li>OFR Art. 57</li> <li>Basel Framework: CRE52</li> <li>bcbs 279</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#description", "title": "Description", "text": "<ul> <li>The exposure at default (EAD) is computed at the netting set level<ul> <li>Transactions not subject to a netting agreement are interpreted as being a netting set on their own.</li> <li>Recognized netting agreements are close-out netting and netting by novation (<code>core_positions.NettingAgreementType not in ('CN','NbN')</code>). If these conditions are met, transactions are grouped together in a netting agreement using the field <code>core_positions.NettingSetId</code>. Otherwise, for positions outside netting sets, the position ID <code>core_positions.Id</code> can be used as the netting set ID. </li> </ul> </li> <li>Formula: , where:<ul> <li>alpha = 1.4</li> <li>RC = replacement cost<ul> <li>Distinction between marigined and unmargined netting set:<ul> <li>A netting set is considered margined if all positions in the netting set have a non-empty field <code>core_positions.MarginAgreementId</code>.</li> </ul> </li> <li>Treatment for unmargined netting set.<ul> <li> , where:<ul> <li>V = sum of replacement value (<code>core_derivatives_calc.ReplacementValue</code>) of the derivatives in the netting set.</li> <li>C = net collateral amount held (after haircut), allocated to that netting set, i.e.  \u2192 documented below.</li> </ul> </li> </ul> </li> <li>Treatment for margined transactions<ul> <li> <ul> <li>V and C: see definitions above</li> <li>TH, MTA and NICA (largest exposure that would not trigger a variation margin call): <code>list_margin_agreements.TH, list_margin_agreements.MTA, list_margin_agreements.NICA</code> \u2192 TBD: should NICA be treated like that, i.e. just a value in an input field?</li> </ul> </li> </ul> </li> </ul> </li> <li> , where:<ul> <li> <ul> <li>The multiplier ranges from its floor of 5% and 1. When over-collateralized (), the multiplier will decrease exponentially toward 5%. For under-collateralized netting set, the multiplier is 1 and  </li> </ul> </li> <li> , where:<ul> <li>The assignment of a transaction to its asset class can be done with the field <code>core_derivatives_calc.AssetClass</code></li> <li> , where a hedging set is a group of positions within an asset class, where the grouping criteria depends on the the asset class:<ul> <li>Interest rate: same currency \u2192 <code>core_derivatives.UnderlyingCurrency, core_derivatives.RCurrency</code><ul> <li>Within each hedging set, positions are further grouped by maturity bucket (<code>core_positions.MaturityDate</code>). Within each maturity bucket, a full offsetting of trade level exposures (SEN) is allowed:<ol> <li>Lest than a year \u2192  </li> <li>Between 1 and 5 years \u2192  </li> <li>More than 5 years \u2192  </li> </ol> </li> <li> </li> </ul> </li> <li>FX: same currency pair \u2192 <code>core_derivatives.UnderlyingCurrency - core_derivatives.QuoteCurrency</code> and <code>core_derivatives_swaps.RCurrency - core_derivatives_swaps.PCurrency</code>. Order by alphabetical orders the currencies in the pair, to avoid counting twice the same currency pair.<ul> <li> </li> </ul> </li> <li>Credit: all positions are in the same hedging set<ul> <li>Within each hedging set, positions are further grouped by reference entity (<code>core_derivatives.UnderlyingReferenceEntityId</code>). For each reference entity , a full offsetting of trade level exposures (SEN) is allowed ().</li> <li> <ul> <li>  is defined under Finma circ. 2017/07 cm 105.</li> </ul> </li> </ul> </li> <li>Equity: all positions are in the same hedging set<ul> <li>Within each hedging set, positions are further grouped by issuer (entity) (<code>core_derivatives.UnderlyingIssuerId</code>). For each issuer , a full offsetting of trade level exposures (SEN) is allowed ().</li> <li> <ul> <li>  is defined under Finma circ. 2017/07 cm 105.</li> </ul> </li> </ul> </li> <li>Commodity:<ul> <li>Positions are categorized into 4 hedging sets corresponding to groups of commodity: <ul> <li>Energy \u2192 <code>list_commodities.TypeOf in ('CO','Coal','El','GC','LC','NG')</code></li> <li>Metals \u2192 <code>list_commodities.TypeOf in ('Gold','NPM','PM')</code></li> <li>Agricultural \u2192 <code>list_commodities.TypeOf in ('GO','LD','SOA')</code></li> <li>Other commodities \u2192 <code>list_commodities.TypeOf in ('Freight','Other')</code></li> </ul> </li> <li>Within each hedging set, positions are further grouped by type of commodity (<code>core_derivatives.UnderlyingCommodityId</code>). For each type , a full offsetting of trade level exposures (SEN) is allowed ().</li> <li> <ul> <li>  is defined under Finma circ. 2017/07 cm 105.</li> </ul> </li> </ul> </li> </ul> </li> <li>Trade level exposure: Scaled Effective Notional (SEN)<ul> <li> , where:<ul> <li> , where :<ul> <li> :<ul> <li>For FX derivatives (<code>core_derivatives_calc.AssetClass = 'FX'</code>) \u2192 notional value of the foreign currency leg converted in functional currency. If both legs in foreign currency, take the highest one (<code>core_derivatives_calc.RCurrency, core_derivatives_calc.PCurrency, core_derivatives_calc.RAmount,core_derivatives_calc.PAmount</code>)<ul> <li>TBD: add fields RCurrency and PCurrency in core_derivatives_calc, and define calculation of fields RAmount and PAmount if not delivered</li> <li>Short term solution: <code>core_positions.Notional</code></li> </ul> </li> <li>For equity and commodity derivatives (<code>core_derlivatives_calc.AssetClass in ('Eq','Co')</code>) \u2192 spot value of the underlying (<code>core_positions.Notional</code>)<ul> <li>TBD: compute it using spot price, multiplier and number of components.</li> </ul> </li> <li>For interest rate and credit derivatives (<code>core_derivatives_calc.AssetClass in ('IR','Cr')</code>) \u2192 , where:<ul> <li>  = <code>core_positions.Notional</code></li> <li> , where:<ul> <li>  = period of time in years, until the start of the time period of reference: <code>core_positions.StartDateReferencePeriod</code> (CRE52.31)</li> <li>  = period of time in years, until the end of the time period of reference: <code>core_positions.EndDateReferencePeriod</code> (CRE52.31)</li> </ul> </li> </ul> </li> </ul> </li> <li> <ul> <li>Treatment for unmargined netting set (CRE52.48).<ul> <li> , where:<ul> <li> <code>core_positions_calc.ResidualDurationDays</code> \u2192 14 because 10 business days + 2 weekend days.</li> </ul> </li> </ul> </li> <li>Treatment for margined netting set.<ul> <li> , where:<ul> <li> , where:<ul> <li>  equals 10 if not centrally cleared transactions or 5 if centrally cleared (<code>list_counterparties.TypeOf in ('CCP1','CCP2','QCCP')</code>)</li> <li>  equals the re-margining period in days<ul> <li>1 if daily re-margining (<code>list_margin_agreements.RevaluationFrequency = 'D'</code>)</li> <li>5 if weekly re-margining (<code>list_margin_agreements.RevaluationFrequency = 'W'</code>)</li> </ul> </li> <li>Computed at netting set level (CRE52.50 / Fimna circ. 2017/07 cm 116-119)</li> </ul> </li> <li>250 because  in business days (unlike  for unmargined netting sets which uses 365 days)</li> </ul> </li> </ul> </li> </ul> </li> <li> <ul> <li>Not options (CRE52.39):<ul> <li>Not swaps:<ul> <li><code>if core_positions.LongContractFlag = 1 then 1 else -1</code></li> </ul> </li> <li>Swaps: TBD</li> </ul> </li> <li>Options (CRE52.40):<ul> <li></li> </ul> </li> <li>The cumulative distribution function is approximated using this formula (Aludaat and Alodat (2008)):  </li> </ul> </li> </ul> </li> </ul> </li> <li>  \u2192 computed according to the Finma circ. 2017/07 cm 105.</li> </ul> </li> </ul> </li> </ul> </li> <li>C = net collateral amount held (after haircut) = sum of received collateral - sum of paid collateral \u2192 can be positive or negative.<ul> <li>The allocation of collateral to netting agreement in the SA-CCR is out of the scope of the regular CRM.</li> <li> <p>Distribution of collaterals to netting sets</p> <ul> <li> <p>Received collateral:</p> <ul> <li>The legal texts do not provide guidelines on how to distribute collaterals to netting sets.</li> <li>Suggested simple strategy to distribute received collateral to netting sets:<ol> <li>Complete the regular capital adequacy CRM</li> <li>For any given counterparty which (a) trades derivatives and (b) still has unused collateral after the CRM: distribute the remaining collateral to each netting sets.<ul> <li>The simplest strategy is to distribute the collateral to each netting set proportionally to the sum of an input field, such as the sum of the notional in the netting set (<code>core_positions.Notional</code>).</li> <li>A more sophisticated approach could be a distribution proportional to the  (<code>tmp_cre_saccr_netting_set_level.AddOnAggregate</code>). This involves computing it first, before going forward with the rest of the EAD calculation.</li> </ul> </li> </ol> </li> <li>Adjusted haircut:<ul> <li>As for collateral entering the CRM, collateral entering the SA-CCR calculation needs to be adapted: , where  is the regulatory haircut defined under Finma circ. cm 209 and  equals 10 business days.</li> <li>The adaptation will vary depending if there is a margin agreement in place or not<ul> <li>Without margin agreement<ul> <li>  (Finma circ. 2017/7 cm 110)</li> <li>This means the haircut will be increased by . It can lead to haircut that are higher than 100%, in which case the collateral value should be 0 (and not negative).</li> </ul> </li> <li>With margin agreement<ul> <li> </li> </ul> </li> </ul> </li> <li>As the notion of margin agreement won't be defined at the collateral level (only for margin accounts) or netting set level, but rather at the derivative/transaction level, I suggest the following logic to decide on which adaptation to apply:<ul> <li>Look at the MPOR (margin period of risk) of all derivatives in a netting set which is calculated in <code>core_derivatives_calc_lc.MPOR</code>:<ul> <li>If one of the MPOR of the netting set = 0 (no margin agreement) set  to 250 as described above</li> <li>Otherwise, take the max value of MPOR.</li> </ul> </li> <li>Note: this is a simplification. A more sophisticated method could be to look at the margin agreement information of all collaterals, and compute a corresponding MPOR if applicable.</li> </ul> </li> </ul> </li> </ul> </li> <li> <p>Posted collateral:</p> <ul> <li>So far, we will only cover margin accounts as posted collaterals, which can be recognized as: <code>core_positions_calc.AccountGroupLevel1 in ('DueFromBanks','DueFromCustomer') and core_positions.SubType = 'LDasGuarantee'</code></li> <li>This positions increase the EAD, so to avoid double-counting, their exposure should be set to 0 (<code>core_positions_calc.CAExposure</code> and/or <code>core_positions__calc.LEXExposure</code>). Consequently, they should also not enter the CRM (set <code>core_positions_calc.CAExposureFlag = 0</code> ?).</li> <li>Simplification: so far, haircuts are not applied on posted collaterals</li> <li>The distribution to netting agreement is done in the same way as for collateral received.</li> </ul> </li> </ul> </li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#not-covered-yet", "title": "Not covered yet:", "text": "<ul> <li>Basis transactions</li> <li>CDO tranches</li> <li>Volatility derivatives</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#some-definitions", "title": "Some definitions", "text": "<ul> <li>Independant collateral amount (ICA) = (i) collateral (other than VM) posted by the counterparty that the bank may seize upon default of the counterparty, the amount of which does not change in response to the value of the transactions it secures and/or (ii) the Independent Amount (IA) parameter as defined in standard industry documentation. ICA can change in response to factors such as the value of the collateral or a change in the number of transactions in the netting set. (CRE52.16)</li> <li>Net independent collateral amount (NICA) = Because both a bank and its counterparty may be required to post ICA, it is necessary to introduce a companion term, net independent collateral amount (NICA), to describe the amount of collateral that a bank may use to offset its exposure on the default of the counterparty. NICA does not include collateral that a bank has posted to a segregated, bankruptcy remote account, which presumably would be returned upon the bankruptcy of the counterparty. That is, NICA represents any collateral (segregated or unsegregated) posted by the counterparty less the unsegregated collateral posted by the bank. With respect to IA, NICA takes into account the differential of IA required for the bank minus IA required for the counterparty. (CRE52.17)</li> <li>Holding period = The period of time over which exposure or collateral values are assumed to move before the bank can close out the transaction. (CRE22.41)</li> <li>Margin period of risk = Margin period of risk is the time period from the last exchange of collateral covering a netting set of transactions with a defaulting counterparty until that counterparty is closed out and the resulting market risk is re-hedged. (CRE50.19)</li> <li>Re-margining period = </li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#some-conceptsprecisions", "title": "Some concepts/precisions", "text": "<ul> <li>A derivative outside a netting agreement will consist of a netting set on its own.</li> <li>The netting agreement sets the rules for the exchange of a net amount for positions within the agreement in case a counterparty defaults.</li> <li>If margin calls are exchanged along the life of the contracts, the margin agreement sets amongst other things the remargining frequency. It will impact the margin period of risk (MPOR) which in turn impact the maturity factor (MF). It is expected that the margin agreement and netting agreement are aligned: in essence, one remargining frequency in a netting set. The case where the margin and netting set do not match described in cm 40 is not supported.</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#output-tablesfields", "title": "Output tables/fields", "text": ""}, {"location": "FunctionalDoc/Doc_SACCR/#v_cre_saccr_netting_set_level", "title": "v_cre_saccr_netting_set_level", "text": "<ul> <li>Id \u2192 Netting set id</li> <li>NettingAgreementFlag \u2192 1 if recognized netting agreement in place</li> <li>EAD</li> <li>RC</li> <li>PFE</li> <li>Multiplier</li> <li>AddOnAggregate</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#v_cre_saccr_fx_hedging_set_level", "title": "v_cre_saccr_fx_hedging_set_level", "text": "<ul> <li>Id \u2192 Hedging set id (currency pair)</li> <li>NettingAgreementId</li> <li>AddOnHedgingSet</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#v_cre_saccr_eq_hedging_set_level", "title": "v_cre_saccr_eq_hedging_set_level", "text": "<ul> <li>Id \u2192 Hedging set id (issuer)</li> <li>NettingAgreementId</li> <li>AddOnHedgingSet</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#v_cre_saccr_eq_sub_hedging_set_level", "title": "v_cre_saccr_eq_sub_hedging_set_level", "text": "<ul> <li>Id \u2192 Sub hedging set id (issuer)</li> <li>NettingAgreementId</li> <li>AddOnSubHedgingSet</li> <li>Rho</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#v_cre_saccr_co_sub_hedging_set_level", "title": "v_cre_saccr_co_sub_hedging_set_level", "text": "<ul> <li>Id \u2192 Sub Hedging set id (commodity type)</li> <li>HedgingSetId</li> <li>NettingAgreementId</li> <li>AddOnSubHedgingSet</li> <li>Rho</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#v_cre_saccr_ir_hedging_set_level", "title": "v_cre_saccr_ir_hedging_set_level", "text": "<ul> <li>Id \u2192 Hedging set id (currency)</li> <li>NettingAgreementId</li> <li>AddOnHedgingSet</li> <li>DB1</li> <li>DB2</li> <li>DB3</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#v_cre_saccr_cr_hedging_set_level", "title": "v_cre_saccr_cr_hedging_set_level", "text": "<ul> <li>Id \u2192 EQ or CR</li> <li>NettingAgreementId</li> <li>AddOnHedgingSet</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#v_cre_saccr_co_hedging_set_level", "title": "v_cre_saccr_co_hedging_set_level", "text": "<ul> <li>Id \u2192 Hedging set id (commodity group)</li> <li>NettingAgreementId</li> <li>AddOnHedgingSet</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#v_cre_saccr_cr_sub_hedging_set_level", "title": "v_cre_saccr_cr_sub_hedging_set_level", "text": "<ul> <li>Id \u2192 Sub hedging set id (reference entity)</li> <li>NettingAgreementId</li> <li>AddOnSubHedgingSet</li> <li>Rho</li> </ul>"}, {"location": "FunctionalDoc/Doc_SACCR/#core_derivatives_calc", "title": "core_derivatives_calc", "text": "<ul> <li>Computed in rules:<ul> <li>NettingSetId</li> <li>SF</li> <li>SupervisoryVolatility</li> <li>SupervisoryRho</li> </ul> </li> <li>Computed in views:<ul> <li>SubHedgingSetId</li> <li>HedgingSetId</li> <li>EffectiveNotional</li> <li>AdjustedNotional</li> <li>MF</li> <li>MPOR</li> <li>SupervisoryDelta</li> <li>SD</li> <li>SEN = trader level exposure</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_SFTs/", "title": "Security financing transactions", "text": ""}, {"location": "FunctionalDoc/Doc_SFTs/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>CRE</li> <li>LIQ</li> </ul>"}, {"location": "FunctionalDoc/Doc_SFTs/#legal-references", "title": "Legal references", "text": "<ul> <li>Finma circ. 2017/07 cm 204 &amp; 278</li> </ul>"}, {"location": "FunctionalDoc/Doc_SFTs/#description", "title": "Description", "text": "<ul> <li>Security financing transactions (SFTs) include:<ul> <li>Repurchase agreements (repos)</li> <li>Reverse-repurchase agreements (reverse repos)</li> <li>Security lending business (SLBs)</li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_SFTs/#repo", "title": "Repo", "text": "<ul> <li> <p>Definition:</p> <ul> <li>Sale of an asset repurchased at future date (short term) \u2192 The bank take a collateralized loan (borrowing)</li> <li>Cash taker</li> </ul> </li> <li> <p>QDL delivery:</p> <ul> <li>1 encumbered security record in core_positions with corresponding information in list_securities. Key characteristics:<ol> <li>LegalAccountNumber \u2192 empty or not, depending if the sold security is still part the BS</li> <li>EncumberedFlag = 1 \u2192 only relevant if it is on BS</li> <li>TypeOf = Security</li> <li>SubType = SS</li> <li>PledgedFlag \u2192 not relevant (part of a contract)</li> <li>ContractId \u2192 matching the one of the due to in core_positions</li> <li>CounterpartyId \u2192 counterparty of the contract, matching the one of the due to</li> <li>CollateralHolderId \u2192 can be delivered it is the security of a client (not necessarily the matching CounterpartyId), empty otherwise</li> <li>NettingSetId \u2192 if delivered cm 278 is applied (matching the one of the due to in core_position), otherwise empty cm 204 is applied</li> </ol> </li> <li>1 cash due to record. Key characteristics:<ol> <li>LegalAccountNumber = 202001</li> <li>TypeOf = Contract</li> <li>SubType = Repo</li> <li>PledgedFlag \u2192 not relevant (part of a contract)</li> <li>ContractId \u2192 matching the one of the security in core_positions </li> <li>CounterpartyId \u2192 counterparty of the contract, matching the one of the security</li> <li>NettingSetId \u2192 if delivered cm 278 is applied (matching the one of the security in core_position), otherwise empty cm 204 is applied</li> </ol> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_SFTs/#reverse-repo", "title": "Reverse-repo", "text": "<ul> <li> <p>Definition:</p> <ul> <li>Purchase of security and sell it back at a future date \u2192 The bank make a collateralized loan to a counterparty \u2192 lend money which creates an amount due from security financing transaction (expo)</li> <li>Cash giver</li> </ul> </li> <li> <p>QDL delivery:</p> <ul> <li>1 loan record in core_positions. Key characteristics:<ol> <li>LegalAccountNumber = 103001</li> <li>TypeOf = Contract</li> <li>SubType = Repo</li> <li>PledgedFlag \u2192 not relevant (part of a contract)</li> <li>ContractId \u2192 matching the one of the security in core_positions </li> <li>CounterpartyId \u2192 counterparty of the contract, matching the one of the security</li> <li>NettingSetId \u2192 if delivered cm 278 is applied (matching the one of the security in core_position), otherwise empty cm 204 is applied</li> </ol> </li> <li>1 security in core_positions with corresponding information in list_securities. Key characteristics:<ol> <li>LegalAccountNumber \u2192 empty or not, depending if the bank book the security as part of its BS</li> <li>TypeOf = Security</li> <li>SubType = SP</li> <li>EncumberedFlag \u2192 set to TRUE if the security is reused, i.e. lent/shorted</li> <li>PledgedFlag \u2192 not relevant (part of a contract)</li> <li>ContractId \u2192 matching the one of the loan in core_positions</li> <li>CounterpartyId \u2192 counterparty of the contract, matchings the one of the loan</li> <li>CollateralHolderId \u2192 can be delivered it is the security of a client (not necessarily the matching CounterpartyId), empty otherwise</li> <li>NettingSetId \u2192 if delivered cm 278 is applied (matching the one of the loan in core_position), otherwise empty cm 204 is applied</li> </ol> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_SFTs/#slb", "title": "SLB", "text": "<ul> <li>QDL delivery:<ul> <li>Security lent. Key characteristics:<ol> <li>LegalAccountNumber \u2192 empty or not, depending if the lent security is still part the BS</li> <li>ContractId \u2192 matching the one of the other components of the contract in core_positions </li> <li>NettingSetId \u2192 if delivered cm 278 is applied (matching the one of the security in core_position), otherwise empty cm 204 is applied</li> <li>TypeOf = Security</li> <li>SubType = SL</li> <li>PledgedFlag \u2192 not relevant (part of a contract)</li> <li>EncumberedFlag = 1 \u2192 only relevant if it is on BS</li> <li>CounterpartyId \u2192 counterparty of the contract, matching the one of other components of the contract in core_positions</li> </ol> </li> <li>Security borrowed. Key characteristics<ol> <li>LegalAccountNumber \u2192 empty or not, depending if the borrowed security is still part the BS</li> <li>ContractId \u2192 matching the one of the other components of the contract in core_positions </li> <li>NettingSetId \u2192 if delivered cm 278 is applied (matching the one of the security in core_position), otherwise empty cm 204 is applied</li> <li>TypeOf = Security</li> <li>SubType = SB</li> <li>PledgedFlag \u2192 not relevant (part of a contract)</li> <li>CounterpartyId \u2192 counterparty of the contract, matching the one of other components of the contract in core_positions</li> </ol> </li> <li>Cash received record. Key characteristics:<ol> <li>LegalAccountNumber = 202001</li> <li>TypeOf = Contract</li> <li>SubType = SLB</li> <li>PledgedFlag \u2192 not relevant (part of a contract)</li> <li>ContractId \u2192 matching the one of the other components of the contract in core_positions </li> <li>CounterpartyId \u2192 counterparty of the contract, matching the one the other components of the contract in core_positions</li> <li>NettingSetId \u2192 if delivered cm 278 is applied (matching the one of the other components of the contract in core_positions), otherwise empty cm 204 is applied</li> </ol> </li> <li>Cash lent record. Key characteristics:<ol> <li>LegalAccountNumber = 103001</li> <li>TypeOf = Contract</li> <li>SubType = SLB</li> <li>PledgedFlag \u2192 not relevant (part of a contract)</li> <li>ContractId \u2192 matching the one of the other components of the contract in core_positions </li> <li>CounterpartyId \u2192 counterparty of the contract, matching the one the other components of the contract in core_positions</li> <li>NettingSetId \u2192 if delivered cm 278 is applied (matching the one of the other components of the contract in core_positions), otherwise empty cm 204 is applied</li> </ol> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_SFTs/#remarks", "title": "Remarks", "text": "<ul> <li>core_positions.LegalAccountNumber<ul> <li>This field might or might not be delivered for securities. It depends if the bank book it on its balance sheet or not, but it has no impact on the treatment capital adequacy.</li> <li>This field is always expected to be delivered for the cash record</li> </ul> </li> <li>CRM<ul> <li>Any position which is part of SFTs should be excluded from the regular CRM for 2 reasons:<ol> <li>Positions in a given contract should cover each other and not be mixed with other positions of the counterparty/collateral holder. These positions can be recognized with the following combination of core_positions.TypeOf and core_positions.SubType:<ul> <li>Security:<ul> <li>TypeOf = Security</li> <li>Subtype = SL or SB</li> </ul> </li> <li>Cash:<ul> <li>TypeOf = Contract</li> <li>SubType = SLB or Repo</li> </ul> </li> </ul> </li> <li>Two possible versions of the CRM can be applied:<ul> <li>The regular one following the formula of the Finma circ. 2017/07 cm 204</li> <li>The one of the Finma circ. 2017/07 cm 278</li> </ul> </li> </ol> </li> <li>We distinguish between the two treatments (cm 204/cm 278) using the field NettingSet:<ul> <li>If it is delivered, it means there is a netting agreement in place which in turn indicates the treatment described under the cm 278 is the appropriate one as shown in the circular. The OCre-Finma chapter 8 is aligned with this treatment with an updated formula. A good candidate value to deliver in this field is the contract id, which is expected in the field core_positions.ContractId.<ul> <li></li> <li></li> </ul> </li> <li>If it is not delivered, the cm 204 is applied.</li> </ul> </li> </ul> </li> </ul>"}, {"location": "FunctionalDoc/Doc_SNBLimitCalculation/", "title": "SNB - Available limit calculation", "text": ""}, {"location": "FunctionalDoc/Doc_SNBLimitCalculation/#used-in-the-following-modules", "title": "Used in the following modules", "text": "<ul> <li>SNB</li> </ul>"}, {"location": "FunctionalDoc/Doc_SNBLimitCalculation/#legal-references", "title": "Legal references", "text": "<p>*</p>"}, {"location": "FunctionalDoc/Doc_SNBLimitCalculation/#mercury-input", "title": "Mercury input:", "text": "<p>QUIRE-784</p>"}, {"location": "FunctionalDoc/Doc_SNBLimitCalculation/#input-fields", "title": "Input Fields:", "text": "<ul> <li> <p>Limits: </p> <p><code>core_positions.LegalAccountNumber = 302001  core_positions.SubType = 'IC2'  core_positions.ContractId &lt;&gt; ''</code></p> </li> <li> <p>Exposures: </p> <p><code>core_positions_calc.AccountGroupLevel1 in('DueFromBanks','DueFromSFT','DueFromCustomer','MortgageLoans','ContingentLiabilities','IrrevocableCommitments','ObligationToPayUp','CreditCommitments')  core_positions.ContractId &lt;&gt; ''</code></p> </li> </ul>"}, {"location": "FunctionalDoc/Doc_SNBLimitCalculation/#calculation", "title": "Calculation:", "text": "<ul> <li>Limits delivery can be global (per ContractId) or individual (per ContractId per positionId)</li> <li>The delivery can be on the Load Id or on the LoadCollection Id (in case of multiple input file or client across entities etc...)</li> <li>When the parameter is activated the calculation is done per Contract / position AvailableLimit = MIN(limit.sum(BookAmount) - Exposure.sum(BookAmount),0) During the calcfields</li> </ul>"}, {"location": "FunctionalDoc/Doc_SNBLimitCalculation/#output-fields", "title": "Output Fields:", "text": "<ul> <li>AvailableLimit: *</li> </ul> <p><code>core_positions_calc.AvailableLimit</code></p>"}, {"location": "FunctionalDoc/Doc_SNBLimitCalculation/#parameter", "title": "Parameter:", "text": "<ul> <li>name: AVAILABLE_LIMIT_CALC</li> <li>cat: SNB</li> <li>Default value: 0</li> <li>description: Boolean let Mercury Calculate the Available limit based on link betweeen exposure and global limit in ContractId</li> </ul>"}, {"location": "FunctionalDoc/Doc_SNBLimitCalculation/#examples", "title": "Examples:", "text": "<p>input</p>"}, {"location": "FunctionalDoc/Doc_SNBLimitCalculation/#_1", "title": "Available limit calculation", "text": "<p>output </p>"}, {"location": "TechnicalDoc/Doc_Config_Mercury/", "title": "Technical documentation for mercury", "text": ""}, {"location": "TechnicalDoc/Doc_Config_Mercury/#appsettingsjson", "title": "Appsettings.json", "text": "<ul> <li>Serilog \u2192 Allow to configure the logs</li> <li>RedirectHttpsToHttp \u2192 Allow to enable https redirection</li> <li>Jwt \u2192 Allow to configure the authentification</li> <li>Database \u2192 Allow to configure some database parameters</li> <li>SqlTimeout \u2192 Time in ms before a query timeout</li> <li>EnableSensitiveDataLogging \u2192 True to display the data when showing a query in the logs</li> <li>Provider \u2192 Database provider</li> <li>ConnectionStrings \u2192 connectins string to the databases</li> <li>AppSettings</li> <li>MetadataFile \u2192 Path to the metadata file</li> <li>ImportSQL \u2192 Settings for the import from the different sources<ul> <li>LinkServerName \u2192 URI of the link server if needed for import from views</li> <li>DatabaseName \u2192 Database name (and schema) for import from views</li> <li>UseOpenQuery \u2192 Use openquery for import from views</li> <li>AddDateParameter \u2192 Add date as parameter for import from views</li> <li>Mappings \u2192 Mapping for each tables for import from views</li> <li>Tables \u2192 Fields to import for import from single file</li> </ul> </li> <li>Data<ul> <li>Import</li> <li>PitEqualsLoadId \u2192 When true, no point in time management, the point in times are equals to the load id</li> <li>CsvDelimiterSingle \u2192 CSV separator for single file import</li> <li>CsvDelimiterData \u2192 CSV separator for config files</li> </ul> </li> <li>Rules<ul> <li>FilesDirectory \u2192 Folder where the rules are located</li> </ul> </li> <li>Validations<ul> <li>FilesDirectory \u2192 Folder where the validations are located</li> </ul> </li> <li>Reports<ul> <li>FilesDirectory \u2192 Folder where the reports are located</li> </ul> </li> <li>ImportTests \u2192 Files to use for the tests</li> <li>Configs \u2192 Physical names of the different configuration files</li> <li>Cors \u2192 Allow to configure the cors settings</li> </ul>"}]}